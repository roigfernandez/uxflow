<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowForge | Generador de Flujos UX/UI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: #15151f;
            --bg-hover: #1e1e2a;
            --border-color: #2a2a3a;
            --border-active: #4a4a6a;
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b5;
            --text-muted: #6a6a7a;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 20px rgba(0,0,0,0.4);
            --shadow-lg: 0 8px 40px rgba(0,0,0,0.5);
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
            max-width: 100vw;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .logo {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1::before {
            content: '‚óà';
            font-size: 1.2rem;
            -webkit-text-fill-color: var(--accent-primary);
        }

        .logo span {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 400;
            display: block;
            margin-top: 4px;
            -webkit-text-fill-color: var(--text-muted);
        }

        .new-project-btn {
            margin: 20px;
            padding: 14px 20px;
            background: var(--accent-gradient);
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .new-project-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        .projects-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .projects-header {
            padding: 10px 14px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .project-item {
            padding: 12px 14px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .project-item:hover {
            background: var(--bg-hover);
        }

        .project-item.active {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-active);
        }

        .project-item-info {
            flex: 1;
            min-width: 0;
        }

        .project-item-name {
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .project-item-date {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .project-item-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: var(--transition);
        }

        .project-item:hover .project-item-actions {
            opacity: 1;
        }

        .project-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 0.8rem;
        }

        .project-action-btn:hover {
            background: var(--error);
            color: white;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            font-size: 0.75rem;
            color: var(--text-muted);
            text-align: center;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 100%;
            overflow-x: hidden;
        }

        .header {
            padding: 20px 32px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
            gap: 16px;
            flex-wrap: wrap;
        }

        .header-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-btn {
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .header-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .header-btn.primary {
            background: var(--accent-gradient);
            border: none;
            color: white;
        }

        .header-btn.primary:hover {
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .secondary-btn {
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .secondary-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
            background: var(--surface-color);
        }

        .secondary-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .content-area {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            max-width: 100%;
            box-sizing: border-box;
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
        }

        .welcome-icon {
            width: 100px;
            height: 100px;
            background: var(--accent-gradient);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin-bottom: 24px;
            box-shadow: 0 8px 40px rgba(99, 102, 241, 0.3);
        }

        .welcome-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .welcome-subtitle {
            color: var(--text-secondary);
            max-width: 400px;
            margin-bottom: 32px;
        }

        /* Project Form */
        .project-form {
            display: none;
        }

        .project-form.active {
            display: block;
        }

        .form-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 28px;
            margin-bottom: 24px;
        }

        .form-section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--accent-gradient);
            border-radius: 2px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input, .form-textarea, .form-select {
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select {
            cursor: pointer;
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: var(--accent-gradient);
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Project View */
        .project-view {
            display: none;
        }

        .project-view.active {
            display: block;
        }

        /* Tabs */
        .tabs-container {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 24px;
            max-width: 100%;
        }

        .tabs-header {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-primary) var(--bg-tertiary);
            -webkit-overflow-scrolling: touch;
            padding-right: 8px;
        }
        
        .tabs-header::-webkit-scrollbar {
            height: 4px;
        }
        
        .tabs-header::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }
        
        .tabs-header::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 2px;
        }

        .tab-btn {
            padding: 12px 14px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            position: relative;
            flex-shrink: 0;
        }
        
        .tab-btn:last-child {
            padding-right: 20px;
        }

        .tab-btn:hover {
            color: var(--text-secondary);
            background: var(--bg-hover);
        }

        .tab-btn.active {
            color: var(--text-primary);
            background: var(--bg-card);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-gradient);
        }

        .tab-content {
            display: none;
            padding: 24px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Content Blocks */
        .content-block {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .content-block-header {
            padding: 14px 18px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .content-block-title {
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .content-block-actions {
            display: flex;
            gap: 6px;
        }

        .block-action-btn {
            padding: 6px 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .block-action-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .block-action-btn.copy-btn:hover {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .content-block-body {
            padding: 18px;
        }

        .content-block-textarea {
            width: 100%;
            min-height: 150px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 14px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            resize: vertical;
            transition: var(--transition);
        }

        .content-block-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        /* Flows Section */
        .flows-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .flow-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .flow-card-header {
            padding: 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .flow-card-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .flow-card-subtitle {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .flow-card-body {
            padding: 16px;
        }

        .flow-item {
            padding: 10px 14px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .flow-item-number {
            width: 24px;
            height: 24px;
            background: var(--accent-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        /* Design Tokens */
        .tokens-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .token-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
        }

        .token-card-title {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .token-card-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .color-preview {
            width: 100%;
            height: 40px;
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
        }

        /* Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
        }

        .metric-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            background: var(--bg-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 1.2rem;
        }

        .metric-title {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Prompt Builder */
        .prompt-builder {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-top: 24px;
        }

        .prompt-builder-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prompt-sections {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .prompt-section-toggle {
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .prompt-section-toggle:hover {
            border-color: var(--accent-primary);
        }

        .prompt-section-toggle.active {
            background: var(--accent-gradient);
            border-color: transparent;
            color: white;
        }

        .prompt-output {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .prompt-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 14px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
            min-width: 280px;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .toast.success { border-left: 3px solid var(--success); }
        .toast.error { border-left: 3px solid var(--error); }
        .toast.info { border-left: 3px solid var(--info); }
        .toast.warning { border-left: 3px solid var(--warning); background: rgba(245, 158, 11, 0.1); }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast.success .toast-icon { color: var(--success); }
        .toast.error .toast-icon { color: var(--error); }
        .toast.info .toast-icon { color: var(--info); }

        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 15, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 15, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 32px;
            max-width: 500px;
            width: 90%;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .modal-text {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-btn.cancel {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .modal-btn.confirm {
            background: var(--error);
            border: none;
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-1px);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-active);
        }

        /* Responsive */
        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 100;
                transition: var(--transition);
            }

            .sidebar.open {
                left: 0;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .mobile-menu-btn {
                display: flex !important;
            }
        }

        .mobile-menu-btn {
            display: none;
            width: 40px;
            height: 40px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            cursor: pointer;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .api-key-section {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .api-key-input {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .api-key-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .api-key-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: block;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--accent-gradient);
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge.mvp { background: var(--success); }
        .badge.intermediate { background: var(--warning); }
        .badge.complete { background: var(--accent-primary); }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .version-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent-gradient);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
        }

        .flow-tier-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tier-btn {
            flex: 1;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .tier-btn:hover {
            border-color: var(--accent-primary);
        }

        .tier-btn.active {
            background: var(--accent-gradient);
            border-color: transparent;
            color: white;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .save-indicator {
            font-size: 0.85rem;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .save-indicator.saving {
            color: var(--info);
        }

        .save-indicator.saved {
            color: var(--success);
        }

        .save-indicator.error {
            color: var(--error);
        }

        .loading-progress {
            width: 100%;
            max-width: 300px;
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-gradient);
            transition: width 0.3s ease;
        }

        .progress-text {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 8px;
            text-align: center;
        }

        .field-error {
            color: var(--error);
            font-size: 0.75rem;
            margin-top: 4px;
            display: none;
        }

        .field-error.active {
            display: block;
        }

        .form-input.error,
        .form-textarea.error,
        .form-select.error {
            border-color: var(--error);
        }

        .search-container {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .search-input {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.85rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .filter-controls {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .filter-btn {
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn:hover {
            border-color: var(--accent-primary);
        }

        .filter-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .undo-redo-controls {
            display: flex;
            gap: 4px;
        }

        .undo-redo-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .undo-redo-btn:hover:not(:disabled) {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .undo-redo-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .version-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-left: 8px;
        }

        .version-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 8px;
        }

        .version-item {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .version-item:hover {
            border-color: var(--accent-primary);
            background: var(--bg-hover);
        }

        .version-info {
            flex: 1;
        }

        .version-name {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .version-date {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .version-actions {
            display: flex;
            gap: 4px;
        }

        .version-btn {
            padding: 4px 8px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 0.7rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .version-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .share-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-top: 16px;
        }

        .share-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .share-link-container {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .share-link-input {
            flex: 1;
            padding: 10px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            user-select: all;
        }

        .share-link-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .qr-code-container {
            text-align: center;
            padding: 16px;
            background: white;
            border-radius: var(--radius-sm);
            margin-top: 12px;
        }

        /* Accesibilidad */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent-primary);
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            z-index: 10000;
        }

        .skip-link:focus {
            top: 0;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Focus visible mejorado */
        *:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }

        button:focus-visible,
        input:focus-visible,
        textarea:focus-visible,
        select:focus-visible {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
        }

        /* Alignment Control Panel */
        .alignment-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
        }

        .alignment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .alignment-title {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alignment-score {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .score-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .score-badge.excellent {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .score-badge.good {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .score-badge.fair {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .score-badge.poor {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .alignment-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .metric-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 12px;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .keyword-comparison {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 14px;
            margin-bottom: 16px;
        }

        .keyword-section {
            margin-bottom: 10px;
        }

        .keyword-section-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .keyword-tag {
            padding: 4px 10px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .keyword-tag.matched {
            background: var(--accent-gradient);
            border-color: transparent;
            color: white;
        }

        .keyword-tag.missing {
            border-color: var(--error);
            color: var(--error);
        }

        .keyword-tag.extra {
            border-color: var(--warning);
            color: var(--warning);
        }

        .deviation-warning {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            border-radius: var(--radius-sm);
            padding: 12px;
            margin-bottom: 16px;
            display: flex;
            align-items: start;
            gap: 10px;
        }

        .deviation-warning .icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .deviation-content {
            flex: 1;
        }

        .deviation-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--error);
            margin-bottom: 4px;
        }

        .deviation-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .refinement-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .refinement-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .refinement-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .refinement-btn.primary {
            background: var(--accent-gradient);
            border-color: transparent;
            color: white;
        }

        .refinement-btn.primary:hover {
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar" role="navigation" aria-label="Navegaci√≥n principal">
            <div class="logo">
                <h1>FlowForge
                    <span>Generador UX/UI v1.0</span>
                </h1>
            </div>

            <div class="api-key-section">
                <label class="api-key-label">API Key de Claude (opcional)</label>
                <input type="password" class="api-key-input" id="apiKeyInput" placeholder="sk-ant-...">
            </div>

            <button class="new-project-btn" onclick="createNewProject()">
                <span>Ôºã</span> Nuevo Proyecto
            </button>

            <div class="search-container">
                <input type="text" class="search-input" id="projectSearch" placeholder="üîç Buscar proyectos...">
                <div class="filter-controls">
                    <button class="filter-btn active" data-category="all" onclick="filterProjects('all')">Todos</button>
                    <button class="filter-btn" data-category="fintech" onclick="filterProjects('fintech')">Fintech</button>
                    <button class="filter-btn" data-category="healthtech" onclick="filterProjects('healthtech')">Health</button>
                    <button class="filter-btn" data-category="edtech" onclick="filterProjects('edtech')">EdTech</button>
                </div>
            </div>

            <div class="projects-list">
                <div class="projects-header">Proyectos Guardados</div>
                <div id="projectsList"></div>
            </div>

            <div class="sidebar-footer">
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <span class="status-indicator"></span>
                    Autosave activo ‚Ä¢ M√°x 10 proyectos
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="main-content" role="main">
            <header class="header" role="banner">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                <h2 class="header-title" id="headerTitle">Bienvenido a FlowForge</h2>
                <div class="header-actions">
                    <div class="undo-redo-controls" id="undoRedoControls" style="display: none;">
                        <button class="undo-redo-btn" id="undoBtn" onclick="undoChange()" title="Deshacer (Ctrl+Z)" disabled>‚Ü∂</button>
                        <button class="undo-redo-btn" id="redoBtn" onclick="redoChange()" title="Rehacer (Ctrl+Y)" disabled>‚Ü∑</button>
                    </div>
                    <span class="save-indicator" id="saveIndicator"></span>
                    <button class="header-btn" onclick="showVersions()" id="versionsBtn" style="display: none;" aria-label="Gestionar versiones">
                        üïê Versiones
                    </button>
                    <button class="header-btn" onclick="showShareDialog()" id="shareBtn" style="display: none;" aria-label="Compartir proyecto">
                        üîó Compartir
                    </button>
                    <button class="header-btn" onclick="exportProject()" id="exportBtn" style="display: none;" aria-label="Exportar proyecto">
                        ‚Üì Exportar
                    </button>
                    <button class="header-btn primary" onclick="saveCurrentProject()" id="saveBtn" style="display: none;" aria-label="Guardar proyecto">
                        ‚úì Guardar
                    </button>
                </div>
            </header>

            <div class="content-area">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">‚óà</div>
                    <h2 class="welcome-title">Crea flujos UX/UI profesionales</h2>
                    <p class="welcome-subtitle">Genera especificaciones completas de dise√±o, flujos de pantalla y m√©tricas de √©xito para tu aplicaci√≥n con un solo clic.</p>
                    <button class="new-project-btn" onclick="createNewProject()">
                        <span>Ôºã</span> Crear mi primer proyecto
                    </button>
                </div>

                <!-- Project Form -->
                <div class="project-form" id="projectForm">
                    <div class="form-section">
                        <h3 class="form-section-title">Informaci√≥n B√°sica</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nombre Comercial</label>
                                <input type="text" class="form-input" id="projectName" placeholder="Ej: TaskFlow, HealthBuddy...">
                                <span class="field-error" id="projectNameError"></span>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Industria / Categor√≠a</label>
                                <select class="form-select" id="projectCategory">
                                    <option value="">Seleccionar...</option>
                                    <option value="fintech">Fintech</option>
                                    <option value="healthtech">HealthTech</option>
                                    <option value="edtech">EdTech</option>
                                    <option value="ecommerce">E-commerce</option>
                                    <option value="social">Social / Comunidad</option>
                                    <option value="productivity">Productividad</option>
                                    <option value="entertainment">Entretenimiento</option>
                                    <option value="travel">Viajes</option>
                                    <option value="food">Food / Delivery</option>
                                    <option value="other">Otro</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label">Descripci√≥n Corta del Proyecto</label>
                                <textarea class="form-textarea" id="projectDescription" rows="3" placeholder="Describe brevemente qu√© quieres crear..."></textarea>
                                <span class="field-error" id="projectDescriptionError"></span>
                            </div>
                            <div class="form-group full-width" id="expandedDescriptionGroup" style="display: none; margin-top: 20px; padding: 20px; background: var(--surface-color); border-radius: var(--radius-md); border: 2px solid var(--accent-primary);">
                                <label class="form-label" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                    <span style="font-size: 1.2rem;">‚ú®</span>
                                    <span style="font-size: 1rem; font-weight: 600;">Descripci√≥n Expandida y Refinada</span>
                                </label>
                                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.5;">
                                    Esta descripci√≥n refinada guiar√° todo el proceso de generaci√≥n y asegurar√° que el resultado est√© alineado con tu visi√≥n.
                                </p>
                                <textarea class="form-textarea" id="expandedDescription" rows="8" placeholder="La descripci√≥n expandida aparecer√° aqu√≠..." readonly style="width: 100%; background: var(--bg-primary); opacity: 1; border: 1px solid var(--border-color); resize: vertical; min-height: 150px;"></textarea>
                                <div style="display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap;">
                                    <button type="button" class="secondary-btn" onclick="regenerateExpandedDescription()" id="regenerateExpandedBtn" style="display: none;">
                                        ‚Üª Regenerar
                                    </button>
                                    <button type="button" class="secondary-btn" onclick="editExpandedDescription()" id="editExpandedBtn" style="display: none;">
                                        ‚úé Editar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="secondary-btn" onclick="expandDescription()" id="expandBtn" style="margin-top: 16px; width: 100%;">
                            <span>üîç</span> Expandir y Refinar Descripci√≥n
                        </button>
                    </div>

                    <button class="generate-btn" onclick="generateProject()" id="generateBtn" disabled style="opacity: 0.5; cursor: not-allowed;">
                        <span>‚ö°</span> Generar Flujo UX/UI Completo
                    </button>
                    <p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem; margin-top: 8px;" id="generateHint">
                        ‚Üë Primero expande la descripci√≥n para continuar
                    </p>
                </div>

                <!-- Project View -->
                <div class="project-view" id="projectView">
                    <!-- Overview Section -->
                    <div class="form-section" id="overviewSection">
                        <h3 class="form-section-title">üìã Revisi√≥n de Concepto</h3>
                        <div id="overviewContent"></div>
                        <div style="margin-top: 16px; display: flex; gap: 10px;">
                            <button class="header-btn primary" onclick="approveOverview()">‚úì Aprobar y Continuar</button>
                            <button class="header-btn" onclick="editOverview()">‚úé Editar</button>
                        </div>
                    </div>

                    <!-- Main Tabs -->
                    <div class="tabs-container" id="mainTabs" style="display: none;">
                        <div class="tabs-header">
                            <button class="tab-btn active" data-tab="description">üìù Descripci√≥n</button>
                            <button class="tab-btn" data-tab="flows">üì± Flujos de Pantalla</button>
                            <button class="tab-btn" data-tab="tokens">üé® Design Tokens</button>
                            <button class="tab-btn" data-tab="elements">üß© Elementos UI</button>
                            <button class="tab-btn" data-tab="metrics">üìä M√©tricas</button>
                            <button class="tab-btn" data-tab="generalRules">üìú Reglas Generales</button>
                            <button class="tab-btn" data-tab="architecture">üèóÔ∏è Arquitectura</button>
                            <button class="tab-btn" data-tab="consistency">‚úì Consistencia</button>
                        </div>

                        <!-- Description Tab -->
                        <div class="tab-content active" id="tab-description">
                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">üéØ Qu√© es y qu√© hace</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('whatIs')">‚úé Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('whatIs')">‚éò Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="whatIs" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">üë• Para qui√©n es (Nicho)</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('targetAudience')">‚úé Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('targetAudience')">‚éò Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="targetAudience" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">üí° Necesidades que resuelve</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('needsSolved')">‚úé Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('needsSolved')">‚éò Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="needsSolved" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">üèÜ Diferenciadores</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('differentiators')">‚úé Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('differentiators')">‚éò Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="differentiators" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">üé§ Elevator Pitch</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('elevatorPitch')">‚úé Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('elevatorPitch')">‚éò Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="elevatorPitch" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">üì± Tipo de Aplicaci√≥n Recomendada</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('appType')">‚úé Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('appType')">‚éò Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="appType" readonly></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Flows Tab -->
                        <div class="tab-content" id="tab-flows">
                            <div class="flow-tier-selector">
                                <button class="tier-btn active" data-tier="mvp">üöÄ MVP</button>
                                <button class="tier-btn" data-tier="intermediate">üìà Intermedio</button>
                                <button class="tier-btn" data-tier="complete">‚ú® Completo</button>
                            </div>

                            <div id="flowsContainer">
                                <!-- Flows will be rendered here -->
                            </div>
                        </div>

                        <!-- Tokens Tab -->
                        <div class="tab-content" id="tab-tokens">
                            <div id="tokensContainer">
                                <!-- Tokens will be rendered here -->
                            </div>
                        </div>

                        <!-- Elements Tab -->
                        <div class="tab-content" id="tab-elements">
                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">üß© Componentes UI Requeridos</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('uiComponents')">‚úé Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('uiComponents')">‚éò Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="uiComponents" readonly style="min-height: 300px;"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Metrics Tab -->
                        <div class="tab-content" id="tab-metrics">
                            <div id="metricsContainer" class="metrics-grid">
                                <!-- Metrics will be rendered here -->
                            </div>
                            <div class="content-block" style="margin-top: 24px;">
                                <div class="content-block-header">
                                    <span class="content-block-title">üìä Detalle de M√©tricas</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('metricsDetail')">‚úé Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('metricsDetail')">‚éò Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="metricsDetail" readonly style="min-height: 250px;"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- General Rules Tab -->
                        <div class="tab-content" id="tab-generalRules">
                            <div id="generalRulesContainer">
                                <!-- General Rules will be rendered here -->
                            </div>
                        </div>

                        <!-- Architecture Tab -->
                        <div class="tab-content" id="tab-architecture">
                            <div id="architectureContainer">
                                <!-- Architecture will be rendered here -->
                            </div>
                        </div>

                        <!-- Consistency Tab -->
                        <div class="tab-content" id="tab-consistency">
                            <div id="consistencyContainer">
                                <!-- Consistency will be rendered here -->
                            </div>
                        </div>
                    </div>

                    <!-- Prompt Builder -->
                    <div class="prompt-builder" id="promptBuilder" style="display: none;">
                        <h3 class="prompt-builder-title">üîß Constructor de Prompt para Agente de Dise√±o</h3>
                        <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 0.9rem;">Selecciona las secciones que deseas incluir en tu prompt personalizado:</p>
                        
                        <div class="prompt-sections" id="promptSections">
                            <button class="prompt-section-toggle active" data-section="whatIs">Qu√© es</button>
                            <button class="prompt-section-toggle active" data-section="targetAudience">Nicho</button>
                            <button class="prompt-section-toggle active" data-section="needsSolved">Necesidades</button>
                            <button class="prompt-section-toggle" data-section="differentiators">Diferenciadores</button>
                            <button class="prompt-section-toggle" data-section="elevatorPitch">Elevator Pitch</button>
                            <button class="prompt-section-toggle active" data-section="appType">Tipo App</button>
                            <button class="prompt-section-toggle active" data-section="flowsMvp">Flujos MVP</button>
                            <button class="prompt-section-toggle" data-section="flowsIntermediate">Flujos Intermediate</button>
                            <button class="prompt-section-toggle" data-section="flowsComplete">Flujos Complete</button>
                            <button class="prompt-section-toggle" data-section="generalRules">üìú Reglas Generales</button>
                            <button class="prompt-section-toggle" data-section="architecture">üèóÔ∏è Arquitectura</button>
                            <button class="prompt-section-toggle" data-section="consistency">‚úì Consistencia</button>
                            <button class="prompt-section-toggle active" data-section="tokens">Design Tokens</button>
                            <button class="prompt-section-toggle" data-section="uiComponents">Componentes</button>
                            <button class="prompt-section-toggle" data-section="metrics">M√©tricas</button>
                        </div>

                        <div class="prompt-output" id="promptOutput">
                            <!-- Generated prompt will appear here -->
                        </div>

                        <div class="prompt-actions">
                            <button class="header-btn primary" onclick="copyPrompt()">‚éò Copiar Prompt</button>
                            <button class="header-btn" onclick="regeneratePrompt()">‚Üª Regenerar</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">Generando flujo UX/UI...</div>
        <div class="loading-progress" id="loadingProgress" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal-overlay" id="deleteModal" role="dialog" aria-labelledby="deleteModalTitle" aria-modal="true">
        <div class="modal">
            <h3 class="modal-title" id="deleteModalTitle">¬øEliminar proyecto?</h3>
            <p class="modal-text">Esta acci√≥n no se puede deshacer. El proyecto ser√° eliminado permanentemente.</p>
            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="closeDeleteModal()">Cancelar</button>
                <button class="modal-btn confirm" onclick="confirmDelete()">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Versions Modal -->
    <div class="modal-overlay" id="versionsModal" role="dialog" aria-labelledby="versionsModalTitle" aria-modal="true">
        <div class="modal">
            <h3 class="modal-title" id="versionsModalTitle">Gesti√≥n de Versiones</h3>
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-size: 0.85rem; margin-bottom: 8px; color: var(--text-secondary);">Nombre de la versi√≥n</label>
                <input type="text" id="versionNameInput" class="form-input" placeholder="ej: MVP Final, Versi√≥n para cliente, etc." style="margin-bottom: 8px;">
                <button class="header-btn primary" onclick="createVersion()" style="width: 100%;">üíæ Crear Nueva Versi√≥n</button>
            </div>
            <div class="version-list" id="versionsList"></div>
            <div class="modal-actions" style="margin-top: 16px;">
                <button class="modal-btn cancel" onclick="closeVersionsModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal" role="dialog" aria-labelledby="shareModalTitle" aria-modal="true">
        <div class="modal">
            <h3 class="modal-title" id="shareModalTitle">Compartir Proyecto</h3>
            <p class="modal-text">Comparte este enlace para que otros puedan importar tu proyecto:</p>
            <div class="share-link-container">
                <input type="text" class="share-link-input" id="shareLinkInput" readonly aria-label="Enlace para compartir">
                <button class="header-btn primary" onclick="copyShareLink()">üìã Copiar</button>
            </div>
            <div id="qrCodeContainer" style="display: none;"></div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="generateQRCode()" id="qrBtn">üì± Generar QR</button>
                <button class="modal-btn cancel" onclick="closeShareModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer" role="status" aria-live="polite" aria-atomic="true"></div>

    <script>
        // ========== Utility Classes ==========
        
        // Encriptaci√≥n segura de API keys
        class SecureStorage {
            static #key = 'flowforge_secure_2026'; // Clave simple para ofuscaci√≥n
            
            static encrypt(text) {
                if (!text) return '';
                // XOR encryption simple - para producci√≥n usar Web Crypto API
                let result = '';
                for (let i = 0; i < text.length; i++) {
                    result += String.fromCharCode(text.charCodeAt(i) ^ this.#key.charCodeAt(i % this.#key.length));
                }
                return btoa(result);
            }
            
            static decrypt(encrypted) {
                if (!encrypted) return '';
                try {
                    const decoded = atob(encrypted);
                    let result = '';
                    for (let i = 0; i < decoded.length; i++) {
                        result += String.fromCharCode(decoded.charCodeAt(i) ^ this.#key.charCodeAt(i % this.#key.length));
                    }
                    return result;
                } catch (e) {
                    console.error('Error decrypting:', e);
                    return '';
                }
            }
            
            static setSecure(key, value) {
                const encrypted = this.encrypt(value);
                localStorage.setItem(key, encrypted);
            }
            
            static getSecure(key) {
                const encrypted = localStorage.getItem(key);
                return encrypted ? this.decrypt(encrypted) : null;
            }
        }
        
        // B√∫squeda y filtrado de proyectos
        class ProjectSearch {
            static search(projects, query) {
                if (!query || query.trim() === '') return projects;
                
                const lowerQuery = query.toLowerCase().trim();
                return projects.filter(p => 
                    p.name.toLowerCase().includes(lowerQuery) ||
                    (p.description && p.description.toLowerCase().includes(lowerQuery)) ||
                    (p.category && p.category.toLowerCase().includes(lowerQuery))
                );
            }
            
            static filter(projects, filters) {
                let filtered = [...projects];
                
                if (filters.category && filters.category !== 'all') {
                    filtered = filtered.filter(p => p.category === filters.category);
                }
                
                if (filters.dateFrom) {
                    filtered = filtered.filter(p => new Date(p.createdAt) >= filters.dateFrom);
                }
                
                if (filters.dateTo) {
                    filtered = filtered.filter(p => new Date(p.createdAt) <= filters.dateTo);
                }
                
                return filtered;
            }
        }
        
        // Historial de cambios (Undo/Redo)
        class HistoryManager {
            constructor(maxHistory = 20) {
                this.history = [];
                this.currentIndex = -1;
                this.maxHistory = maxHistory;
            }
            
            push(state) {
                // Remover estados futuros si estamos en medio del historial
                this.history = this.history.slice(0, this.currentIndex + 1);
                
                // Hacer deep copy del estado
                this.history.push(JSON.parse(JSON.stringify(state)));
                
                if (this.history.length > this.maxHistory) {
                    this.history.shift();
                } else {
                    this.currentIndex++;
                }
                
                this.updateButtons();
            }
            
            undo() {
                if (this.canUndo()) {
                    this.currentIndex--;
                    this.updateButtons();
                    return JSON.parse(JSON.stringify(this.history[this.currentIndex]));
                }
                return null;
            }
            
            redo() {
                if (this.canRedo()) {
                    this.currentIndex++;
                    this.updateButtons();
                    return JSON.parse(JSON.stringify(this.history[this.currentIndex]));
                }
                return null;
            }
            
            canUndo() {
                return this.currentIndex > 0;
            }
            
            canRedo() {
                return this.currentIndex < this.history.length - 1;
            }
            
            updateButtons() {
                const undoBtn = document.getElementById('undoBtn');
                const redoBtn = document.getElementById('redoBtn');
                
                if (undoBtn) undoBtn.disabled = !this.canUndo();
                if (redoBtn) redoBtn.disabled = !this.canRedo();
            }
            
            clear() {
                this.history = [];
                this.currentIndex = -1;
                this.updateButtons();
            }
        }
        
        // Templates predefinidos
        class ProjectTemplates {
            static getTemplates() {
                return [
                    {
                        id: 'saas_dashboard',
                        name: 'SaaS Dashboard',
                        category: 'productivity',
                        description: 'Panel de control completo para aplicaciones SaaS con analytics, gesti√≥n de usuarios y configuraciones avanzadas'
                    },
                    {
                        id: 'ecommerce_mobile',
                        name: 'E-commerce App',
                        category: 'ecommerce',
                        description: 'Aplicaci√≥n m√≥vil de comercio electr√≥nico con cat√°logo, carrito de compras, pagos integrados y seguimiento de pedidos'
                    },
                    {
                        id: 'fitness_tracker',
                        name: 'Fitness Tracker',
                        category: 'healthtech',
                        description: 'App de seguimiento de actividad f√≠sica con monitoreo de ejercicios, nutrici√≥n, metas personales y progreso'
                    },
                    {
                        id: 'learning_platform',
                        name: 'Plataforma Educativa',
                        category: 'edtech',
                        description: 'Sistema de gesti√≥n de aprendizaje con cursos interactivos, evaluaciones, certificados y progreso del estudiante'
                    },
                    {
                        id: 'fintech_wallet',
                        name: 'Wallet Digital',
                        category: 'fintech',
                        description: 'Billetera digital para gesti√≥n de finanzas personales, pagos, transferencias y visualizaci√≥n de gastos'
                    },
                    {
                        id: 'social_network',
                        name: 'Red Social',
                        category: 'social',
                        description: 'Plataforma social para compartir contenido, seguir usuarios, mensajer√≠a y feed personalizado'
                    }
                ];
            }
            
            static applyTemplate(templateId) {
                const template = this.getTemplates().find(t => t.id === templateId);
                if (template) {
                    document.getElementById('projectName').value = template.name;
                    document.getElementById('projectCategory').value = template.category;
                    document.getElementById('projectDescription').value = template.description;
                    
                    // Limpiar errores si existen
                    ProjectValidator.clearAllErrors();
                    
                    showToast(`Template "${template.name}" aplicado`, 'success');
                }
            }
        }
        
        // Versioning de proyectos
        class ProjectVersioning {
            static createVersion(projectId, versionName) {
                const project = state.projects.find(p => p.id === projectId);
                if (!project) return null;
                
                const versions = this.getVersions(projectId);
                const version = {
                    id: generateId(),
                    projectId,
                    name: versionName || `Versi√≥n ${versions.length + 1}`,
                    data: JSON.parse(JSON.stringify(project.data)),
                    createdAt: new Date().toISOString(),
                    projectName: project.name
                };
                
                // Guardar versi√≥n en localStorage
                const allVersions = JSON.parse(localStorage.getItem('flowforge_versions') || '[]');
                allVersions.push(version);
                
                // Limitar a 50 versiones totales
                if (allVersions.length > 50) {
                    allVersions.shift();
                }
                
                localStorage.setItem('flowforge_versions', JSON.stringify(allVersions));
                return version;
            }
            
            static getVersions(projectId) {
                const allVersions = JSON.parse(localStorage.getItem('flowforge_versions') || '[]');
                return allVersions.filter(v => v.projectId === projectId)
                    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            }
            
            static restoreVersion(versionId) {
                const allVersions = JSON.parse(localStorage.getItem('flowforge_versions') || '[]');
                const version = allVersions.find(v => v.id === versionId);
                
                if (version) {
                    const project = state.projects.find(p => p.id === version.projectId);
                    if (project) {
                        project.data = JSON.parse(JSON.stringify(version.data));
                        project.updatedAt = new Date().toISOString();
                        saveProjects();
                        return true;
                    }
                }
                return false;
            }
            
            static deleteVersion(versionId) {
                const allVersions = JSON.parse(localStorage.getItem('flowforge_versions') || '[]');
                const filtered = allVersions.filter(v => v.id !== versionId);
                localStorage.setItem('flowforge_versions', JSON.stringify(filtered));
            }
        }
        
        // Compartir proyectos
        class ProjectSharing {
            static generateShareLink(projectId) {
                const project = state.projects.find(p => p.id === projectId);
                if (!project) return null;
                
                // Crear objeto compartible (sin IDs internos)
                const shareData = {
                    name: project.name,
                    category: project.category,
                    description: project.description,
                    data: project.data,
                    sharedAt: new Date().toISOString()
                };
                
                try {
                    const encoded = btoa(encodeURIComponent(JSON.stringify(shareData)));
                    return `${window.location.origin}${window.location.pathname}?import=${encoded}`;
                } catch (e) {
                    console.error('Error generating share link:', e);
                    return null;
                }
            }
            
            static importFromLink() {
                const params = new URLSearchParams(window.location.search);
                const importData = params.get('import');
                
                if (importData) {
                    try {
                        const decoded = JSON.parse(decodeURIComponent(atob(importData)));
                        
                        // Generar ID √∫nico para proyecto importado
                        let projectId = generateId();
                        while (state.projects.some(p => p.id === projectId)) {
                            projectId = generateId();
                        }
                        
                        // Crear nuevo proyecto con datos importados
                        const project = {
                            id: projectId,
                            name: decoded.name + ' (Importado)',
                            category: decoded.category,
                            description: decoded.description,
                            data: decoded.data,
                            overviewApproved: true,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        };
                        
                        state.projects.push(project);
                        saveProjects();
                        renderProjectsList();
                        
                        showToast(`Proyecto "${decoded.name}" importado exitosamente`, 'success');
                        
                        // Abrir proyecto importado
                        openProject(project.id);
                        
                        // Limpiar URL
                        window.history.replaceState({}, document.title, window.location.pathname);
                        
                        return true;
                    } catch (e) {
                        console.error('Error importing project:', e);
                        showToast('Error al importar proyecto. Enlace inv√°lido.', 'error');
                        return false;
                    }
                }
                return false;
            }
        }
        
        // Mejoras de accesibilidad
        class A11yEnhancements {
            static init() {
                this.addARIALabels();
                this.setupKeyboardNav();
                this.setupFocusManagement();
            }
            
            static addARIALabels() {
                // Agregar labels descriptivos a elementos sin texto
                document.querySelectorAll('button:not([aria-label])').forEach(btn => {
                    if (btn.textContent.trim()) {
                        btn.setAttribute('aria-label', btn.textContent.trim());
                    }
                });
                
                // Marcar regiones importantes
                const projectsList = document.getElementById('projectsList');
                if (projectsList) {
                    projectsList.setAttribute('role', 'list');
                    projectsList.setAttribute('aria-label', 'Lista de proyectos');
                }
            }
            
            static setupKeyboardNav() {
                // Ya implementado en setupEventListeners, pero agregar navegaci√≥n por tabs
                document.addEventListener('keydown', (e) => {
                    // Tab navigation en modales
                    if (e.key === 'Tab') {
                        const activeModal = document.querySelector('.modal-overlay.active');
                        if (activeModal) {
                            const focusableElements = activeModal.querySelectorAll(
                                'button, input, textarea, select, a[href]'
                            );
                            const firstElement = focusableElements[0];
                            const lastElement = focusableElements[focusableElements.length - 1];
                            
                            if (e.shiftKey && document.activeElement === firstElement) {
                                e.preventDefault();
                                lastElement.focus();
                            } else if (!e.shiftKey && document.activeElement === lastElement) {
                                e.preventDefault();
                                firstElement.focus();
                            }
                        }
                    }
                });
            }
            
            static setupFocusManagement() {
                // Guardar y restaurar foco cuando se abren/cierran modales
                let lastFocusedElement = null;
                
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.attributeName === 'class') {
                                if (modal.classList.contains('active')) {
                                    lastFocusedElement = document.activeElement;
                                    // Enfocar primer elemento del modal
                                    setTimeout(() => {
                                        const firstInput = modal.querySelector('input, button');
                                        if (firstInput) firstInput.focus();
                                    }, 100);
                                } else if (lastFocusedElement) {
                                    lastFocusedElement.focus();
                                    lastFocusedElement = null;
                                }
                            }
                        });
                    });
                    
                    observer.observe(modal, { attributes: true });
                });
            }
            
            static announceToScreenReader(message) {
                const announcement = document.createElement('div');
                announcement.setAttribute('role', 'status');
                announcement.setAttribute('aria-live', 'polite');
                announcement.className = 'sr-only';
                announcement.textContent = message;
                
                document.body.appendChild(announcement);
                
                setTimeout(() => announcement.remove(), 1000);
            }
        }
        
        // Control de alineaci√≥n entre input y output
        class AlignmentAnalyzer {
            static analyze(userInput, generatedOutput) {
                // Usar descripci√≥n expandida si existe, sino la descripci√≥n original
                const referenceDescription = userInput.expandedDescription || userInput.description;
                
                const inputKeywords = this.extractKeywords(referenceDescription);
                const outputKeywords = this.extractKeywords(generatedOutput.whatIs);
                
                const analysis = {
                    score: 0,
                    inputKeywords,
                    outputKeywords,
                    matched: [],
                    missing: [],
                    extra: [],
                    keywordCoverage: 0,
                    semanticAlignment: 0,
                    categoryAlignment: 0,
                    recommendations: []
                };
                
                // Comparar keywords
                inputKeywords.forEach(keyword => {
                    const found = outputKeywords.some(out => 
                        out.toLowerCase().includes(keyword.toLowerCase()) ||
                        keyword.toLowerCase().includes(out.toLowerCase())
                    );
                    
                    if (found) {
                        analysis.matched.push(keyword);
                    } else {
                        analysis.missing.push(keyword);
                    }
                });
                
                // Identificar keywords extra en output
                outputKeywords.forEach(keyword => {
                    const found = inputKeywords.some(inp => 
                        inp.toLowerCase().includes(keyword.toLowerCase()) ||
                        keyword.toLowerCase().includes(inp.toLowerCase())
                    );
                    
                    if (!found && !analysis.matched.includes(keyword)) {
                        analysis.extra.push(keyword);
                    }
                });
                
                // Calcular keyword coverage
                analysis.keywordCoverage = inputKeywords.length > 0 
                    ? (analysis.matched.length / inputKeywords.length) * 100 
                    : 100;
                
                // Verificar alineaci√≥n de categor√≠a
                analysis.categoryAlignment = this.analyzeCategoryAlignment(
                    userInput.category, 
                    generatedOutput
                );
                
                // Analizar alineaci√≥n sem√°ntica (longitud y complejidad)
                analysis.semanticAlignment = this.analyzeSemanticAlignment(
                    userInput.description,
                    generatedOutput.whatIs
                );
                
                // Calcular score final
                analysis.score = Math.round(
                    (analysis.keywordCoverage * 0.5) +
                    (analysis.categoryAlignment * 0.25) +
                    (analysis.semanticAlignment * 0.25)
                );
                
                // Generar recomendaciones
                analysis.recommendations = this.generateRecommendations(analysis, userInput);
                
                return analysis;
            }
            
            static extractKeywords(text) {
                if (!text) return [];
                
                // Stopwords en espa√±ol
                const stopwords = new Set([
                    'el', 'la', 'de', 'que', 'y', 'a', 'en', 'un', 'ser', 'se', 'no', 'haber',
                    'por', 'con', 'su', 'para', 'como', 'estar', 'tener', 'le', 'lo', 'todo',
                    'pero', 'mas', 'm√°s', 'hacer', 'o', 'poder', 'decir', 'este', 'ir', 'otro',
                    'ese', 'si', 's√≠', 'me', 'ya', 'ver', 'porque', 'dar', 'cuando', 'muy',
                    'sin', 'vez', 'mucho', 'saber', 'qu√©', 'sobre', 'mi', 'alguno', 'mismo',
                    'yo', 'tambi√©n', 'hasta', 'a√±o', 'dos', 'querer', 'entre', 'as√≠', 'primero',
                    'desde', 'grande', 'eso', 'ni', 'nos', 'llegar', 'pasar', 'tiempo', 'ella',
                    'una', 'las', 'los', 'del', 'al', 'es', 'son', 'esta', 'estas', 'estos',
                    'esos', 'fue', 'sus', 'les', 'nos', 'una', 'sus'
                ]);
                
                // Extraer palabras significativas
                const words = text.toLowerCase()
                    .replace(/[^\w\s√°√©√≠√≥√∫√º√±]/g, ' ')
                    .split(/\s+/)
                    .filter(word => word.length > 3 && !stopwords.has(word));
                
                // Contar frecuencia
                const frequency = {};
                words.forEach(word => {
                    frequency[word] = (frequency[word] || 0) + 1;
                });
                
                // Retornar palabras m√°s frecuentes (m√°ximo 15)
                return Object.entries(frequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 15)
                    .map(([word]) => word);
            }
            
            static analyzeCategoryAlignment(category, output) {
                if (!category || category === '') return 100;
                
                const categoryKeywords = {
                    fintech: ['financ', 'dinero', 'pago', 'transacci√≥n', 'banco', 'inversi√≥n', 'ahorro'],
                    healthtech: ['salud', 'bienestar', 'm√©dic', 'ejercicio', 'fitness', 'nutrici√≥n'],
                    edtech: ['educaci√≥n', 'aprendizaje', 'curso', 'estudiante', 'ense√±anza', 'conocimiento'],
                    ecommerce: ['compra', 'venta', 'producto', 'tienda', 'carrito', 'pedido', 'comercio'],
                    social: ['social', 'comunidad', 'red', 'compartir', 'seguir', 'amigo', 'conexi√≥n'],
                    productivity: ['productividad', 'tarea', 'proyecto', 'gesti√≥n', 'organizaci√≥n', 'eficiencia'],
                    entertainment: ['entretenimiento', 'contenido', 'video', 'pel√≠cula', 'serie', 'diversi√≥n'],
                    travel: ['viaje', 'destino', 'hotel', 'vuelo', 'reserva', 'turismo', 'aventura'],
                    food: ['comida', 'restaurante', 'delivery', 'receta', 'men√∫', 'gastronom√≠a']
                };
                
                const keywords = categoryKeywords[category] || [];
                const outputText = (output.whatIs + ' ' + output.targetAudience).toLowerCase();
                
                const matches = keywords.filter(keyword => 
                    outputText.includes(keyword)
                );
                
                return keywords.length > 0 
                    ? (matches.length / keywords.length) * 100 
                    : 100;
            }
            
            static analyzeSemanticAlignment(input, output) {
                // Verificar que el output no sea demasiado gen√©rico
                const inputLength = input.split(' ').length;
                const outputLength = output.split(' ').length;
                
                // El output debe ser m√°s largo pero no excesivamente
                const expansionRatio = outputLength / inputLength;
                
                // Ideal: 3-8x la longitud del input
                if (expansionRatio < 2) return 50; // Muy corto
                if (expansionRatio > 15) return 60; // Demasiado largo, posible desviaci√≥n
                if (expansionRatio >= 3 && expansionRatio <= 8) return 100; // √ìptimo
                if (expansionRatio >= 2 && expansionRatio < 3) return 80; // Aceptable pero corto
                if (expansionRatio > 8 && expansionRatio <= 15) return 75; // Aceptable pero largo
                
                return 70;
            }
            
            static generateRecommendations(analysis, userInput) {
                const recommendations = [];
                
                if (analysis.score < 60) {
                    recommendations.push({
                        type: 'critical',
                        message: 'El resultado generado se ha desviado significativamente de tu descripci√≥n original.',
                        action: 'regenerate'
                    });
                }
                
                if (analysis.missing.length > 3) {
                    recommendations.push({
                        type: 'warning',
                        message: `Faltan ${analysis.missing.length} conceptos clave de tu descripci√≥n: ${analysis.missing.slice(0, 3).join(', ')}...`,
                        action: 'refine'
                    });
                }
                
                if (analysis.extra.length > 5) {
                    recommendations.push({
                        type: 'info',
                        message: 'Se agregaron conceptos que no mencionaste. Revisa si se alinean con tu visi√≥n.',
                        action: 'review'
                    });
                }
                
                if (analysis.categoryAlignment < 50) {
                    recommendations.push({
                        type: 'warning',
                        message: `El contenido generado no parece alineado con la categor√≠a "${userInput.category}".`,
                        action: 'adjust_category'
                    });
                }
                
                if (recommendations.length === 0) {
                    recommendations.push({
                        type: 'success',
                        message: 'Excelente alineaci√≥n entre tu descripci√≥n y el resultado generado.',
                        action: 'approve'
                    });
                }
                
                return recommendations;
            }
            
            static getScoreLevel(score) {
                if (score >= 80) return { level: 'excellent', label: 'Excelente', icon: '‚úì' };
                if (score >= 65) return { level: 'good', label: 'Buena', icon: '‚úì' };
                if (score >= 50) return { level: 'fair', label: 'Aceptable', icon: '‚ö†' };
                return { level: 'poor', label: 'Baja', icon: '‚úï' };
            }
        }
        
        // Arquitectura de pantallas con l√≥gica de consistencia
        class ScreenArchitecture {
            static analyzeScreenStructure(appType, category) {
                const isMobile = appType.includes('Mobile First');
                const isWeb = appType.includes('Web First');
                
                return {
                    generalRules: this.defineGeneralRules(category),
                    globalElements: this.defineGlobalElements(isMobile, isWeb),
                    screenTypes: this.defineScreenTypes(),
                    layoutPatterns: this.defineLayoutPatterns(isMobile, isWeb, category),
                    navigationFlow: this.defineNavigationFlow(isMobile, isWeb),
                    consistencyRules: this.defineConsistencyRules(isMobile, isWeb)
                };
            }
            
            static defineGeneralRules(category) {
                return {
                    language: {
                        primary: 'Espa√±ol (es-ES)',
                        fallback: 'Ingl√©s (en-US) como segundo idioma',
                        rules: [
                            'Todo el contenido UI debe estar en espa√±ol',
                            'Mensajes de error y validaci√≥n en espa√±ol',
                            'Textos de ayuda y tooltips en espa√±ol',
                            'Notificaciones push en espa√±ol',
                            'Emails transaccionales en espa√±ol',
                            'Formateo de fechas: dd/mm/yyyy',
                            'Formateo de n√∫meros: 1.234,56 (coma decimal)',
                            'Moneda: $ (pesos) o especificar seg√∫n regi√≥n'
                        ],
                        localization: {
                            dateFormat: 'dd/MM/yyyy',
                            timeFormat: 'HH:mm (24 horas)',
                            numberFormat: '1.234,56',
                            currency: 'ARS, MXN, COP seg√∫n regi√≥n',
                            rtl: false
                        }
                    },
                    branding: {
                        naming: {
                            rule: 'Nombre comercial consistente en toda la aplicaci√≥n',
                            locations: [
                                'Splash screen: Logo + nombre completo',
                                'App bar/Header: Logo o nombre reducido',
                                'Login/Registro: Nombre completo con tagline',
                                'Emails: Nombre en header y firma',
                                'Notificaciones: Nombre como remitente',
                                'App stores: Nombre id√©ntico',
                                'Redes sociales: Nombre y handle consistentes'
                            ],
                            formats: {
                                full: 'NombreCompleto‚Ñ¢',
                                short: 'Nombre',
                                tagline: 'NombreCompleto - Tu descripci√≥n en una l√≠nea',
                                domain: 'nombreapp.com',
                                handle: '@nombreapp'
                            }
                        },
                        icon: {
                            rule: '√çcono representativo y consistente',
                            usage: [
                                'App icon: Versi√≥n completa con degradado/sombras',
                                'Favicon: Versi√≥n simplificada 16x16, 32x32',
                                'PWA icons: 192x192, 512x512',
                                'Touch icons: 180x180 (iOS)',
                                'Splash screen: Versi√≥n animada o est√°tica',
                                'Notificaciones: Small icon (24x24dp Android)',
                                'Header: Mini logo 32-40px height'
                            ],
                            specifications: {
                                style: 'Moderno, minimalista, memorable',
                                colors: 'M√°ximo 3 colores principales',
                                contrast: 'Funciona en fondos claros y oscuros',
                                scalability: 'Legible desde 16x16 hasta 512x512',
                                uniqueness: 'Distintivo, evita s√≠mbolos gen√©ricos'
                            },
                            placement: {
                                center: 'En splash, login, empty states',
                                left: 'En headers/app bars',
                                inline: 'En textos como marca registrada‚Ñ¢'
                            }
                        },
                        colorScheme: {
                            rule: 'Paleta de colores corporativa consistente',
                            application: [
                                'Logo: Colores oficiales de marca',
                                'Botones primarios: Color de marca',
                                'Links: Color de marca o variante',
                                'Splash: Background con colores de marca',
                                'Theme: Modo claro/oscuro con marca'
                            ]
                        }
                    },
                    seo: {
                        rule: 'Todas las pantallas y contenidos optimizados para SEO',
                        general: [
                            'T√≠tulos descriptivos √∫nicos por pantalla (50-60 caracteres)',
                            'Meta descriptions relevantes (150-160 caracteres)',
                            'URLs amigables: /producto/nombre-producto (no /prod?id=123)',
                            'Estructura de headings: H1 √∫nico, H2-H6 jer√°rquicos',
                            'Im√°genes con alt text descriptivo',
                            'Links internos con anchor text relevante',
                            'Breadcrumbs para navegaci√≥n y contexto',
                            'Schema markup (JSON-LD) para contenido estructurado'
                        ],
                        contentRules: [
                            'H1: T√≠tulo principal √∫nico por p√°gina (incluir keyword principal)',
                            'H2: Secciones principales (incluir variaciones de keywords)',
                            'H3-H6: Subsecciones en orden jer√°rquico',
                            'P√°rrafos: 150-300 palabras, legibles, con keywords naturales',
                            'Negritas: Para t√©rminos importantes y keywords secundarias',
                            'Links: Texto descriptivo (no "click aqu√≠"), 2-5 por p√°gina',
                            'Listas: Usar <ul> y <ol> para mejorar escaneabilidad',
                            'Im√°genes: Alt text descriptivo con keywords cuando aplique'
                        ],
                        technical: [
                            'Title tag: <title>Keyword Principal - Nombre App</title>',
                            'Meta description: <meta name="description" content="Descripci√≥n con CTA">',
                            'Canonical URL: <link rel="canonical" href="URL_oficial">',
                            'Open Graph: og:title, og:description, og:image para redes',
                            'Twitter Cards: twitter:card, twitter:title, twitter:image',
                            'Robots meta: <meta name="robots" content="index, follow">',
                            'Hreflang: <link rel="alternate" hreflang="es" href="...">',
                            'Sitemap XML: Actualizado con todas las URLs',
                            'Robots.txt: Permitir crawling de contenido p√∫blico'
                        ],
                        performance: [
                            'Core Web Vitals: LCP <2.5s, FID <100ms, CLS <0.1',
                            'Mobile-first: Responsive design optimizado',
                            'Lazy loading: Im√°genes y contenido below-the-fold',
                            'Compresi√≥n: Gzip/Brotli para HTML, CSS, JS',
                            'Cach√©: Headers apropiados para recursos est√°ticos',
                            'CDN: Servir assets desde CDN',
                            'Minificaci√≥n: CSS y JS minificados',
                            'Critical CSS: Inline CSS cr√≠tico en <head>'
                        ],
                        accessibility: [
                            'HTML sem√°ntico: <header>, <nav>, <main>, <article>, <footer>',
                            'ARIA labels: Complementar HTML cuando sea necesario',
                            'Skip links: Para navegaci√≥n por teclado',
                            'Focus visible: Indicadores claros de foco',
                            'Contraste: WCAG AA m√≠nimo (4.5:1)',
                            'Texto escalable: No usar px fijos, usar rem/em',
                            'Formularios: Labels asociados con inputs',
                            'Tablas: Uso correcto de <th>, <caption>, scope'
                        ],
                        byScreenType: {
                            landing: {
                                priority: 'M√°xima',
                                focus: 'Keywords principales, conversi√≥n',
                                elements: [
                                    'H1 con keyword principal',
                                    'Hero con valor √∫nico y CTA',
                                    'Features con H2s descriptivos',
                                    'Social proof (testimonios)',
                                    'FAQ con schema markup',
                                    'Footer con links importantes'
                                ]
                            },
                            product: {
                                priority: 'Alta',
                                focus: 'Long-tail keywords, especificaciones',
                                elements: [
                                    'H1 con nombre de producto',
                                    'Schema Product markup',
                                    'Descripci√≥n detallada 300+ palabras',
                                    'Im√°genes con alt text',
                                    'Reviews con schema Review markup',
                                    'Breadcrumbs',
                                    'Productos relacionados con links'
                                ]
                            },
                            blog: {
                                priority: 'Alta',
                                focus: 'Keywords informacionales, autoridad',
                                elements: [
                                    'H1 con t√≠tulo del art√≠culo',
                                    'Schema Article markup',
                                    'Fecha de publicaci√≥n y actualizaci√≥n',
                                    'Autor con bio',
                                    'Tabla de contenidos',
                                    'Im√°genes con captions',
                                    'Links a art√≠culos relacionados',
                                    'CTA para conversi√≥n'
                                ]
                            },
                            category: {
                                priority: 'Media-Alta',
                                focus: 'Keywords de categor√≠a, navegaci√≥n',
                                elements: [
                                    'H1 con nombre de categor√≠a',
                                    'Descripci√≥n breve 150+ palabras',
                                    'Filtros y ordenamiento',
                                    'Productos/Items con t√≠tulos descriptivos',
                                    'Paginaci√≥n con rel="prev" y rel="next"',
                                    'Breadcrumbs',
                                    'Subcategor√≠as con links'
                                ]
                            },
                            auth: {
                                priority: 'Baja',
                                focus: 'Indexaci√≥n limitada',
                                elements: [
                                    'Meta robots: noindex, nofollow',
                                    'Canonical apuntando a versi√≥n principal',
                                    'T√≠tulo gen√©rico',
                                    'Sin optimizaci√≥n de contenido'
                                ]
                            }
                        }
                    },
                    contentGuidelines: {
                        tone: {
                            rule: 'Tono consistente en toda la aplicaci√≥n',
                            characteristics: [
                                'Claro y directo',
                                'Profesional pero accesible',
                                'Evitar jerga t√©cnica innecesaria',
                                'Usar "t√∫" o "usted" consistentemente',
                                'Positivo y orientado a soluciones',
                                'Emp√°tico con el usuario'
                            ]
                        },
                        copywriting: {
                            buttons: [
                                'Verbos de acci√≥n: "Crear cuenta", "Comenzar ahora", "Ver m√°s"',
                                'Claro sobre la acci√≥n: No usar "OK" o "Continuar" gen√©ricos',
                                'Contextual: "Guardar cambios", "Publicar art√≠culo"'
                            ],
                            errors: [
                                'Explicar qu√© sali√≥ mal',
                                'Indicar c√≥mo solucionarlo',
                                'Tono emp√°tico: "No pudimos... Intenta..."',
                                'Evitar culpar al usuario'
                            ],
                            emptyStates: [
                                'Explicar por qu√© est√° vac√≠o',
                                'Sugerir acci√≥n siguiente',
                                'Tono alentador',
                                'CTA claro'
                            ],
                            success: [
                                'Confirmar acci√≥n completada',
                                'Indicar siguiente paso si aplica',
                                'Tono positivo'
                            ]
                        },
                        microcopy: {
                            placeholders: 'Ejemplos claros: "nombre@ejemplo.com"',
                            helperText: 'Guiar sin abrumar: "M√≠nimo 8 caracteres"',
                            tooltips: 'Informaci√≥n adicional concisa',
                            labels: 'Descriptivos y cortos: "Correo electr√≥nico"'
                        }
                    }
                };
            }
            
            static defineGlobalElements(isMobile, isWeb) {
                const elements = {
                    persistent: {
                        header: {
                            present: true,
                            excludeFrom: ['splash', 'onboarding', 'auth_screens'],
                            content: ['brand_logo', 'primary_navigation', 'user_menu', 'notifications'],
                            variants: {
                                mobile: {
                                    height: '56px',
                                    layout: 'compact',
                                    elements: ['hamburger_menu', 'logo', 'search_icon', 'profile_icon']
                                },
                                web: {
                                    height: '64-72px',
                                    layout: 'expanded',
                                    elements: ['logo', 'main_nav', 'search_bar', 'notifications', 'user_dropdown']
                                }
                            }
                        },
                        footer: {
                            present: isWeb,
                            excludeFrom: ['splash', 'onboarding', 'modal_views', 'detail_views'],
                            content: ['links', 'legal', 'social_media', 'contact'],
                            note: 'En mobile se reemplaza por Bottom Navigation'
                        },
                        bottomNav: {
                            present: isMobile,
                            excludeFrom: ['splash', 'onboarding', 'auth_screens', 'fullscreen_views'],
                            content: ['4-5 primary navigation items'],
                            positions: ['home', 'search/explore', 'main_action', 'profile', 'more'],
                            height: '56px',
                            behavior: 'fixed_bottom'
                        },
                        sidebar: {
                            present: isWeb,
                            type: 'conditional',
                            showOn: ['dashboard', 'settings', 'admin', 'content_management'],
                            excludeFrom: ['landing', 'auth', 'checkout', 'focused_tasks'],
                            width: '240-280px',
                            collapsible: true
                        }
                    },
                    contextual: {
                        breadcrumbs: {
                            present: isWeb,
                            showOn: ['deep_navigation', 'hierarchical_content'],
                            placement: 'below_header'
                        },
                        backButton: {
                            present: isMobile,
                            showOn: ['detail_views', 'sub_pages', 'forms'],
                            behavior: 'native_navigation'
                        },
                        fab: {
                            present: 'conditional',
                            showOn: ['list_views', 'dashboard'],
                            action: 'primary_creation_action',
                            position: 'bottom_right',
                            size: isMobile ? '56px' : '64px'
                        }
                    }
                };
                
                return elements;
            }
            
            static defineScreenTypes() {
                return {
                    fullscreen: {
                        types: ['splash', 'onboarding', 'media_viewer', 'video_player'],
                        characteristics: 'Sin header, footer, ni navegaci√≥n visible',
                        purpose: 'Inmersi√≥n total o primera impresi√≥n'
                    },
                    authScreens: {
                        types: ['login', 'register', 'forgot_password', 'verification'],
                        characteristics: 'Solo logo/brand, sin navegaci√≥n principal',
                        purpose: 'Enfoque total en autenticaci√≥n'
                    },
                    mainScreens: {
                        types: ['home', 'dashboard', 'feed', 'explore'],
                        characteristics: 'Header + Bottom Nav (mobile) o Header + Sidebar (web)',
                        purpose: 'Navegaci√≥n completa disponible'
                    },
                    detailScreens: {
                        types: ['item_detail', 'profile_view', 'article'],
                        characteristics: 'Header con back + contenido enfocado',
                        purpose: 'Informaci√≥n detallada de un elemento'
                    },
                    formScreens: {
                        types: ['create', 'edit', 'settings', 'checkout'],
                        characteristics: 'Header + barra de progreso + acciones de guardado',
                        purpose: 'Captura o edici√≥n de datos'
                    },
                    modalScreens: {
                        types: ['overlays', 'bottom_sheets', 'dialogs'],
                        characteristics: 'Sobre contenido existente, con backdrop',
                        purpose: 'Acciones r√°pidas sin cambiar contexto'
                    }
                };
            }
            
            static defineLayoutPatterns(isMobile, isWeb, category) {
                const patterns = {
                    mobile: {
                        list: {
                            pattern: 'Single column vertical scroll',
                            spacing: '8-16px entre items',
                            cardHeight: 'Variable seg√∫n contenido',
                            useFor: ['feeds', 'listas', 'resultados']
                        },
                        grid: {
                            pattern: '2-3 columns',
                            spacing: '8-12px gap',
                            aspectRatio: '1:1 o 4:3',
                            useFor: ['gallery', 'productos', 'categor√≠as']
                        },
                        tabs: {
                            pattern: 'Horizontal scrollable tabs',
                            placement: 'Below header',
                            behavior: 'Swipeable content',
                            useFor: ['categorizaci√≥n', 'filtros', 'secciones']
                        }
                    },
                    web: {
                        sidebar_content: {
                            pattern: 'Sidebar (240-280px) + Main content (flex-1)',
                            sidebar: 'Fixed o sticky',
                            content: 'Scrollable independently',
                            useFor: ['dashboards', 'admin', 'settings']
                        },
                        grid_responsive: {
                            pattern: 'CSS Grid con auto-fit',
                            columns: '3-4 en desktop, 2 en tablet, 1 en mobile',
                            gap: '24-32px',
                            useFor: ['cat√°logos', 'portfolios', 'cards']
                        },
                        split_view: {
                            pattern: 'Master-detail (40/60 o 50/50)',
                            behavior: 'List + Detail side by side',
                            responsive: 'Stack en mobile',
                            useFor: ['email', 'messaging', 'file_browser']
                        }
                    }
                };
                
                return patterns;
            }
            
            static defineNavigationFlow(isMobile, isWeb) {
                return {
                    hierarchy: {
                        level_1: {
                            screens: ['Home', 'Main categories', 'Primary features'],
                            access: isMobile ? 'Bottom navigation' : 'Top navigation bar',
                            maxItems: isMobile ? '5' : '6-8'
                        },
                        level_2: {
                            screens: ['Sub-categories', 'Filtered views', 'Feature details'],
                            access: isMobile ? 'In-screen navigation' : 'Dropdown menus o sidebar',
                            maxDepth: '2-3 levels recommended'
                        },
                        level_3: {
                            screens: ['Item details', 'Edit forms', 'Specific content'],
                            access: 'Direct links from level 2',
                            backBehavior: 'Return to previous level'
                        }
                    },
                    patterns: {
                        stack_navigation: {
                            platform: 'Mobile primary',
                            behavior: 'Push/Pop screen stack',
                            animation: 'Slide from right',
                            backButton: 'Always visible in header'
                        },
                        tab_navigation: {
                            platform: 'Both',
                            behavior: 'Switch between parallel sections',
                            persistence: 'Maintain state per tab',
                            indication: 'Active tab highlighted'
                        },
                        modal_navigation: {
                            platform: 'Both',
                            behavior: 'Temporary overlay',
                            dismiss: 'X button, backdrop click, swipe down (mobile)',
                            useCase: 'Forms, confirmations, quick actions'
                        }
                    }
                };
            }
            
            static defineConsistencyRules(isMobile, isWeb) {
                return {
                    spacing: {
                        rule: 'Sistema de espaciado consistente (8px base)',
                        scale: '4px, 8px, 12px, 16px, 24px, 32px, 48px, 64px',
                        application: 'Margins, paddings, gaps',
                        exception: 'Ajustes finos de 1-2px para alineaci√≥n visual'
                    },
                    typography: {
                        rule: 'Jerarqu√≠a tipogr√°fica consistente',
                        levels: {
                            h1: 'T√≠tulos principales de p√°gina',
                            h2: 'Secciones principales',
                            h3: 'Subsecciones',
                            body: 'Contenido regular',
                            caption: 'Texto secundario, metadatos'
                        },
                        consistency: 'Mismo nivel = mismo tama√±o en toda la app'
                    },
                    colors: {
                        rule: 'Uso sem√°ntico consistente',
                        mapping: {
                            primary: 'CTAs principales, links, elementos interactivos',
                            secondary: 'Acciones secundarias',
                            success: 'Confirmaciones, estados positivos',
                            error: 'Errores, alertas, acciones destructivas',
                            warning: 'Advertencias, estados de atenci√≥n',
                            info: 'Informaci√≥n neutral, tips'
                        }
                    },
                    components: {
                        rule: 'Componentes reutilizables con variantes',
                        principle: 'Misma funci√≥n = mismo componente en toda la app',
                        example: 'Todos los botones primarios usan el mismo estilo',
                        variants: 'size (sm, md, lg), state (default, hover, active, disabled)'
                    },
                    animations: {
                        rule: 'Transiciones consistentes',
                        duration: {
                            instant: '<100ms (feedback inmediato)',
                            quick: '100-200ms (micro-interactions)',
                            normal: '200-300ms (transiciones est√°ndar)',
                            slow: '300-500ms (animaciones complejas)'
                        },
                        easing: 'ease-out para entrada, ease-in para salida',
                        principle: 'Misma acci√≥n = misma animaci√≥n'
                    },
                    states: {
                        rule: 'Estados visuales consistentes para elementos interactivos',
                        required: ['default', 'hover', 'active/pressed', 'focused', 'disabled'],
                        loading: 'Skeleton o spinner seg√∫n contexto',
                        error: 'Mensajes claros con acciones de recuperaci√≥n'
                    }
                };
            }
            
            static enrichScreenData(screen, screenIndex, totalScreens, architecture) {
                // Determinar tipo de pantalla
                const screenType = this.determineScreenType(screen.screen);
                const globalElements = this.getApplicableGlobalElements(screenType, architecture.globalElements);
                const layoutPattern = this.suggestLayoutPattern(screen, architecture.layoutPatterns);
                
                return {
                    ...screen,
                    position: `${screenIndex + 1}/${totalScreens}`,
                    screenType: screenType,
                    navigation: {
                        level: this.determineNavigationLevel(screenIndex),
                        accessFrom: this.determineAccessPoint(screen.screen, screenIndex),
                        backBehavior: screenIndex > 0 ? 'Return to previous screen' : 'N/A'
                    },
                    layout: {
                        pattern: layoutPattern.pattern,
                        recommendation: layoutPattern.recommendation,
                        responsiveBehavior: layoutPattern.responsive
                    },
                    globalElements: {
                        header: globalElements.header,
                        footer: globalElements.footer,
                        bottomNav: globalElements.bottomNav,
                        sidebar: globalElements.sidebar,
                        note: globalElements.note
                    },
                    interactions: this.defineInteractions(screen),
                    stateManagement: this.defineStateManagement(screen),
                    accessibilityNotes: this.generateA11yNotes(screen)
                };
            }
            
            static determineScreenType(screenName) {
                const name = screenName.toLowerCase();
                if (name.includes('splash') || name.includes('loading')) return 'fullscreen';
                if (name.includes('onboarding')) return 'fullscreen';
                if (name.includes('login') || name.includes('registro') || name.includes('auth')) return 'authScreens';
                if (name.includes('home') || name.includes('dashboard') || name.includes('feed')) return 'mainScreens';
                if (name.includes('detalle') || name.includes('detail') || name.includes('view') || name.includes('perfil')) return 'detailScreens';
                if (name.includes('crear') || name.includes('editar') || name.includes('settings') || name.includes('config')) return 'formScreens';
                return 'mainScreens';
            }
            
            static getApplicableGlobalElements(screenType, globalElements) {
                const excluded = {
                    fullscreen: ['header', 'footer', 'bottomNav', 'sidebar'],
                    authScreens: ['bottomNav', 'sidebar'],
                    mainScreens: [],
                    detailScreens: ['sidebar'],
                    formScreens: ['sidebar']
                };
                
                const excludeList = excluded[screenType] || [];
                
                return {
                    header: !excludeList.includes('header') ? globalElements.persistent.header : null,
                    footer: !excludeList.includes('footer') ? globalElements.persistent.footer : null,
                    bottomNav: !excludeList.includes('bottomNav') ? globalElements.persistent.bottomNav : null,
                    sidebar: !excludeList.includes('sidebar') ? globalElements.persistent.sidebar : null,
                    note: excludeList.length > 0 ? `Excluye: ${excludeList.join(', ')}` : 'Todos los elementos globales aplicables'
                };
            }
            
            static determineNavigationLevel(index) {
                if (index <= 3) return 'Level 1 (Primary)';
                if (index <= 7) return 'Level 2 (Secondary)';
                return 'Level 3 (Detail)';
            }
            
            static determineAccessPoint(screenName, index) {
                const name = screenName.toLowerCase();
                if (index === 0) return 'App launch / Deep link';
                if (index === 1) return 'First-time user flow';
                if (name.includes('home') || name.includes('dashboard')) return 'Bottom navigation / Main menu';
                if (name.includes('perfil') || name.includes('profile')) return 'Bottom navigation / User menu';
                if (name.includes('b√∫squeda') || name.includes('search')) return 'Bottom navigation / Search icon';
                if (name.includes('notif')) return 'Notification icon / Push notification';
                return 'Navigation from previous screen / Deep link';
            }
            
            static suggestLayoutPattern(screen, layoutPatterns) {
                const name = screen.screen.toLowerCase();
                const desc = screen.description.toLowerCase();
                
                if (name.includes('dashboard') || name.includes('home')) {
                    return {
                        pattern: 'Mixed layout',
                        recommendation: 'Hero section + Grid/List de cards',
                        responsive: 'Stack vertically en mobile'
                    };
                }
                
                if (name.includes('lista') || name.includes('feed') || desc.includes('lista')) {
                    return {
                        pattern: 'Vertical list',
                        recommendation: 'Single column con infinite scroll o pagination',
                        responsive: 'Mantener single column'
                    };
                }
                
                if (name.includes('detalle') || name.includes('detail')) {
                    return {
                        pattern: 'Single column detail',
                        recommendation: 'Hero image/media + Content sections + Related items',
                        responsive: 'Sticky header en scroll'
                    };
                }
                
                if (name.includes('settings') || name.includes('config')) {
                    return {
                        pattern: 'Grouped list',
                        recommendation: 'Sections con headers + List items',
                        responsive: 'Collapsible sections en mobile'
                    };
                }
                
                return {
                    pattern: 'Flexible layout',
                    recommendation: 'Adaptar seg√∫n contenido espec√≠fico',
                    responsive: 'Mobile-first approach'
                };
            }
            
            static defineInteractions(screen) {
                const interactions = [];
                
                screen.elements.forEach(element => {
                    const el = element.toLowerCase();
                    if (el.includes('button') || el.includes('cta') || el.includes('btn')) {
                        interactions.push(`Tap/Click en ${element} -> Acci√≥n espec√≠fica`);
                    }
                    if (el.includes('card')) {
                        interactions.push(`Tap en ${element} -> Navegar a detalle`);
                    }
                    if (el.includes('search') || el.includes('b√∫squeda')) {
                        interactions.push(`Focus en ${element} -> Mostrar teclado y sugerencias`);
                    }
                    if (el.includes('scroll')) {
                        interactions.push(`Scroll -> Cargar m√°s contenido (infinite scroll o pagination)`);
                    }
                });
                
                return interactions.length > 0 ? interactions : ['Interactions basadas en elementos de la pantalla'];
            }
            
            static defineStateManagement(screen) {
                return {
                    initialState: 'Loading -> Mostrar skeleton/spinner',
                    successState: 'Contenido cargado y visible',
                    errorState: 'Mensaje de error + Retry button',
                    emptyState: 'Ilustraci√≥n + Mensaje + CTA cuando no hay contenido',
                    offlineState: screen.screen.includes('Splash') ? 'N/A' : 'Cached content o mensaje de sin conexi√≥n'
                };
            }
            
            static generateA11yNotes(screen) {
                return [
                    'Todos los elementos interactivos deben ser accesibles por teclado',
                    'Labels descriptivos en todos los inputs y botones',
                    'Contraste m√≠nimo 4.5:1 para texto normal, 3:1 para texto grande',
                    'Anuncios de screen reader para cambios din√°micos',
                    `Enfoque visible en navegaci√≥n por teclado`,
                    'Tama√±o m√≠nimo de touch target: 44x44px (mobile)'
                ];
            }
        }
        
        // Renderizador optimizado
        class OptimizedRenderer {
            static #renderedProjects = new Map();
            
            static renderProjectsList(projects, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                const sorted = projects.sort((a, b) => 
                    new Date(b.updatedAt) - new Date(a.updatedAt)
                );
                
                // Crear un fragment para optimizar el DOM
                const fragment = document.createDocumentFragment();
                const existingIds = new Set();
                
                sorted.forEach(project => {
                    existingIds.add(project.id);
                    const cached = this.#renderedProjects.get(project.id);
                    
                    // Solo re-renderizar si cambi√≥
                    if (!cached || cached.updatedAt !== project.updatedAt || 
                        cached.name !== project.name || cached.isActive !== (state.currentProjectId === project.id)) {
                        
                        const element = this.#createProjectElement(project);
                        
                        if (cached && cached.element.parentNode) {
                            cached.element.replaceWith(element);
                        } else {
                            fragment.appendChild(element);
                        }
                        
                        this.#renderedProjects.set(project.id, {
                            element,
                            updatedAt: project.updatedAt,
                            name: project.name,
                            isActive: state.currentProjectId === project.id
                        });
                    } else if (cached.element.parentNode !== container) {
                        fragment.appendChild(cached.element);
                    }
                });
                
                // Remover elementos que ya no existen
                this.#renderedProjects.forEach((value, key) => {
                    if (!existingIds.has(key)) {
                        value.element.remove();
                        this.#renderedProjects.delete(key);
                    }
                });
                
                if (fragment.children.length > 0) {
                    container.innerHTML = '';
                    container.appendChild(fragment);
                }
            }
            
            static #createProjectElement(project) {
                const div = document.createElement('div');
                div.className = `project-item ${state.currentProjectId === project.id ? 'active' : ''}`;
                div.dataset.id = project.id;
                div.onclick = () => openProject(project.id);
                
                const info = document.createElement('div');
                info.className = 'project-item-info';
                
                const name = document.createElement('div');
                name.className = 'project-item-name';
                name.textContent = project.name;
                
                const date = document.createElement('div');
                date.className = 'project-item-date';
                date.textContent = formatDate(project.updatedAt);
                
                info.appendChild(name);
                info.appendChild(date);
                
                const actions = document.createElement('div');
                actions.className = 'project-item-actions';
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'project-action-btn';
                deleteBtn.textContent = '‚úï';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteProject(project.id);
                };
                
                actions.appendChild(deleteBtn);
                
                div.appendChild(info);
                div.appendChild(actions);
                
                return div;
            }
            
            static clear() {
                this.#renderedProjects.clear();
            }
        }
        
        // Validaci√≥n de inputs
        class ProjectValidator {
            static validate(data) {
                const errors = [];
                
                // Validaci√≥n de nombre
                if (!data.name || data.name.trim().length < 3) {
                    errors.push({ field: 'projectName', message: 'El nombre debe tener al menos 3 caracteres' });
                } else if (data.name.length > 50) {
                    errors.push({ field: 'projectName', message: 'El nombre no puede exceder 50 caracteres' });
                }
                
                // Validaci√≥n de descripci√≥n
                if (!data.description || data.description.trim().length < 20) {
                    errors.push({ field: 'projectDescription', message: 'La descripci√≥n debe tener al menos 20 caracteres' });
                } else if (data.description.length > 500) {
                    errors.push({ field: 'projectDescription', message: 'La descripci√≥n no puede exceder 500 caracteres' });
                }
                
                return { valid: errors.length === 0, errors };
            }
            
            static clearFieldError(fieldId) {
                const field = document.getElementById(fieldId);
                const error = document.getElementById(fieldId + 'Error');
                if (field) field.classList.remove('error');
                if (error) {
                    error.classList.remove('active');
                    error.textContent = '';
                }
            }
            
            static showFieldError(fieldId, message) {
                const field = document.getElementById(fieldId);
                const error = document.getElementById(fieldId + 'Error');
                if (field) field.classList.add('error');
                if (error) {
                    error.classList.add('active');
                    error.textContent = message;
                }
            }
            
            static clearAllErrors() {
                ['projectName', 'projectDescription'].forEach(fieldId => {
                    this.clearFieldError(fieldId);
                });
            }
        }
        
        // Sanitizaci√≥n de contenido
        class DOMSanitizer {
            static sanitize(text) {
                const temp = document.createElement('div');
                temp.textContent = text;
                return temp.innerHTML;
            }
            
            static sanitizeHTML(html) {
                const temp = document.createElement('div');
                temp.innerHTML = html;
                
                // Remover scripts y event handlers
                temp.querySelectorAll('script').forEach(el => el.remove());
                temp.querySelectorAll('*').forEach(el => {
                    Array.from(el.attributes).forEach(attr => {
                        if (attr.name.startsWith('on')) {
                            el.removeAttribute(attr.name);
                        }
                    });
                });
                
                return temp.innerHTML;
            }
        }
        
        // Manejo de errores de API
        class APIErrorHandler {
            static handle(error, response) {
                if (!response) {
                    return {
                        type: 'NETWORK_ERROR',
                        message: 'Error de conexi√≥n. Verifica tu internet.',
                        userMessage: 'No se pudo conectar con el servidor. Verifica tu conexi√≥n a internet.',
                        fallback: true
                    };
                }
                
                switch (response.status) {
                    case 401:
                        return {
                            type: 'AUTH_ERROR',
                            message: 'API Key inv√°lida',
                            userMessage: 'La API Key proporcionada no es v√°lida. Por favor verifica tu clave.',
                            action: 'FOCUS_API_KEY'
                        };
                    
                    case 429:
                        return {
                            type: 'RATE_LIMIT',
                            message: 'L√≠mite de solicitudes alcanzado',
                            userMessage: 'Has alcanzado el l√≠mite de solicitudes. Intenta nuevamente en unos minutos.',
                            retryAfter: response.headers?.get('retry-after') || 60
                        };
                    
                    case 500:
                    case 502:
                    case 503:
                        return {
                            type: 'SERVER_ERROR',
                            message: 'Error del servidor',
                            userMessage: 'El servidor est√° experimentando problemas. Usando generaci√≥n local como alternativa.',
                            fallback: true
                        };
                    
                    case 400:
                        return {
                            type: 'BAD_REQUEST',
                            message: 'Solicitud inv√°lida',
                            userMessage: 'Los datos enviados no son v√°lidos. Intenta con una descripci√≥n diferente.',
                            fallback: false
                        };
                    
                    default:
                        return {
                            type: 'UNKNOWN_ERROR',
                            message: `Error desconocido: ${response.status}`,
                            userMessage: 'Ocurri√≥ un error inesperado. Usando generaci√≥n local como alternativa.',
                            fallback: true
                        };
                }
            }
        }
        
        // Gestor de guardado autom√°tico
        class AutoSaveManager {
            constructor(saveFunction, interval = 2000) {
                this.saveFunction = saveFunction;
                this.interval = interval;
                this.isDirty = false;
                this.isSaving = false;
                this.saveTimeout = null;
            }
            
            markDirty() {
                this.isDirty = true;
                this.updateIndicator('pending');
                this.scheduleSave();
            }
            
            async scheduleSave() {
                if (this.saveTimeout) clearTimeout(this.saveTimeout);
                
                this.saveTimeout = setTimeout(async () => {
                    if (this.isDirty && !this.isSaving) {
                        this.isSaving = true;
                        this.updateIndicator('saving');
                        
                        try {
                            await this.saveFunction();
                            this.isDirty = false;
                            this.updateIndicator('saved');
                            
                            setTimeout(() => {
                                if (!this.isDirty) {
                                    this.updateIndicator('idle');
                                }
                            }, 2000);
                        } catch (error) {
                            console.error('Error saving:', error);
                            this.updateIndicator('error');
                            setTimeout(() => this.updateIndicator('idle'), 3000);
                        }
                        
                        this.isSaving = false;
                    }
                }, this.interval);
            }
            
            updateIndicator(state) {
                const indicator = document.getElementById('saveIndicator');
                if (!indicator) return;
                
                const states = {
                    idle: { text: '', className: '' },
                    pending: { text: '‚óè Cambios sin guardar', className: '' },
                    saving: { text: '‚ü≥ Guardando...', className: 'saving' },
                    saved: { text: '‚úì Guardado', className: 'saved' },
                    error: { text: '‚úï Error al guardar', className: 'error' }
                };
                
                const stateConfig = states[state];
                indicator.textContent = stateConfig.text;
                indicator.className = 'save-indicator ' + stateConfig.className;
            }
        }
        
        // Gestor de progreso de carga
        class ProgressTracker {
            constructor(steps) {
                this.steps = steps;
                this.currentStep = 0;
            }
            
            async execute() {
                for (let i = 0; i < this.steps.length; i++) {
                    this.currentStep = i;
                    const step = this.steps[i];
                    
                    this.updateProgress(step.name, (i / this.steps.length) * 100);
                    
                    try {
                        await step.action();
                    } catch (error) {
                        console.error(`Error in step ${step.name}:`, error);
                        throw error;
                    }
                }
                
                this.updateProgress('Completado', 100);
            }
            
            updateProgress(stepName, percentage) {
                const loadingText = document.getElementById('loadingText');
                const progressContainer = document.getElementById('loadingProgress');
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                
                if (loadingText) loadingText.textContent = stepName;
                if (progressContainer) progressContainer.style.display = 'block';
                if (progressFill) progressFill.style.width = percentage + '%';
                if (progressText) progressText.textContent = Math.round(percentage) + '%';
            }
        }
        
        // ========== State Management ==========
        let state = {
            projects: [],
            currentProjectId: null,
            projectToDelete: null,
            currentFlowTier: 'mvp',
            selectedPromptSections: ['whatIs', 'targetAudience', 'needsSolved', 'appType', 'flowsMvp', 'tokens'],
            searchQuery: '',
            activeFilter: 'all',
            isLoadingProject: false
        };
        
        let autoSaveManager = null;
        let historyManager = null;
        let searchDebounceTimer = null;

        // ========== Initialization ==========
        document.addEventListener('DOMContentLoaded', () => {
            loadProjects();
            setupEventListeners();
            renderProjectsList();
            
            // Inicializar mejoras de accesibilidad
            A11yEnhancements.init();
            
            // Verificar si hay proyecto para importar
            ProjectSharing.importFromLink();
        });

        function setupEventListeners() {
            // Tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });

            // Tier buttons
            document.querySelectorAll('.tier-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTier(btn.dataset.tier));
            });

            // Prompt section toggles
            document.querySelectorAll('.prompt-section-toggle').forEach(btn => {
                btn.addEventListener('click', () => togglePromptSection(btn));
            });

            // API Key persistence con encriptaci√≥n
            const apiKeyInput = document.getElementById('apiKeyInput');
            const savedKey = SecureStorage.getSecure('flowforge_apikey');
            if (savedKey) {
                apiKeyInput.value = savedKey;
            }
            apiKeyInput.addEventListener('change', () => {
                SecureStorage.setSecure('flowforge_apikey', apiKeyInput.value);
            });
            
            // B√∫squeda con debounce
            const searchInput = document.getElementById('projectSearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    if (searchDebounceTimer) clearTimeout(searchDebounceTimer);
                    searchDebounceTimer = setTimeout(() => {
                        state.searchQuery = e.target.value;
                        renderProjectsList();
                    }, 300);
                });
            }
            
            // Atajos de teclado globales
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + S para guardar
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    if (state.currentProjectId) {
                        saveCurrentProject();
                    }
                }
                
                // Ctrl/Cmd + Z para deshacer
                if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undoChange();
                }
                
                // Ctrl/Cmd + Y o Ctrl/Cmd + Shift + Z para rehacer
                if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {
                    e.preventDefault();
                    redoChange();
                }
                
                // Escape para cerrar modales
                if (e.key === 'Escape') {
                    closeDeleteModal();
                    closeVersionsModal();
                    closeShareModal();
                }
            });
        }

        // ========== Project Management ==========
        function loadProjects() {
            const saved = localStorage.getItem('flowforge_projects');
            if (saved) {
                state.projects = JSON.parse(saved);
            }
        }

        function saveProjects() {
            // Limit to 10 projects
            if (state.projects.length > 10) {
                state.projects = state.projects.slice(-10);
            }
            localStorage.setItem('flowforge_projects', JSON.stringify(state.projects));
        }

        function createNewProject() {
            state.currentProjectId = null;
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('projectForm').classList.add('active');
            document.getElementById('projectView').classList.remove('active');
            document.getElementById('headerTitle').textContent = 'Nuevo Proyecto';
            document.getElementById('versionsBtn').style.display = 'none';
            document.getElementById('shareBtn').style.display = 'none';
            document.getElementById('exportBtn').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'none';
            
            // Ocultar controles de undo/redo
            const undoRedoControls = document.getElementById('undoRedoControls');
            if (undoRedoControls) {
                undoRedoControls.style.display = 'none';
            }
            
            // Clear form
            document.getElementById('projectName').value = '';
            document.getElementById('projectCategory').value = '';
            document.getElementById('projectDescription').value = '';
            document.getElementById('expandedDescription').value = '';
            
            // Reset expanded description section
            const expandedGroup = document.getElementById('expandedDescriptionGroup');
            expandedGroup.style.display = 'none';
            
            const expandedTextarea = document.getElementById('expandedDescription');
            expandedTextarea.readOnly = true;
            expandedTextarea.style.background = 'var(--bg-primary)';
            expandedTextarea.style.opacity = '1';
            expandedTextarea.style.border = '1px solid var(--border-color)';
            expandedTextarea.style.boxShadow = 'none';
            
            document.getElementById('regenerateExpandedBtn').style.display = 'none';
            document.getElementById('editExpandedBtn').style.display = 'none';
            document.getElementById('expandBtn').style.display = 'block';
            document.getElementById('expandBtn').disabled = false;
            
            // Disable generate button until expanded
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.style.opacity = '0.5';
            generateBtn.style.cursor = 'not-allowed';
            document.getElementById('generateHint').style.display = 'block';
            
            // Limpiar errores
            ProjectValidator.clearAllErrors();

            // Update sidebar active state
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('active');
            });
        }

        function openProject(projectId) {
            const project = state.projects.find(p => p.id === projectId);
            if (!project) return;

            state.currentProjectId = projectId;
            state.isLoadingProject = true; // Flag para evitar auto-save durante carga
            
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('projectForm').classList.remove('active');
            document.getElementById('projectView').classList.add('active');
            document.getElementById('headerTitle').textContent = project.name;
            document.getElementById('versionsBtn').style.display = 'block';
            document.getElementById('shareBtn').style.display = 'block';
            document.getElementById('exportBtn').style.display = 'block';
            document.getElementById('saveBtn').style.display = 'block';

            // Hide overview if already approved
            if (project.overviewApproved) {
                document.getElementById('overviewSection').style.display = 'none';
                document.getElementById('mainTabs').style.display = 'block';
                document.getElementById('promptBuilder').style.display = 'block';
            } else {
                document.getElementById('overviewSection').style.display = 'block';
                document.getElementById('mainTabs').style.display = 'none';
                document.getElementById('promptBuilder').style.display = 'none';
            }

            // Populate data
            populateProjectData(project);

            // Update sidebar active state
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.toggle('active', item.dataset.id === projectId);
            });

            // Update prompt
            updatePromptOutput();
            
            // Configurar autosave para este proyecto
            setupAutoSave();
            
            // Inicializar historyManager
            if (!historyManager) {
                historyManager = new HistoryManager();
            } else {
                historyManager.clear();
            }
            
            // Capturar estado inicial
            historyManager.push(captureProjectState());
            
            // Mostrar controles de undo/redo
            const undoRedoControls = document.getElementById('undoRedoControls');
            if (undoRedoControls) {
                undoRedoControls.style.display = 'flex';
            }
            
            // Desactivar flag despu√©s de un peque√±o delay
            setTimeout(() => {
                state.isLoadingProject = false;
            }, 100);
        }
        
        function setupAutoSave() {
            if (autoSaveManager) {
                autoSaveManager = null;
            }
            
            autoSaveManager = new AutoSaveManager(async () => {
                return new Promise((resolve) => {
                    saveCurrentProject();
                    resolve();
                });
            });
            
            // A√±adir listeners a todos los textareas editables
            const editableFields = [
                'whatIs', 'targetAudience', 'needsSolved', 
                'differentiators', 'elevatorPitch', 'appType',
                'uiComponents', 'metricsDetail'
            ];
            
            editableFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.removeEventListener('input', handleFieldInput);
                    field.addEventListener('input', handleFieldInput);
                }
            });
        }
        
        function handleFieldInput(e) {
            // No activar auto-save durante la carga inicial del proyecto
            if (state.isLoadingProject) return;
            
            if (autoSaveManager) {
                autoSaveManager.markDirty();
            }
            
            // Capturar estado para undo/redo (con debounce)
            if (historyManager) {
                if (this.historyTimeout) clearTimeout(this.historyTimeout);
                this.historyTimeout = setTimeout(() => {
                    historyManager.push(captureProjectState());
                }, 1000);
            }
        }

        function populateProjectData(project) {
            // Analizar alineaci√≥n si existe input original
            let alignmentHTML = '';
            if (project.userInput && !project.overviewApproved) {
                const analysis = AlignmentAnalyzer.analyze(project.userInput, project.data);
                alignmentHTML = renderAlignmentPanel(analysis, project.userInput);
            }
            
            // Overview con panel de alineaci√≥n
            const expandedDescInfo = project.expandedDescription ? `
                <br><strong style="color: var(--accent-primary); margin-top: 12px; display: block;">Descripci√≥n Expandida:</strong>
                <div style="color: var(--text-secondary); font-style: italic; margin-top: 8px; padding: 12px; background: var(--surface-color); border-radius: var(--radius-sm); line-height: 1.6;">${DOMSanitizer.sanitize(project.expandedDescription)}</div>
            ` : '';
            
            document.getElementById('overviewContent').innerHTML = `
                ${alignmentHTML}
                <div style="display: grid; gap: 16px;">
                    <div class="content-block" style="margin: 0;">
                        <div class="content-block-body" style="padding: 16px;">
                            <strong style="color: var(--accent-primary);">Nombre:</strong> ${DOMSanitizer.sanitize(project.name)}<br>
                            <strong style="color: var(--accent-primary);">Categor√≠a:</strong> ${DOMSanitizer.sanitize(project.category || 'Sin categor√≠a')}<br>
                            <strong style="color: var(--accent-primary);">Descripci√≥n Original:</strong> ${DOMSanitizer.sanitize(project.description)}
                            ${expandedDescInfo}
                        </div>
                    </div>
                    <div class="content-block" style="margin: 0;">
                        <div class="content-block-header">
                            <span class="content-block-title">üéØ Resultado Generado</span>
                        </div>
                        <div class="content-block-body" style="padding: 16px; max-height: 400px; overflow-y: auto;">
                            <strong style="color: var(--accent-primary); display: block; margin-bottom: 8px;">¬øQu√© es?</strong>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; white-space: pre-wrap;">${DOMSanitizer.sanitize(project.data?.whatIs || '')}</p>
                        </div>
                    </div>
                </div>
            `;

            // Description fields
            document.getElementById('whatIs').value = project.data?.whatIs || '';
            document.getElementById('targetAudience').value = project.data?.targetAudience || '';
            document.getElementById('needsSolved').value = project.data?.needsSolved || '';
            document.getElementById('differentiators').value = project.data?.differentiators || '';
            document.getElementById('elevatorPitch').value = project.data?.elevatorPitch || '';
            document.getElementById('appType').value = project.data?.appType || '';
            document.getElementById('uiComponents').value = project.data?.uiComponents || '';
            document.getElementById('metricsDetail').value = project.data?.metricsDetail || '';

            // Render flows
            renderFlows(project.data?.flows || {});

            // Render tokens
            renderTokens(project.data?.tokens || {});

            // Render metrics
            renderMetrics(project.data?.metrics || []);
            
            // Render general rules, architecture and consistency
            // Si el proyecto no tiene arquitectura (proyectos antiguos), regenerarla
            let architecture = project.data?.flows?._architecture;
            if (!architecture && project.data?.flows && project.data?.appType) {
                console.log('Regenerando arquitectura para proyecto antiguo...');
                architecture = ScreenArchitecture.analyzeScreenStructure(project.data.appType, project.category);
                // Guardar la arquitectura regenerada
                if (!project.data.flows._architecture) {
                    project.data.flows._architecture = architecture;
                    saveProjects();
                }
            }
            
            renderGeneralRules(architecture?.generalRules);
            renderArchitecture(architecture);
            renderConsistency(architecture?.consistencyRules);
        }

        function saveCurrentProject() {
            if (!state.currentProjectId) return;

            const projectIndex = state.projects.findIndex(p => p.id === state.currentProjectId);
            if (projectIndex === -1) return;
            
            const project = state.projects[projectIndex];

            // Verificar si hay cambios reales
            const newData = {
                whatIs: document.getElementById('whatIs').value,
                targetAudience: document.getElementById('targetAudience').value,
                needsSolved: document.getElementById('needsSolved').value,
                differentiators: document.getElementById('differentiators').value,
                elevatorPitch: document.getElementById('elevatorPitch').value,
                appType: document.getElementById('appType').value,
                uiComponents: document.getElementById('uiComponents').value,
                metricsDetail: document.getElementById('metricsDetail').value
            };
            
            // Comparar con datos actuales
            const hasChanges = Object.keys(newData).some(key => {
                return project.data[key] !== newData[key];
            });
            
            if (!hasChanges) return; // No hay cambios, no guardar

            // Actualizar solo el proyecto actual
            Object.assign(project.data, newData);
            project.updatedAt = new Date().toISOString();
            
            // Actualizar el proyecto en el array sin modificar otros
            state.projects[projectIndex] = project;

            saveProjects();
            renderProjectsList();
            
            // Solo mostrar toast si es guardado manual (no autosave)
            if (!autoSaveManager || !autoSaveManager.isSaving) {
                showToast('Proyecto guardado correctamente', 'success');
            }
        }

        function deleteProject(projectId) {
            state.projectToDelete = projectId;
            document.getElementById('deleteModal').classList.add('active');
        }

        function closeDeleteModal() {
            state.projectToDelete = null;
            document.getElementById('deleteModal').classList.remove('active');
        }

        function confirmDelete() {
            if (!state.projectToDelete) return;

            state.projects = state.projects.filter(p => p.id !== state.projectToDelete);
            saveProjects();
            renderProjectsList();

            if (state.currentProjectId === state.projectToDelete) {
                state.currentProjectId = null;
                document.getElementById('welcomeScreen').style.display = 'flex';
                document.getElementById('projectForm').classList.remove('active');
                document.getElementById('projectView').classList.remove('active');
                document.getElementById('headerTitle').textContent = 'Bienvenido a FlowForge';
                document.getElementById('exportBtn').style.display = 'none';
                document.getElementById('saveBtn').style.display = 'none';
            }

            closeDeleteModal();
            showToast('Proyecto eliminado', 'info');
        }
        
        function filterProjects(category) {
            state.activeFilter = category;
            
            // Actualizar botones de filtro
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });
            
            renderProjectsList();
        }
        
        function getFilteredProjects() {
            let filtered = [...state.projects];
            
            // Aplicar b√∫squeda
            if (state.searchQuery) {
                filtered = ProjectSearch.search(filtered, state.searchQuery);
            }
            
            // Aplicar filtro de categor√≠a
            if (state.activeFilter !== 'all') {
                filtered = filtered.filter(p => p.category === state.activeFilter);
            }
            
            return filtered;
        }
        
        function renderProjectsList() {
            const container = document.getElementById('projectsList');
            
            const filtered = getFilteredProjects();
            
            if (filtered.length === 0) {
                const message = state.searchQuery || state.activeFilter !== 'all' 
                    ? 'No se encontraron proyectos'
                    : 'No hay proyectos guardados';
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÅ</div>
                        <p>${message}</p>
                    </div>
                `;
                return;
            }

            // Usar renderizado optimizado
            OptimizedRenderer.renderProjectsList(filtered, 'projectsList');
        }
        
        function undoChange() {
            if (!historyManager || !historyManager.canUndo()) return;
            
            const previousState = historyManager.undo();
            if (previousState) {
                restoreProjectState(previousState);
                showToast('Cambio deshecho', 'info');
            }
        }
        
        function redoChange() {
            if (!historyManager || !historyManager.canRedo()) return;
            
            const nextState = historyManager.redo();
            if (nextState) {
                restoreProjectState(nextState);
                showToast('Cambio rehecho', 'info');
            }
        }
        
        function restoreProjectState(projectData) {
            // Restaurar datos en los textareas
            const fields = [
                'whatIs', 'targetAudience', 'needsSolved',
                'differentiators', 'elevatorPitch', 'appType',
                'uiComponents', 'metricsDetail'
            ];
            
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element && projectData[field] !== undefined) {
                    element.value = projectData[field];
                }
            });
            
            // Marcar como modificado para autosave
            if (autoSaveManager) {
                autoSaveManager.markDirty();
            }
        }
        
        function captureProjectState() {
            const fields = [
                'whatIs', 'targetAudience', 'needsSolved',
                'differentiators', 'elevatorPitch', 'appType',
                'uiComponents', 'metricsDetail'
            ];
            
            const state = {};
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    state[field] = element.value;
                }
            });
            
            return state;
        }
        
        function renderAlignmentPanel(analysis, userInput) {
            const scoreInfo = AlignmentAnalyzer.getScoreLevel(analysis.score);
            
            // Generar HTML de keywords comparados
            const matchedHTML = analysis.matched.slice(0, 8).map(kw => 
                `<span class="keyword-tag matched">‚úì ${DOMSanitizer.sanitize(kw)}</span>`
            ).join('');
            
            const missingHTML = analysis.missing.slice(0, 5).map(kw => 
                `<span class="keyword-tag missing">‚úï ${DOMSanitizer.sanitize(kw)}</span>`
            ).join('');
            
            const extraHTML = analysis.extra.slice(0, 5).map(kw => 
                `<span class="keyword-tag extra">‚ö† ${DOMSanitizer.sanitize(kw)}</span>`
            ).join('');
            
            // Generar warnings si hay desviaci√≥n
            let warningsHTML = '';
            const criticalRecommendations = analysis.recommendations.filter(r => r.type === 'critical' || r.type === 'warning');
            
            if (criticalRecommendations.length > 0) {
                warningsHTML = criticalRecommendations.map(rec => `
                    <div class="deviation-warning">
                        <span class="icon">‚ö†Ô∏è</span>
                        <div class="deviation-content">
                            <div class="deviation-title">Posible Desviaci√≥n Detectada</div>
                            <div class="deviation-text">${rec.message}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            return `
                <div class="alignment-panel">
                    <div class="alignment-header">
                        <div class="alignment-title">
                            üéØ Control de Alineaci√≥n
                        </div>
                        <div class="alignment-score">
                            <span style="font-size: 0.85rem; color: var(--text-muted);">Puntuaci√≥n:</span>
                            <div class="score-badge ${scoreInfo.level}">
                                <span>${scoreInfo.icon}</span>
                                <span>${analysis.score}%</span>
                                <span>${scoreInfo.label}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${warningsHTML}
                    
                    <div class="alignment-metrics">
                        <div class="metric-item">
                            <div class="metric-label">Cobertura de Conceptos</div>
                            <div class="metric-value">
                                ${Math.round(analysis.keywordCoverage)}%
                                <span style="font-size: 0.75rem; color: var(--text-muted);">
                                    (${analysis.matched.length}/${analysis.inputKeywords.length})
                                </span>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Alineaci√≥n de Categor√≠a</div>
                            <div class="metric-value">
                                ${Math.round(analysis.categoryAlignment)}%
                                <span style="font-size: 0.75rem; color: var(--text-muted);">
                                    ${userInput.category || 'N/A'}
                                </span>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Alineaci√≥n Sem√°ntica</div>
                            <div class="metric-value">
                                ${Math.round(analysis.semanticAlignment)}%
                                <span style="font-size: 0.75rem; color: var(--text-muted);">
                                    Expansi√≥n apropiada
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="keyword-comparison">
                        <div class="keyword-section">
                            <div class="keyword-section-title">‚úì Conceptos Encontrados (${analysis.matched.length})</div>
                            <div class="keyword-list">
                                ${matchedHTML || '<span style="color: var(--text-muted); font-size: 0.8rem;">Ninguno</span>'}
                            </div>
                        </div>
                        ${analysis.missing.length > 0 ? `
                        <div class="keyword-section" style="margin-top: 10px;">
                            <div class="keyword-section-title">‚úï Conceptos Faltantes (${analysis.missing.length})</div>
                            <div class="keyword-list">
                                ${missingHTML}
                                ${analysis.missing.length > 5 ? `<span style="color: var(--text-muted); font-size: 0.75rem;">+${analysis.missing.length - 5} m√°s</span>` : ''}
                            </div>
                        </div>
                        ` : ''}
                        ${analysis.extra.length > 0 ? `
                        <div class="keyword-section" style="margin-top: 10px;">
                            <div class="keyword-section-title">‚ö† Conceptos Adicionales (${analysis.extra.length})</div>
                            <div class="keyword-list">
                                ${extraHTML}
                                ${analysis.extra.length > 5 ? `<span style="color: var(--text-muted); font-size: 0.75rem;">+${analysis.extra.length - 5} m√°s</span>` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="refinement-controls">
                        ${analysis.score < 60 ? `
                            <button class="refinement-btn primary" onclick="regenerateWithFocus()">
                                ‚Üª Regenerar con M√°s Foco
                            </button>
                        ` : ''}
                        <button class="refinement-btn" onclick="adjustGeneration()">
                            üéØ Ajustar Manualmente
                        </button>
                        <button class="refinement-btn" onclick="showAlignmentDetails()">
                            üîç Ver Detalles Completos
                        </button>
                    </div>
                </div>
            `;
        }
        
        // ========== Versioning Functions ==========
        function showVersions() {
            if (!state.currentProjectId) return;
            
            const versions = ProjectVersioning.getVersions(state.currentProjectId);
            const container = document.getElementById('versionsList');
            
            if (versions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <p style="font-size: 0.85rem; color: var(--text-muted);">No hay versiones guardadas para este proyecto</p>
                    </div>
                `;
            } else {
                container.innerHTML = versions.map(version => `
                    <div class="version-item">
                        <div class="version-info">
                            <div class="version-name">${DOMSanitizer.sanitize(version.name)}</div>
                            <div class="version-date">${formatDate(version.createdAt)}</div>
                        </div>
                        <div class="version-actions">
                            <button class="version-btn" onclick="restoreVersion('${version.id}')" title="Restaurar esta versi√≥n">‚Üª Restaurar</button>
                            <button class="version-btn" onclick="deleteVersion('${version.id}')" title="Eliminar versi√≥n">‚úï</button>
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('versionNameInput').value = '';
            document.getElementById('versionsModal').classList.add('active');
        }
        
        function createVersion() {
            if (!state.currentProjectId) return;
            
            const versionName = document.getElementById('versionNameInput').value.trim();
            
            if (!versionName) {
                showToast('Ingresa un nombre para la versi√≥n', 'error');
                return;
            }
            
            // Guardar proyecto actual primero
            saveCurrentProject();
            
            const version = ProjectVersioning.createVersion(state.currentProjectId, versionName);
            
            if (version) {
                showToast(`Versi√≥n "${version.name}" creada exitosamente`, 'success');
                showVersions(); // Refrescar lista
            } else {
                showToast('Error al crear versi√≥n', 'error');
            }
        }
        
        function restoreVersion(versionId) {
            if (confirm('¬øRestaurar esta versi√≥n? Los cambios actuales se perder√°n si no los has guardado como versi√≥n.')) {
                if (ProjectVersioning.restoreVersion(versionId)) {
                    // Recargar proyecto
                    const project = state.projects.find(p => p.id === state.currentProjectId);
                    if (project) {
                        populateProjectData(project);
                        showToast('Versi√≥n restaurada exitosamente', 'success');
                        closeVersionsModal();
                        
                        // Limpiar historial de undo/redo
                        if (historyManager) {
                            historyManager.clear();
                            historyManager.push(captureProjectState());
                        }
                    }
                } else {
                    showToast('Error al restaurar versi√≥n', 'error');
                }
            }
        }
        
        function deleteVersion(versionId) {
            if (confirm('¬øEliminar esta versi√≥n permanentemente?')) {
                ProjectVersioning.deleteVersion(versionId);
                showToast('Versi√≥n eliminada', 'info');
                showVersions(); // Refrescar lista
            }
        }
        
        function closeVersionsModal() {
            document.getElementById('versionsModal').classList.remove('active');
        }
        
        // ========== Sharing Functions ==========
        function showShareDialog() {
            if (!state.currentProjectId) return;
            
            const shareLink = ProjectSharing.generateShareLink(state.currentProjectId);
            
            if (shareLink) {
                document.getElementById('shareLinkInput').value = shareLink;
                document.getElementById('qrCodeContainer').style.display = 'none';
                document.getElementById('shareModal').classList.add('active');
            } else {
                showToast('Error al generar enlace para compartir', 'error');
            }
        }
        
        function copyShareLink() {
            const input = document.getElementById('shareLinkInput');
            input.select();
            
            navigator.clipboard.writeText(input.value).then(() => {
                showToast('Enlace copiado al portapapeles', 'success');
            }).catch(() => {
                showToast('Error al copiar enlace', 'error');
            });
        }
        
        function generateQRCode() {
            const shareLink = document.getElementById('shareLinkInput').value;
            const container = document.getElementById('qrCodeContainer');
            
            // Generar QR usando API p√∫blica
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(shareLink)}`;
            
            container.innerHTML = `
                <div class="qr-code-container">
                    <img src="${qrApiUrl}" alt="C√≥digo QR para compartir proyecto" style="max-width: 200px;">
                    <p style="margin-top: 8px; font-size: 0.8rem; color: var(--text-muted);">Escanea para importar el proyecto</p>
                </div>
            `;
            container.style.display = 'block';
        }
        
        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }
        
        // ========== Alignment Control Functions ==========
        async function regenerateWithFocus() {
            if (!state.currentProjectId) return;
            
            const project = state.projects.find(p => p.id === state.currentProjectId);
            if (!project || !project.userInput) return;
            
            if (!confirm('¬øRegenerar el proyecto enfoc√°ndote m√°s en tu descripci√≥n original?')) {
                return;
            }
            
            showLoading('Regenerando con mayor foco en tu descripci√≥n...', true);
            
            try {
                // Regenerar con prompt m√°s estricto
                const newData = await generateProjectDataWithFocus(
                    project.userInput.name,
                    project.userInput.category,
                    project.userInput.description
                );
                
                project.data = newData;
                project.updatedAt = new Date().toISOString();
                
                saveProjects();
                populateProjectData(project);
                
                hideLoading();
                showToast('Proyecto regenerado con mayor alineaci√≥n', 'success');
            } catch (error) {
                hideLoading();
                console.error('Error regenerating:', error);
                showToast('Error al regenerar. Intenta ajustar manualmente.', 'error');
            }
        }
        
        async function generateProjectDataWithFocus(name, category, description) {
            const apiKey = document.getElementById('apiKeyInput').value;
            
            if (apiKey && apiKey.trim()) {
                // Usar API con prompt m√°s estricto
                const enhancedPrompt = `IMPORTANTE: Debes mantenerte ESTRICTAMENTE fiel a la descripci√≥n proporcionada. No agregues funcionalidades o conceptos que no est√©n expl√≠citamente mencionados.

DESCRIPCI√ìN ORIGINAL (MANTENTE FIEL A ESTO): ${description}

Genera un an√°lisis que:
1. Use las MISMAS palabras clave de la descripci√≥n
2. Expanda solo los conceptos YA mencionados
3. No invente funcionalidades adicionales
4. Mantenga el alcance definido por el usuario`;
                
                return await generateWithAPI(name, category, enhancedPrompt, apiKey.trim());
            } else {
                // Regenerar localmente pero m√°s conservador
                return generateLocally(name, category, description, { conservative: true });
            }
        }
        
        function adjustGeneration() {
            if (!state.currentProjectId) return;
            
            const project = state.projects.find(p => p.id === state.currentProjectId);
            if (!project) return;
            
            // Aprobar y permitir edici√≥n manual
            project.overviewApproved = true;
            saveProjects();
            
            document.getElementById('overviewSection').style.display = 'none';
            document.getElementById('mainTabs').style.display = 'block';
            document.getElementById('promptBuilder').style.display = 'block';
            
            // Cambiar todos los textareas a modo editable
            const editableFields = [
                'whatIs', 'targetAudience', 'needsSolved',
                'differentiators', 'elevatorPitch', 'appType',
                'uiComponents', 'metricsDetail'
            ];
            
            editableFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.readOnly = false;
                    field.style.borderColor = 'var(--border-active)';
                }
            });
            
            updatePromptOutput();
            showToast('Modo de edici√≥n manual activado. Ajusta el contenido seg√∫n necesites.', 'info');
        }
        
        function showAlignmentDetails() {
            if (!state.currentProjectId) return;
            
            const project = state.projects.find(p => p.id === state.currentProjectId);
            if (!project || !project.userInput) return;
            
            const analysis = AlignmentAnalyzer.analyze(project.userInput, project.data);
            
            const detailsHTML = `
                <div style="max-height: 400px; overflow-y: auto;">
                    <h4 style="margin-bottom: 12px;">An√°lisis Completo de Alineaci√≥n</h4>
                    
                    <div style="margin-bottom: 16px;">
                        <strong>Tu Descripci√≥n Original:</strong>
                        <p style="background: var(--bg-tertiary); padding: 12px; border-radius: var(--radius-sm); margin-top: 8px; font-size: 0.9rem;">
                            ${DOMSanitizer.sanitize(project.userInput.description)}
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <strong>Conceptos Clave Identificados en tu Descripci√≥n:</strong>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px;">
                            ${analysis.inputKeywords.map(kw => 
                                `<span class="keyword-tag">${DOMSanitizer.sanitize(kw)}</span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <strong>Recomendaciones:</strong>
                        <ul style="margin-top: 8px; padding-left: 20px; color: var(--text-secondary); font-size: 0.9rem;">
                            ${analysis.recommendations.map(rec => 
                                `<li style="margin-bottom: 6px;">${rec.message}</li>`
                            ).join('')}
                        </ul>
                    </div>
                    
                    ${analysis.missing.length > 0 ? `
                    <div style="margin-bottom: 16px;">
                        <strong style="color: var(--error);">Conceptos de tu descripci√≥n que NO aparecen en el resultado:</strong>
                        <div style="margin-top: 8px; color: var(--text-secondary); font-size: 0.9rem;">
                            ${analysis.missing.join(', ')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${analysis.extra.length > 3 ? `
                    <div>
                        <strong style="color: var(--warning);">Conceptos agregados que NO mencionaste:</strong>
                        <div style="margin-top: 8px; color: var(--text-secondary); font-size: 0.9rem;">
                            ${analysis.extra.join(', ')}
                        </div>
                        <p style="margin-top: 8px; font-size: 0.85rem; color: var(--text-muted); font-style: italic;">
                            ¬øEstos conceptos adicionales se alinean con tu visi√≥n? Si no, considera regenerar o ajustar manualmente.
                        </p>
                    </div>
                    ` : ''}
                </div>
            `;
            
            // Crear modal temporal para mostrar detalles
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.innerHTML = `
                <div class="modal" style="max-width: 600px;">
                    <h3 class="modal-title">Detalles de Alineaci√≥n</h3>
                    ${detailsHTML}
                    <div class="modal-actions" style="margin-top: 16px;">
                        <button class="modal-btn cancel" onclick="this.closest('.modal-overlay').remove()">Cerrar</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Cerrar con Escape
            const closeHandler = (e) => {
                if (e.key === 'Escape') {
                    modal.remove();
                    document.removeEventListener('keydown', closeHandler);
                }
            };
            document.addEventListener('keydown', closeHandler);
        }

        // ========== Project Generation ==========
        async function expandDescription() {
            const name = document.getElementById('projectName').value.trim();
            const category = document.getElementById('projectCategory').value;
            const description = document.getElementById('projectDescription').value.trim();

            // Validar campos b√°sicos
            if (!name || !category || !description) {
                showToast('Por favor completa todos los campos antes de expandir la descripci√≥n', 'error');
                return;
            }

            if (description.length < 20) {
                showToast('La descripci√≥n debe tener al menos 20 caracteres', 'error');
                return;
            }

            const expandBtn = document.getElementById('expandBtn');
            const originalText = expandBtn.innerHTML;
            expandBtn.disabled = true;
            expandBtn.innerHTML = '<span style="animation: spin 1s linear infinite; display: inline-block;">‚ü≥</span> Expandiendo...';

            try {
                const expandedText = await generateExpandedDescription(name, category, description);
                
                // Verificar que se haya generado texto
                if (!expandedText || expandedText.trim().length === 0) {
                    throw new Error('No se pudo generar la descripci√≥n expandida');
                }
                
                // Mostrar el campo de descripci√≥n expandida
                document.getElementById('expandedDescriptionGroup').style.display = 'block';
                document.getElementById('expandedDescription').value = expandedText;
                document.getElementById('regenerateExpandedBtn').style.display = 'inline-flex';
                document.getElementById('editExpandedBtn').style.display = 'inline-flex';
                
                // Habilitar el bot√≥n de generar proyecto
                const generateBtn = document.getElementById('generateBtn');
                generateBtn.disabled = false;
                generateBtn.style.opacity = '1';
                generateBtn.style.cursor = 'pointer';
                document.getElementById('generateHint').style.display = 'none';
                
                // Ocultar el bot√≥n de expandir
                expandBtn.style.display = 'none';
                
                showToast('Descripci√≥n expandida correctamente', 'success');
            } catch (error) {
                console.error('Error expandiendo descripci√≥n:', error);
                showToast('Error al expandir la descripci√≥n. Intenta de nuevo.', 'error');
                expandBtn.disabled = false;
                expandBtn.innerHTML = originalText;
            }
        }

        async function generateExpandedDescription(name, category, description) {
            const apiKey = document.getElementById('apiKeyInput')?.value;
            
            if (apiKey && apiKey.trim()) {
                try {
                    return await expandWithAPI(name, category, description, apiKey.trim());
                } catch (error) {
                    console.error('Error con API, usando fallback local:', error);
                    showToast('API no disponible. Usando expansi√≥n local...', 'warning');
                    return expandLocally(name, category, description);
                }
            } else {
                return expandLocally(name, category, description);
            }
        }

        async function expandWithAPI(name, category, description, apiKey) {
            const safeName = DOMSanitizer.sanitize(name);
            const safeCategory = DOMSanitizer.sanitize(category || 'General');
            const safeDescription = DOMSanitizer.sanitize(description);
            
            const prompt = `Eres un experto en UX/UI y product management. El usuario ha proporcionado esta informaci√≥n b√°sica sobre su proyecto:

NOMBRE: ${safeName}
CATEGOR√çA: ${safeCategory}
DESCRIPCI√ìN BREVE: ${safeDescription}

Tu tarea es expandir y refinar esta descripci√≥n breve en una descripci√≥n completa y clara que servir√° como gu√≠a maestra para todo el proceso de dise√±o. La descripci√≥n expandida debe:

1. Clarificar el prop√≥sito central del proyecto
2. Identificar el problema espec√≠fico que resuelve
3. Describir la propuesta de valor principal
4. Definir claramente qu√© hace y qu√© NO hace el producto
5. Establecer el alcance b√°sico de funcionalidades
6. Ser concisa pero completa (2-3 p√°rrafos, m√°ximo 400 palabras)
7. Usar lenguaje claro y profesional
8. Mantener fidelidad absoluta a la intenci√≥n original del usuario

IMPORTANTE: 
- NO inventes funcionalidades que el usuario no mencion√≥
- NO expandas el alcance m√°s all√° de lo que el usuario describi√≥
- SI el usuario fue vago, haz suposiciones razonables basadas en la categor√≠a
- Enf√≥cate en clarificar y estructurar, no en agregar features

Responde √öNICAMENTE con la descripci√≥n expandida, sin introducciones, sin markdown, sin explicaciones adicionales.`;

            // Crear promesa con timeout
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('Timeout')), 15000); // 15 segundos
            });

            const fetchPromise = fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-5-sonnet-20241022',
                    max_tokens: 1024,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });

            try {
                const response = await Promise.race([fetchPromise, timeoutPromise]);

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('API Error:', response.status, errorData);
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.content && data.content[0] && data.content[0].text) {
                    return data.content[0].text.trim();
                } else {
                    throw new Error('Formato de respuesta inesperado');
                }
            } catch (error) {
                console.error('API Error:', error);
                // Lanzar error para que sea manejado por la funci√≥n padre
                throw error;
            }
        }

        function expandLocally(name, category, description) {
            // Expansi√≥n local inteligente basada en patrones
            const categoryContext = {
                fintech: 'soluciones financieras digitales que facilitan transacciones, ahorro, inversi√≥n o gesti√≥n de finanzas personales',
                healthtech: 'tecnolog√≠a de salud y bienestar que conecta pacientes con profesionales o facilita el cuidado de la salud',
                edtech: 'plataformas educativas que mejoran el aprendizaje, la ense√±anza o la gesti√≥n acad√©mica',
                ecommerce: 'comercio electr√≥nico que conecta compradores con productos o servicios',
                social: 'redes sociales o comunidades que facilitan la conexi√≥n e interacci√≥n entre personas',
                productivity: 'herramientas de productividad que ayudan a organizar, gestionar y optimizar tareas o proyectos',
                entertainment: 'entretenimiento digital que ofrece contenido multimedia para el disfrute de los usuarios',
                travel: 'soluciones de viaje que facilitan la planificaci√≥n, reserva o descubrimiento de destinos',
                food: 'plataformas de comida que conectan restaurantes con consumidores o facilitan pedidos',
                other: 'soluciones digitales'
            };

            const context = categoryContext[category] || categoryContext.other;
            
            const expanded = `${name} es una aplicaci√≥n de ${context}. ${description}

Este proyecto se enfoca en resolver problemas espec√≠ficos de los usuarios en el sector ${category}, ofreciendo una experiencia intuitiva y centrada en el usuario. La aplicaci√≥n busca simplificar procesos complejos mediante una interfaz clara y funcionalidades bien definidas.

El alcance del proyecto se limita a las funcionalidades core mencionadas, priorizando una implementaci√≥n s√≥lida y una experiencia de usuario excepcional sobre la cantidad de features. El objetivo es crear un producto viable que resuelva el problema principal de manera efectiva y escalable.`;

            return expanded;
        }

        async function regenerateExpandedDescription() {
            const name = document.getElementById('projectName').value.trim();
            const category = document.getElementById('projectCategory').value;
            const description = document.getElementById('projectDescription').value.trim();

            const regenerateBtn = document.getElementById('regenerateExpandedBtn');
            const originalText = regenerateBtn.innerHTML;
            regenerateBtn.disabled = true;
            regenerateBtn.innerHTML = '<span style="animation: spin 1s linear infinite; display: inline-block;">‚ü≥</span> Regenerando...';

            try {
                const expandedText = await generateExpandedDescription(name, category, description);
                document.getElementById('expandedDescription').value = expandedText;
                showToast('Descripci√≥n regenerada', 'success');
            } catch (error) {
                console.error(error);
                showToast('Error al regenerar. Intenta de nuevo.', 'error');
            } finally {
                regenerateBtn.disabled = false;
                regenerateBtn.innerHTML = originalText;
            }
        }

        function editExpandedDescription() {
            const textarea = document.getElementById('expandedDescription');
            const editBtn = document.getElementById('editExpandedBtn');
            
            if (textarea.readOnly) {
                textarea.readOnly = false;
                textarea.style.background = 'var(--bg-primary)';
                textarea.style.opacity = '1';
                textarea.style.border = '2px solid var(--accent-primary)';
                textarea.style.boxShadow = '0 0 0 3px rgba(99, 102, 241, 0.1)';
                textarea.focus();
                editBtn.innerHTML = '‚úì Guardar';
                editBtn.style.background = 'var(--accent-gradient)';
                editBtn.style.color = 'white';
                editBtn.style.border = 'none';
                showToast('Modo edici√≥n activado. Edita el texto libremente.', 'info');
            } else {
                textarea.readOnly = true;
                textarea.style.background = 'var(--bg-primary)';
                textarea.style.opacity = '1';
                textarea.style.border = '1px solid var(--border-color)';
                textarea.style.boxShadow = 'none';
                editBtn.innerHTML = '‚úé Editar';
                editBtn.style.background = 'var(--bg-tertiary)';
                editBtn.style.color = 'var(--text-secondary)';
                editBtn.style.border = '1px solid var(--border-color)';
                showToast('Cambios guardados correctamente', 'success');
            }
        }

        async function generateProject() {
            const name = document.getElementById('projectName').value.trim();
            const category = document.getElementById('projectCategory').value;
            const description = document.getElementById('projectDescription').value.trim();
            const expandedDescription = document.getElementById('expandedDescription').value.trim();

            // Usar la descripci√≥n expandida si existe, sino la original
            const finalDescription = expandedDescription || description;
            
            // Validar que la descripci√≥n expandida exista
            if (!expandedDescription) {
                showToast('Primero debes expandir la descripci√≥n antes de generar el proyecto', 'error');
                return;
            }

            // Limpiar errores previos
            ProjectValidator.clearAllErrors();

            // Validar datos
            const validation = ProjectValidator.validate({ name, category, description });
            
            if (!validation.valid) {
                validation.errors.forEach(error => {
                    ProjectValidator.showFieldError(error.field, error.message);
                });
                showToast('Por favor corrige los errores en el formulario', 'error');
                return;
            }

            showLoading('Analizando tu proyecto...');

            try {
                const projectData = await generateProjectData(name, category, finalDescription);
                
                // Generar ID √∫nico verificando que no exista
                let projectId = generateId();
                while (state.projects.some(p => p.id === projectId)) {
                    projectId = generateId();
                }
                
                const project = {
                    id: projectId,
                    name,
                    category,
                    description,
                    expandedDescription: finalDescription, // Guardar la descripci√≥n expandida
                    data: projectData,
                    overviewApproved: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    userInput: { 
                        name, 
                        category, 
                        description,
                        expandedDescription: finalDescription // Guardar input expandido para an√°lisis de alineaci√≥n
                    }
                };

                state.projects.push(project);
                saveProjects();
                
                state.currentProjectId = project.id;
                
                // Renderizar lista y abrir proyecto
                renderProjectsList();
                openProject(project.id);
                
                hideLoading();
                showToast('¬°Proyecto generado exitosamente!', 'success');
            } catch (error) {
                hideLoading();
                console.error(error);
                showToast('Error al generar el proyecto. Intenta de nuevo.', 'error');
            }
        }

        async function generateProjectData(name, category, description) {
            const apiKey = document.getElementById('apiKeyInput').value;
            
            if (apiKey && apiKey.trim()) {
                return await generateWithAPI(name, category, description, apiKey.trim());
            } else {
                return generateLocally(name, category, description);
            }
        }

        async function generateWithAPI(name, category, description, apiKey) {
            // Sanitizar inputs
            const safeName = DOMSanitizer.sanitize(name);
            const safeCategory = DOMSanitizer.sanitize(category || 'General');
            const safeDescription = DOMSanitizer.sanitize(description);
            
            const prompt = `Eres un experto en UX/UI y arquitectura de productos digitales. Genera un an√°lisis completo para el siguiente proyecto:

NOMBRE: ${safeName}
CATEGOR√çA: ${safeCategory}
DESCRIPCI√ìN: ${safeDescription}

Responde √öNICAMENTE con un JSON v√°lido (sin markdown, sin explicaciones) con esta estructura exacta:

{
    "whatIs": "Descripci√≥n extendida de qu√© es y qu√© hace la aplicaci√≥n (2-3 p√°rrafos)",
    "targetAudience": "Descripci√≥n detallada del nicho y usuario objetivo (2-3 p√°rrafos)",
    "needsSolved": "Lista de necesidades que resuelve con explicaci√≥n (formato p√°rrafo)",
    "differentiators": "Qu√© diferencia este proyecto de competidores (formato p√°rrafo)",
    "elevatorPitch": "Pitch de 30 segundos para inversores",
    "appType": "An√°lisis de si es mejor Web First o Mobile First con justificaci√≥n detallada",
    "flows": {
        "mvp": [
            {"screen": "Nombre Pantalla", "description": "Descripci√≥n", "elements": ["elemento1", "elemento2"]}
        ],
        "intermediate": [...],
        "complete": [...]
    },
    "tokens": {
        "colors": {"primary": "#hex", "secondary": "#hex", "accent": "#hex", "background": "#hex", "surface": "#hex", "text": "#hex", "textSecondary": "#hex"},
        "typography": {"fontFamily": "nombre", "headingSize": "tama√±o", "bodySize": "tama√±o"},
        "spacing": {"xs": "valor", "sm": "valor", "md": "valor", "lg": "valor", "xl": "valor"},
        "borderRadius": {"sm": "valor", "md": "valor", "lg": "valor"}
    },
    "uiComponents": "Lista detallada de componentes UI necesarios con descripci√≥n de cada uno",
    "metrics": [
        {"name": "Nombre M√©trica", "target": "Objetivo", "icon": "emoji"}
    ],
    "metricsDetail": "Explicaci√≥n detallada de cada m√©trica y c√≥mo medirla"
}`;

            let response;
            
            try {
                response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01',
                        'anthropic-dangerous-direct-browser-access': 'true'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 4096,
                        messages: [{
                            role: 'user',
                            content: prompt
                        }]
                    })
                });
            } catch (networkError) {
                const errorInfo = APIErrorHandler.handle(networkError, null);
                console.error('Network error:', networkError);
                
                if (errorInfo.fallback) {
                    showToast(errorInfo.userMessage, 'info');
                    return generateLocally(safeName, safeCategory, safeDescription);
                }
                
                throw new Error(errorInfo.userMessage);
            }

            if (!response.ok) {
                const errorInfo = APIErrorHandler.handle(null, response);
                console.error('API error:', errorInfo.message);
                
                if (errorInfo.action === 'FOCUS_API_KEY') {
                    document.getElementById('apiKeyInput').focus();
                }
                
                if (errorInfo.fallback) {
                    showToast(errorInfo.userMessage, 'info');
                    return generateLocally(safeName, safeCategory, safeDescription);
                }
                
                throw new Error(errorInfo.userMessage);
            }

            let result;
            try {
                result = await response.json();
            } catch (parseError) {
                console.error('Error parsing response:', parseError);
                throw new Error('Error al procesar la respuesta del servidor');
            }
            
            if (!result.content || !result.content[0]) {
                throw new Error('Respuesta del servidor incompleta');
            }
            
            const content = result.content[0].text;
            
            // Parse JSON from response
            const jsonMatch = content.match(/\{[\s\S]*\}/);
            if (jsonMatch) {
                try {
                    const data = JSON.parse(jsonMatch[0]);
                    // Validar estructura b√°sica
                    if (!data.whatIs || !data.flows || !data.tokens) {
                        console.warn('Respuesta incompleta de API, usando generaci√≥n local');
                        return generateLocally(safeName, safeCategory, safeDescription);
                    }
                    return data;
                } catch (jsonError) {
                    console.error('Error parsing JSON:', jsonError);
                    throw new Error('Error al procesar los datos generados');
                }
            }
            
            throw new Error('Formato de respuesta no v√°lido');
        }

        function generateLocally(name, category, description, options = {}) {
            // Intelligent local generation based on category and description
            const conservative = options.conservative || false;
            const categories = {
                fintech: {
                    colors: { primary: '#0066FF', secondary: '#00D4AA', accent: '#FFB800', background: '#0A0F1E', surface: '#151B2E', text: '#FFFFFF', textSecondary: '#8892A6' },
                    targetAudience: 'profesionales y personas que buscan gestionar sus finanzas de manera eficiente',
                    needsBase: ['Control financiero', 'Ahorro automatizado', 'Visualizaci√≥n de gastos', 'Seguridad de datos']
                },
                healthtech: {
                    colors: { primary: '#00C9A7', secondary: '#845EF7', accent: '#FF6B6B', background: '#0D1117', surface: '#161B22', text: '#F0F6FC', textSecondary: '#8B949E' },
                    targetAudience: 'usuarios conscientes de su salud que buscan herramientas digitales para mejorar su bienestar',
                    needsBase: ['Seguimiento de salud', 'Recordatorios m√©dicos', 'Conexi√≥n con profesionales', 'Datos de bienestar']
                },
                edtech: {
                    colors: { primary: '#6366F1', secondary: '#22D3EE', accent: '#F59E0B', background: '#0F0F23', surface: '#1A1A2E', text: '#E2E8F0', textSecondary: '#94A3B8' },
                    targetAudience: 'estudiantes y profesionales que buscan aprender nuevas habilidades de forma efectiva',
                    needsBase: ['Aprendizaje personalizado', 'Seguimiento de progreso', 'Contenido interactivo', 'Certificaciones']
                },
                ecommerce: {
                    colors: { primary: '#FF6B35', secondary: '#004E89', accent: '#FFD600', background: '#0C0C0C', surface: '#1A1A1A', text: '#FAFAFA', textSecondary: '#A3A3A3' },
                    targetAudience: 'consumidores digitales que valoran la conveniencia y experiencia de compra',
                    needsBase: ['Compra f√°cil', 'Comparaci√≥n de productos', 'Pagos seguros', 'Seguimiento de pedidos']
                },
                social: {
                    colors: { primary: '#E91E63', secondary: '#9C27B0', accent: '#00BCD4', background: '#121212', surface: '#1E1E1E', text: '#FFFFFF', textSecondary: '#B0B0B0' },
                    targetAudience: 'usuarios que buscan conectar con comunidades afines y compartir experiencias',
                    needsBase: ['Conexi√≥n social', 'Contenido relevante', 'Privacidad', 'Expresi√≥n personal']
                },
                productivity: {
                    colors: { primary: '#3B82F6', secondary: '#10B981', accent: '#F59E0B', background: '#09090B', surface: '#18181B', text: '#FAFAFA', textSecondary: '#A1A1AA' },
                    targetAudience: 'profesionales y equipos que buscan optimizar su tiempo y flujos de trabajo',
                    needsBase: ['Gesti√≥n de tareas', 'Colaboraci√≥n', 'Automatizaci√≥n', 'An√°lisis de productividad']
                },
                entertainment: {
                    colors: { primary: '#E50914', secondary: '#FFD700', accent: '#00D9FF', background: '#141414', surface: '#232323', text: '#FFFFFF', textSecondary: '#808080' },
                    targetAudience: 'usuarios que buscan contenido de entretenimiento personalizado y de calidad',
                    needsBase: ['Contenido personalizado', 'Streaming fluido', 'Descubrimiento', 'Social viewing']
                },
                travel: {
                    colors: { primary: '#00A699', secondary: '#FF5A5F', accent: '#FFB400', background: '#0B1120', surface: '#162032', text: '#F7F7F7', textSecondary: '#B4B4B4' },
                    targetAudience: 'viajeros que buscan experiencias √∫nicas y planificaci√≥n simplificada',
                    needsBase: ['Reservas f√°ciles', 'Inspiraci√≥n de destinos', 'Planificaci√≥n de viaje', 'Reviews confiables']
                },
                food: {
                    colors: { primary: '#FF5722', secondary: '#4CAF50', accent: '#FFC107', background: '#1A1A1A', surface: '#2D2D2D', text: '#FFFFFF', textSecondary: '#9E9E9E' },
                    targetAudience: 'usuarios que valoran la conveniencia y variedad en sus opciones de alimentaci√≥n',
                    needsBase: ['Pedidos r√°pidos', 'Variedad de opciones', 'Seguimiento en tiempo real', 'Personalizaci√≥n']
                },
                other: {
                    colors: { primary: '#6366F1', secondary: '#8B5CF6', accent: '#EC4899', background: '#0A0A0F', surface: '#15151F', text: '#F0F0F5', textSecondary: '#A0A0B5' },
                    targetAudience: 'usuarios que buscan soluciones innovadoras para sus necesidades espec√≠ficas',
                    needsBase: ['Facilidad de uso', 'Eficiencia', 'Personalizaci√≥n', 'Soporte']
                }
            };

            const catData = categories[category] || categories.other;
            
            // Extraer palabras clave de la descripci√≥n
            const keywords = description.split(' ').filter(w => w.length > 4);
            const hasKeyword = (word) => description.toLowerCase().includes(word.toLowerCase());
            
            // Generar whatIs din√°mico basado en la descripci√≥n
            let whatIsIntro = `${name} es una aplicaci√≥n`;
            if (hasKeyword('interactiv')) whatIsIntro += ' interactiva';
            if (hasKeyword('innovador')) whatIsIntro += ' innovadora';
            if (hasKeyword('modern')) whatIsIntro += ' moderna';
            
            whatIsIntro += ` de ${getCategoryName(category)}`;
            
            if (hasKeyword('equipo')) whatIsIntro += ' enfocada en el trabajo en equipo';
            else if (hasKeyword('personal')) whatIsIntro += ' para uso personal';
            else if (hasKeyword('empresa')) whatIsIntro += ' orientada a empresas';
            
            const whatIs = `${whatIsIntro}. ${description}

${name} se enfoca espec√≠ficamente en ${description.toLowerCase().split('.')[0]}${description.includes('.') ? '' : ', brindando una soluci√≥n directa y eficiente para esta necesidad'}.

La aplicaci√≥n est√° dise√±ada con las caracter√≠sticas espec√≠ficas que demanda este tipo de herramienta, priorizando la funcionalidad descrita y evitando complejidades innecesarias que distraigan del objetivo principal.`;

            // Generar targetAudience din√°mico
            let audienceType = catData.targetAudience;
            if (hasKeyword('profesional')) audienceType = 'profesionales que ' + description.toLowerCase().split('.')[0];
            else if (hasKeyword('estudiante')) audienceType = 'estudiantes y personas en formaci√≥n que necesitan ' + description.toLowerCase().split('.')[0];
            else if (hasKeyword('equipo')) audienceType = 'equipos de trabajo que buscan ' + description.toLowerCase().split('.')[0];
            
            const targetAudience = `${name} est√° dise√±ada para ${audienceType}.

Los usuarios objetivo valoran las caracter√≠sticas espec√≠ficas que ofrece ${name}: ${description.split('.')[0].toLowerCase()}. Son personas que entienden la importancia de herramientas especializadas sobre soluciones gen√©ricas.

El perfil de usuario t√≠pico busca exactamente lo que ${name} ofrece: una herramienta enfocada, sin funcionalidades innecesarias, que resuelva de manera efectiva la necesidad planteada.`;

            // Generar needsSolved din√°mico
            const mainNeed = description.split('.')[0] || description.substring(0, 100);
            const needsSolved = `${name} resuelve directamente la necesidad de ${mainNeed.toLowerCase()}.

Necesidades espec√≠ficas que aborda:

1. ${mainNeed}: Esta es la necesidad central que motiv√≥ la creaci√≥n de ${name}, proporcionando una soluci√≥n directa y sin complicaciones.

2. ${catData.needsBase[0]}: Aspecto fundamental para usuarios en el sector ${getCategoryName(category)}.

3. ${catData.needsBase[1]}: Complementa la funcionalidad principal asegurando una experiencia completa.

4. ${catData.needsBase[2]}: Garantiza que la soluci√≥n sea pr√°ctica y sostenible en el tiempo.

La propuesta de valor de ${name} radica en hacer bien una cosa espec√≠fica, en lugar de intentar hacer todo de manera mediocre.`;

            const differentiators = `${name} se diferencia por su enfoque especializado:

1. Enfoque Espec√≠fico: Mientras otras aplicaciones intentan ser todo para todos, ${name} se concentra en ${mainNeed.toLowerCase()}, haci√©ndolo excepcionalmente bien.

2. Dise√±o Centrado en la Tarea: Cada elemento de la interfaz est√° pensado para facilitar espec√≠ficamente la tarea de ${mainNeed.toLowerCase()}.

3. Sin Complejidad Innecesaria: ${name} no incluye funciones que no contribuyan directamente al objetivo principal, resultando en una experiencia m√°s limpia y eficiente.

4. Optimizaci√≥n para el Caso de Uso: Toda decisi√≥n t√©cnica y de dise√±o se toma pensando en el escenario espec√≠fico de ${description.toLowerCase().split('.')[0]}.`;

            const elevatorPitch = `${name} resuelve un problema espec√≠fico: ${mainNeed.toLowerCase()}. En lugar de ser otra aplicaci√≥n gen√©rica de ${getCategoryName(category)}, nos enfocamos exclusivamente en hacer esto de la mejor manera posible. Nuestros usuarios valoran esta especializaci√≥n porque obtienen exactamente lo que necesitan, sin distracciones ni curvas de aprendizaje innecesarias. ${name} es la herramienta que hace una cosa, pero la hace excepcionalmente bien.`;

            const appType = analyzeAppType(category, description);
            const flows = generateFlows(name, category, appType);
            
            const tokens = {
                colors: catData.colors,
                typography: {
                    fontFamily: getRecommendedFont(category),
                    headingSize: '24px / 32px / 40px',
                    bodySize: '14px / 16px'
                },
                spacing: {
                    xs: '4px',
                    sm: '8px',
                    md: '16px',
                    lg: '24px',
                    xl: '32px'
                },
                borderRadius: {
                    sm: '4px',
                    md: '8px',
                    lg: '16px'
                }
            };

            const uiComponents = generateUIComponents(category);
            const metrics = generateMetrics(category);
            const metricsDetail = generateMetricsDetail(category, metrics);

            return {
                whatIs,
                targetAudience,
                needsSolved,
                differentiators,
                elevatorPitch,
                appType,
                flows,
                tokens,
                uiComponents,
                metrics,
                metricsDetail
            };
        }

        function getCategoryName(category) {
            const names = {
                fintech: 'servicios financieros',
                healthtech: 'salud y bienestar',
                edtech: 'educaci√≥n',
                ecommerce: 'comercio electr√≥nico',
                social: 'redes sociales',
                productivity: 'productividad',
                entertainment: 'entretenimiento',
                travel: 'viajes',
                food: 'alimentaci√≥n y delivery'
            };
            return names[category] || 'tecnolog√≠a';
        }

        function getActionVerb(category) {
            const verbs = {
                fintech: 'gestionar sus finanzas',
                healthtech: 'cuidar su salud',
                edtech: 'aprender',
                ecommerce: 'comprar',
                social: 'conectar',
                productivity: 'trabajar',
                entertainment: 'entretenerse',
                travel: 'viajar',
                food: 'comer'
            };
            return verbs[category] || 'interactuar';
        }

        function getRecommendedFont(category) {
            const fonts = {
                fintech: 'Inter, SF Pro Display',
                healthtech: 'Nunito, Open Sans',
                edtech: 'Poppins, Lato',
                ecommerce: 'DM Sans, Roboto',
                social: 'Circular, SF Pro',
                productivity: 'Inter, System UI',
                entertainment: 'Netflix Sans, Helvetica Neue',
                travel: 'Airbnb Cereal, Circular',
                food: 'Uber Move, Gilroy'
            };
            return fonts[category] || 'Inter, System UI';
        }

        function analyzeAppType(category, description) {
            const mobileFirst = ['food', 'social', 'entertainment', 'travel', 'healthtech'];
            const webFirst = ['productivity', 'edtech', 'fintech', 'ecommerce'];
            
            // Analizar palabras clave en la descripci√≥n
            const descLower = description.toLowerCase();
            const mobileKeywords = ['m√≥vil', 'mobile', 'tiempo real', 'ubicaci√≥n', 'notificaci√≥n', 'c√°mara', 'foto', 'escanear', 'movimiento'];
            const webKeywords = ['dashboard', 'an√°lisis', 'reportes', 'gesti√≥n', 'administr', 'm√∫ltiples ventanas', 'escritorio', 'complejo'];
            
            const hasMobileKeywords = mobileKeywords.some(k => descLower.includes(k));
            const hasWebKeywords = webKeywords.some(k => descLower.includes(k));
            
            let isMobile = mobileFirst.includes(category);
            
            // Override basado en keywords si son fuertes
            if (hasMobileKeywords && !hasWebKeywords) isMobile = true;
            if (hasWebKeywords && !hasMobileKeywords) isMobile = false;
            
            const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
            const projectContext = description.split('.')[0] || description.substring(0, 100);
            
            if (isMobile) {
                return `RECOMENDACI√ìN: Mobile First

Para un proyecto enfocado en "${projectContext}", el enfoque m√≥vil es ideal porque este tipo de funcionalidad se beneficia del acceso inmediato y contextual que ofrecen los dispositivos m√≥viles.

Justificaci√≥n espec√≠fica para este proyecto:
- El caso de uso descrito ("${projectContext}") t√≠picamente ocurre en contextos donde el m√≥vil es el dispositivo m√°s accesible
- Acceso a funciones nativas que enriquecen la experiencia (GPS, c√°mara, notificaciones)
- Los usuarios esperan poder acceder a esta funcionalidad en cualquier momento y lugar
- La naturaleza de la tarea se presta para sesiones cortas pero frecuentes

Estrategia recomendada para ${category}:
1. App nativa (iOS/Android) como producto principal
2. PWA como alternativa web para casos espec√≠ficos
3. Web dashboard solo si se requieren funciones administrativas

Stack tecnol√≥gico sugerido: React Native o Flutter para desarrollo multiplataforma eficiente, manteniendo c√≥digo base √∫nico.`;
            } else {
                return `RECOMENDACI√ìN: Web First

Para un proyecto enfocado en "${projectContext}", una aplicaci√≥n web es m√°s apropiada porque este tipo de funcionalidad se beneficia del espacio de pantalla y las capacidades de una plataforma web completa.

Justificaci√≥n espec√≠fica para este proyecto:
- El caso de uso descrito ("${projectContext}") t√≠picamente requiere pantallas m√°s grandes para una visualizaci√≥n y trabajo efectivo
- Las tareas involucradas suelen ser m√°s complejas y beneficiarse de m√∫ltiples ventanas/pesta√±as
- Los usuarios esperan poder acceder desde diferentes dispositivos (trabajo/casa)
- La naturaleza de la funcionalidad se presta para sesiones de trabajo m√°s largas y enfocadas

Estrategia recomendada para ${category}:
1. Aplicaci√≥n web responsive como producto principal
2. PWA para acceso m√≥vil con funcionalidades core
3. App nativa solo si m√©tricas de uso m√≥vil lo justifican posteriormente

Stack tecnol√≥gico sugerido: Next.js o React con TypeScript para una aplicaci√≥n web robusta, con capacidades PWA para acceso m√≥vil b√°sico.`;
            }
        }

        function generateFlows(name, category, appType = '') {
            // Analizar arquitectura basada en tipo de app
            const architecture = ScreenArchitecture.analyzeScreenStructure(appType, category);
            
            // Generar nombres din√°micos seg√∫n categor√≠a
            const dynamicScreens = generateDynamicScreenNames(name, category);
            
            const baseFlows = {
                mvp: [
                    { screen: 'Splash / Loading', description: `Pantalla inicial con logo de ${name} y carga de recursos`, elements: ['Logo animado', 'Progress indicator', 'Versi√≥n de app'], context: 'Primera impresi√≥n - Sin navegaci√≥n visible' },
                    { screen: 'Onboarding', description: `Introducci√≥n al valor de ${name} en 3-4 slides`, elements: ['Ilustraciones', 'T√≠tulos impactantes', 'Dots de progreso', 'Skip button', 'CTA final'], context: 'Educaci√≥n inicial - Usuario puede saltarlo' },
                    { screen: 'Login / Registro', description: 'Autenticaci√≥n de usuarios', elements: ['Email input', 'Password input', 'Social login buttons', 'Forgot password link', 'T√©rminos y condiciones'], context: 'Autenticaci√≥n - Sin navegaci√≥n principal' },
                    { screen: dynamicScreens.home, description: `Vista principal de ${name}`, elements: ['Header con perfil', 'Cards de contenido', 'Quick actions', 'Bottom navigation'], context: 'Pantalla principal - Navegaci√≥n completa disponible' },
                    { screen: 'Perfil de Usuario', description: 'Configuraci√≥n y datos del usuario', elements: ['Avatar', 'Datos personales', 'Preferencias', 'Logout button'], context: 'Gesti√≥n de cuenta - Accesible desde navegaci√≥n principal' }
                ],
                intermediate: [
                    { screen: dynamicScreens.search, description: `Sistema de b√∫squeda de ${dynamicScreens.contentType}`, elements: ['Search bar', 'Filtros b√°sicos', 'Resultados en lista/grid', 'Historial reciente'], context: 'Discovery - Encontrar contenido' },
                    { screen: dynamicScreens.detail, description: `Vista detallada de ${dynamicScreens.contentType}`, elements: ['Hero image', 'Informaci√≥n completa', 'Actions principales', 'Contenido relacionado'], context: 'Informaci√≥n detallada - Enfoque en un elemento' },
                    { screen: dynamicScreens.feed, description: `${dynamicScreens.feedDescription} de ${name}`, elements: ['Posts/Items en scroll', 'Refresh pull', 'Filtros de contenido', 'Infinite scroll'], context: 'Consumo de contenido - Actualizaci√≥n continua' },
                    { screen: 'Notificaciones', description: 'Centro de notificaciones', elements: ['Lista de notificaciones', 'Filtros por tipo', 'Mark as read', 'Settings r√°pidos'], context: 'Centro de actividad - Gesti√≥n de notificaciones' },
                    { screen: 'Configuraci√≥n', description: 'Ajustes y preferencias', elements: ['Sections organizadas', 'Preferencias de app', 'Notificaciones', 'Privacidad', 'Cuenta'], context: 'Personalizaci√≥n - Ajustes del usuario' },
                    { screen: dynamicScreens.saved, description: `${dynamicScreens.contentType} guardados`, elements: ['Lista de guardados', 'Organizaci√≥n por categor√≠as', 'Quick access', 'Opciones de compartir'], context: 'Contenido curado - Acceso r√°pido' },
                    { screen: dynamicScreens.activity, description: `Historial de ${dynamicScreens.activityType}`, elements: ['Timeline de actividad', 'Filtros temporales', 'Estad√≠sticas b√°sicas', 'Clear history'], context: 'Seguimiento - Registro de acciones' },
                    { screen: 'Ayuda / FAQ', description: 'Centro de soporte b√°sico', elements: ['Preguntas frecuentes', 'Search en FAQs', 'Contact support', 'Video tutoriales'], context: 'Soporte - Ayuda al usuario' }
                ],
                complete: [
                    { screen: `${dynamicScreens.search} Avanzada`, description: `Motor de b√∫squeda completo de ${dynamicScreens.contentType} con IA`, elements: ['Search bar con NLP', 'Filtros avanzados', 'Voice search', 'Visual search', 'Saved searches', 'Recommendations'], context: 'Discovery avanzado - B√∫squeda inteligente' },
                    { screen: `${dynamicScreens.detail} Detallada`, description: `Informaci√≥n completa de ${dynamicScreens.contentType} con interacciones`, elements: ['Hero media 360¬∞', 'AR preview', 'Reviews verificados', 'Comparador', 'Share suite', 'Related content'], context: 'Detalle inmersivo - Experiencia completa' },
                    { screen: dynamicScreens.create, description: `Herramientas para ${dynamicScreens.createAction}`, elements: ['Form builder', 'Media upload', 'Rich text editor', 'Preview', 'Autosave', 'Publish/Draft', 'Collaborate'], context: 'Creaci√≥n - Herramientas profesionales' },
                    { screen: dynamicScreens.messaging, description: 'Sistema de mensajer√≠a en tiempo real', elements: ['Lista de conversaciones', 'Chat interface', 'Media sharing', 'Reactions', 'Read receipts', 'Group chats', 'Search'], context: 'Comunicaci√≥n - Mensajer√≠a directa' },
                    { screen: 'Centro de Notificaciones Pro', description: 'Gesti√≥n inteligente de notificaciones', elements: ['Smart grouping', 'Scheduled digest', 'Channel preferences', 'Snooze', 'Priority inbox', 'Actions r√°pidas'], context: 'Notificaciones avanzadas - Control total' },
                    { screen: dynamicScreens.analytics, description: `M√©tricas y estad√≠sticas de ${dynamicScreens.analyticsType}`, elements: ['Usage dashboard', 'Goal tracking', 'Charts interactivos', 'Comparativas', 'Reports exportables', 'Insights AI'], context: 'Analytics - M√©tricas y tendencias' },
                    { screen: dynamicScreens.social, description: 'Centro de interacciones sociales', elements: ['Following/Followers', 'Activity feed', 'Grupos', 'Events', 'Sharing', 'Mentions', 'Trending'], context: 'Social - Conexi√≥n con comunidad' },
                    { screen: 'Configuraci√≥n Avanzada', description: 'Panel de control completo', elements: ['Settings sections', 'Privacy center', 'Integrations', 'API keys', 'Export data', 'Account health', 'Theme customizer'], context: 'Control avanzado - Configuraci√≥n total' },
                    { screen: dynamicScreens.library, description: `Organizaci√≥n de ${dynamicScreens.contentType}`, elements: ['Collections', 'Tags', 'Folders', 'Sort/Filter options', 'Bulk actions', 'Search in library'], context: 'Organizaci√≥n - Gesti√≥n de contenido' },
                    { screen: dynamicScreens.calendar, description: `Gesti√≥n de ${dynamicScreens.calendarType}`, elements: ['Calendar view', 'Event creation', 'Reminders', 'Sync options', 'Recurring events', 'Agenda view'], context: 'Planificaci√≥n - Gesti√≥n temporal' },
                    { screen: 'Centro de Ayuda Pro', description: 'Soporte completo multicanal', elements: ['AI chatbot', 'FAQs din√°micas', 'Video tutorials', 'Live chat', 'Ticket system', 'Community forum', 'Knowledge base'], context: 'Soporte premium - Ayuda completa' },
                    { screen: dynamicScreens.admin, description: `Panel de ${dynamicScreens.adminType}`, elements: ['User management', 'Content moderation', 'Analytics dashboard', 'Settings globales', 'Reports', 'Permissions'], context: 'Administraci√≥n - Control del sistema' },
                    { screen: 'Integraciones / API', description: 'Conexi√≥n con servicios externos', elements: ['Connected apps', 'API configuration', 'Webhooks', 'OAuth connections', 'Sync status', 'Logs'], context: 'Conectividad - Integraci√≥n externa' }
                ]
            };

            // Enriquecer cada pantalla con arquitectura
            Object.keys(baseFlows).forEach(tier => {
                baseFlows[tier] = baseFlows[tier].map((screen, index) => 
                    ScreenArchitecture.enrichScreenData(screen, index, baseFlows[tier].length, architecture)
                );
            });
            
            // Agregar metadata de arquitectura
            baseFlows._architecture = architecture;

            return baseFlows;
        }
        
        function generateDynamicScreenNames(name, category) {
            const screenConfigs = {
                fintech: {
                    home: 'Dashboard Financiero',
                    search: 'Buscar Transacciones',
                    detail: 'Detalle de Transacci√≥n',
                    feed: 'Actividad Financiera',
                    feedDescription: 'Flujo de movimientos',
                    saved: 'Transacciones Guardadas',
                    activity: 'Historial Financiero',
                    activityType: 'transacciones',
                    create: 'Nueva Transacci√≥n',
                    createAction: 'crear transacciones',
                    messaging: 'Asesor Financiero Chat',
                    analytics: 'Analytics Financiero',
                    analyticsType: 'finanzas',
                    social: 'Comunidad Financiera',
                    library: 'Mi Cartera',
                    calendar: 'Calendario de Pagos',
                    calendarType: 'pagos y vencimientos',
                    admin: 'Panel Administrativo',
                    adminType: 'control financiero',
                    contentType: 'transacciones'
                },
                healthtech: {
                    home: 'Dashboard de Salud',
                    search: 'Buscar Profesionales',
                    detail: 'Perfil de Doctor',
                    feed: 'Feed de Salud',
                    feedDescription: 'Actualizaciones de bienestar',
                    saved: 'Consultas Guardadas',
                    activity: 'Historial M√©dico',
                    activityType: 'consultas',
                    create: 'Agendar Cita',
                    createAction: 'agendar citas',
                    messaging: 'Chat M√©dico',
                    analytics: 'An√°lisis de Salud',
                    analyticsType: 'salud',
                    social: 'Comunidad de Bienestar',
                    library: 'Mis Registros M√©dicos',
                    calendar: 'Calendario de Citas',
                    calendarType: 'citas y tratamientos',
                    admin: 'Panel Cl√≠nico',
                    adminType: 'gesti√≥n m√©dica',
                    contentType: 'consultas'
                },
                edtech: {
                    home: 'Mi Aprendizaje',
                    search: 'Buscar Cursos',
                    detail: 'Detalle del Curso',
                    feed: 'Feed Educativo',
                    feedDescription: 'Contenido de aprendizaje',
                    saved: 'Cursos Guardados',
                    activity: 'Progreso de Aprendizaje',
                    activityType: 'estudio',
                    create: 'Crear Curso',
                    createAction: 'crear contenido educativo',
                    messaging: 'Chat con Instructor',
                    analytics: 'Progreso Acad√©mico',
                    analyticsType: 'aprendizaje',
                    social: 'Comunidad de Estudiantes',
                    library: 'Mi Biblioteca',
                    calendar: 'Calendario de Clases',
                    calendarType: 'clases y ex√°menes',
                    admin: 'Panel Educativo',
                    adminType: 'gesti√≥n acad√©mica',
                    contentType: 'cursos'
                },
                ecommerce: {
                    home: 'Tienda Principal',
                    search: 'Buscar Productos',
                    detail: 'Detalle del Producto',
                    feed: 'Novedades',
                    feedDescription: 'Productos destacados',
                    saved: 'Lista de Deseos',
                    activity: 'Historial de Compras',
                    activityType: 'compras',
                    create: 'Vender Producto',
                    createAction: 'publicar productos',
                    messaging: 'Chat con Vendedor',
                    analytics: 'Mis Compras',
                    analyticsType: 'compras',
                    social: 'Comunidad de Compradores',
                    library: 'Mis Pedidos',
                    calendar: 'Calendario de Entregas',
                    calendarType: 'entregas y devoluciones',
                    admin: 'Panel de Ventas',
                    adminType: 'gesti√≥n de tienda',
                    contentType: 'productos'
                },
                social: {
                    home: 'Feed Principal',
                    search: 'Buscar Usuarios',
                    detail: 'Perfil de Usuario',
                    feed: 'Timeline',
                    feedDescription: 'Publicaciones recientes',
                    saved: 'Posts Guardados',
                    activity: 'Tu Actividad',
                    activityType: 'interacciones',
                    create: 'Crear Post',
                    createAction: 'publicar contenido',
                    messaging: 'Mensajes Directos',
                    analytics: 'Insights de Perfil',
                    analyticsType: 'engagement',
                    social: 'Red Social',
                    library: 'Tus Publicaciones',
                    calendar: 'Eventos',
                    calendarType: 'eventos sociales',
                    admin: 'Panel de Moderaci√≥n',
                    adminType: 'moderaci√≥n de contenido',
                    contentType: 'publicaciones'
                },
                productivity: {
                    home: 'Workspace',
                    search: 'Buscar Tareas',
                    detail: 'Detalle de Tarea',
                    feed: 'Actividad del Equipo',
                    feedDescription: 'Actualizaciones de trabajo',
                    saved: 'Tareas Importantes',
                    activity: 'Historial de Trabajo',
                    activityType: 'tareas',
                    create: 'Nueva Tarea',
                    createAction: 'crear tareas',
                    messaging: 'Chat del Equipo',
                    analytics: 'Productividad',
                    analyticsType: 'rendimiento',
                    social: 'Equipo',
                    library: 'Proyectos',
                    calendar: 'Calendario de Tareas',
                    calendarType: 'deadlines y reuniones',
                    admin: 'Panel de Gesti√≥n',
                    adminType: 'gesti√≥n de equipo',
                    contentType: 'tareas'
                },
                entertainment: {
                    home: 'Inicio',
                    search: 'Buscar Contenido',
                    detail: 'Detalle de Contenido',
                    feed: 'Para Ti',
                    feedDescription: 'Contenido recomendado',
                    saved: 'Mi Lista',
                    activity: 'Historial de Reproducci√≥n',
                    activityType: 'visualizaci√≥n',
                    create: 'Subir Contenido',
                    createAction: 'subir videos',
                    messaging: 'Chat con Creadores',
                    analytics: 'Estad√≠sticas de Visualizaci√≥n',
                    analyticsType: 'consumo',
                    social: 'Comunidad',
                    library: 'Mi Biblioteca',
                    calendar: 'Pr√≥ximos Estrenos',
                    calendarType: 'estrenos y eventos',
                    admin: 'Panel de Creadores',
                    adminType: 'gesti√≥n de contenido',
                    contentType: 'videos'
                },
                travel: {
                    home: 'Explorar Destinos',
                    search: 'Buscar Viajes',
                    detail: 'Detalle del Destino',
                    feed: 'Inspiraci√≥n de Viajes',
                    feedDescription: 'Destinos destacados',
                    saved: 'Viajes Guardados',
                    activity: 'Mis Viajes',
                    activityType: 'reservas',
                    create: 'Planear Viaje',
                    createAction: 'planear itinerarios',
                    messaging: 'Chat con Gu√≠as',
                    analytics: 'Historial de Viajes',
                    analyticsType: 'viajes',
                    social: 'Comunidad Viajera',
                    library: 'Mis Reservas',
                    calendar: 'Calendario de Viajes',
                    calendarType: 'vuelos y reservas',
                    admin: 'Panel de Reservas',
                    adminType: 'gesti√≥n de bookings',
                    contentType: 'destinos'
                },
                food: {
                    home: 'Explorar Restaurantes',
                    search: 'Buscar Comida',
                    detail: 'Men√∫ del Restaurante',
                    feed: 'Destacados',
                    feedDescription: 'Platos populares',
                    saved: 'Favoritos',
                    activity: 'Mis Pedidos',
                    activityType: 'pedidos',
                    create: 'Nuevo Pedido',
                    createAction: 'realizar pedidos',
                    messaging: 'Chat con Restaurante',
                    analytics: 'Historial de Pedidos',
                    analyticsType: 'consumo',
                    social: 'Comunidad Foodie',
                    library: 'Mis Direcciones',
                    calendar: 'Reservas',
                    calendarType: 'reservas y entregas',
                    admin: 'Panel de Restaurante',
                    adminType: 'gesti√≥n de pedidos',
                    contentType: 'restaurantes'
                },
                other: {
                    home: 'Dashboard Principal',
                    search: 'Buscar',
                    detail: 'Vista Detallada',
                    feed: 'Feed de Contenido',
                    feedDescription: 'Actualizaciones',
                    saved: 'Guardados',
                    activity: 'Actividad Reciente',
                    activityType: 'acciones',
                    create: 'Crear Nuevo',
                    createAction: 'crear contenido',
                    messaging: 'Mensajer√≠a',
                    analytics: 'Analytics',
                    analyticsType: 'uso',
                    social: 'Comunidad',
                    library: 'Mi Colecci√≥n',
                    calendar: 'Calendario',
                    calendarType: 'eventos',
                    admin: 'Panel Administrativo',
                    adminType: 'administraci√≥n',
                    contentType: 'items'
                }
            };

            return screenConfigs[category] || screenConfigs.other;
        }

        function generateUIComponents(category) {
            return `COMPONENTES UI ESENCIALES PARA ${category.toUpperCase()}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
NAVEGACI√ìN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ Bottom Navigation Bar: 4-5 items con iconos y labels
‚Ä¢ Top App Bar: Logo, search, notifications, profile
‚Ä¢ Drawer/Sidebar: Navegaci√≥n secundaria y settings
‚Ä¢ Tab Bar: Para vistas con categor√≠as

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
INPUTS & FORMS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ Text Input: Con estados (default, focus, error, disabled)
‚Ä¢ Search Input: Con icono, clear button, voice input
‚Ä¢ Dropdown/Select: Single y multi-select
‚Ä¢ Date/Time Picker: Calendario y selector de hora
‚Ä¢ Checkbox & Radio: Con labels y grupos
‚Ä¢ Toggle Switch: Para settings on/off
‚Ä¢ Slider: Para rangos de valores
‚Ä¢ File Upload: Drag & drop y selector

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
BUTTONS & ACTIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ Primary Button: CTA principal (filled)
‚Ä¢ Secondary Button: Acciones secundarias (outlined)
‚Ä¢ Text Button: Acciones terciarias
‚Ä¢ Icon Button: Acciones compactas
‚Ä¢ FAB (Floating Action Button): Acci√≥n principal flotante
‚Ä¢ Button Group: Acciones relacionadas

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
CARDS & CONTAINERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ Content Card: Para items de contenido
‚Ä¢ List Item: Para listas de datos
‚Ä¢ Expandable Card: Con contenido colapsable
‚Ä¢ Hero Card: Destacado de contenido principal
‚Ä¢ Stat Card: Para m√©tricas y KPIs

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
FEEDBACK & STATUS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ Toast/Snackbar: Mensajes temporales
‚Ä¢ Alert/Banner: Notificaciones importantes
‚Ä¢ Progress Bar: Progreso determinado
‚Ä¢ Spinner/Loader: Carga indeterminada
‚Ä¢ Skeleton: Loading placeholders
‚Ä¢ Empty State: Cuando no hay contenido
‚Ä¢ Error State: Manejo de errores

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
MODALS & OVERLAYS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ Modal Dialog: Confirmaciones y forms
‚Ä¢ Bottom Sheet: Acciones y contenido m√≥vil
‚Ä¢ Popover/Tooltip: Informaci√≥n contextual
‚Ä¢ Lightbox: Visualizaci√≥n de media

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
DATA DISPLAY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ Avatar: Usuario y entidades
‚Ä¢ Badge: Contadores y estados
‚Ä¢ Tag/Chip: Categor√≠as y filtros
‚Ä¢ Table: Datos tabulares (web)
‚Ä¢ Chart Components: Visualizaci√≥n de datos`;
        }

        function generateMetrics(category) {
            const baseMetrics = [
                { name: 'Usuarios Activos', target: '10K MAU en 6 meses', icon: 'üë•' },
                { name: 'Retenci√≥n D7', target: '40%+', icon: 'üìà' },
                { name: 'NPS', target: '50+', icon: '‚≠ê' },
                { name: 'Tiempo de Sesi√≥n', target: '5+ min promedio', icon: '‚è±Ô∏è' }
            ];

            const categoryMetrics = {
                fintech: [
                    { name: 'Transacciones', target: '100K/mes', icon: 'üí≥' },
                    { name: 'Volumen Procesado', target: '$1M/mes', icon: 'üí∞' }
                ],
                healthtech: [
                    { name: 'Engagement Diario', target: '60%+', icon: '‚ù§Ô∏è' },
                    { name: 'Goals Completados', target: '75%', icon: 'üéØ' }
                ],
                edtech: [
                    { name: 'Cursos Completados', target: '40%', icon: 'üìö' },
                    { name: 'Learning Hours', target: '5hrs/semana', icon: 'üéì' }
                ],
                ecommerce: [
                    { name: 'Conversi√≥n', target: '3%+', icon: 'üõí' },
                    { name: 'AOV', target: '$50+', icon: 'üíµ' }
                ],
                social: [
                    { name: 'Posts/Usuario', target: '3/semana', icon: 'üì±' },
                    { name: 'Engagement Rate', target: '5%+', icon: 'üí¨' }
                ],
                productivity: [
                    { name: 'Tareas Completadas', target: '80%', icon: '‚úÖ' },
                    { name: 'Team Adoption', target: '90%', icon: 'üë•' }
                ],
                entertainment: [
                    { name: 'Watch Time', target: '2hrs/d√≠a', icon: 'üé¨' },
                    { name: 'Content Discovery', target: '30%', icon: 'üîç' }
                ],
                travel: [
                    { name: 'Booking Rate', target: '5%', icon: '‚úàÔ∏è' },
                    { name: 'Return Users', target: '60%', icon: 'üîÑ' }
                ],
                food: [
                    { name: 'Orders/Usuario', target: '4/mes', icon: 'üçî' },
                    { name: 'Delivery Time', target: '<30min', icon: '‚ö°' }
                ]
            };

            return [...baseMetrics, ...(categoryMetrics[category] || [])];
        }

        function generateMetricsDetail(category, metrics) {
            return `M√âTRICAS DE √âXITO - GU√çA DE MEDICI√ìN

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
NORTH STAR METRIC
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
La m√©trica principal que indica el valor entregado a usuarios.
Para este proyecto: ${metrics[0]?.name || 'Usuarios Activos Mensuales'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√âTRICAS DE ADQUISICI√ìN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ CAC (Costo de Adquisici√≥n): Target < $10/usuario
‚Ä¢ Fuentes de tr√°fico: Org√°nico vs Paid
‚Ä¢ Conversion funnel: Visit ‚Üí Signup ‚Üí Activation
‚Ä¢ Viral coefficient: K-factor > 0.5

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√âTRICAS DE ACTIVACI√ìN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ Time to Value: Tiempo hasta primera acci√≥n de valor
‚Ä¢ Onboarding completion: Target 80%+
‚Ä¢ Feature adoption: % usuarios usando features core

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√âTRICAS DE RETENCI√ìN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ D1 Retention: Target 60%
‚Ä¢ D7 Retention: Target 40%
‚Ä¢ D30 Retention: Target 25%
‚Ä¢ Churn Rate: Target < 5% mensual

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√âTRICAS DE ENGAGEMENT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ DAU/MAU Ratio: Target 20%+ (stickiness)
‚Ä¢ Session frequency: Sesiones por semana
‚Ä¢ Session duration: Tiempo promedio
‚Ä¢ Feature usage depth

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√âTRICAS DE REVENUE (si aplica)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ MRR/ARR: Ingresos recurrentes
‚Ä¢ ARPU: Ingreso promedio por usuario
‚Ä¢ LTV: Valor de vida del cliente
‚Ä¢ LTV:CAC Ratio: Target > 3:1

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
HERRAMIENTAS RECOMENDADAS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚Ä¢ Analytics: Mixpanel, Amplitude, PostHog
‚Ä¢ Error tracking: Sentry, Bugsnag
‚Ä¢ Session recording: Hotjar, FullStory
‚Ä¢ A/B testing: LaunchDarkly, Split.io`;
        }

        // ========== UI Rendering ==========
        function renderFlows(flows) {
            const container = document.getElementById('flowsContainer');
            const tier = state.currentFlowTier;
            const tierFlows = flows[tier] || [];

            if (tierFlows.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì±</div><p>No hay flujos definidos para este tier</p></div>';
                return;
            }

            container.innerHTML = `
                <div class="flows-grid">
                    ${tierFlows.map((flow, index) => `
                        <div class="flow-card">
                            <div class="flow-card-header">
                                <div class="flow-card-title">
                                    <span class="flow-item-number">${index + 1}</span>
                                    ${flow.screen}
                                </div>
                                <div class="flow-card-subtitle">${flow.description}</div>
                                ${flow.context ? `<div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; font-style: italic;">${flow.context}</div>` : ''}
                            </div>
                            <div class="flow-card-body">
                                <strong style="font-size: 0.75rem; color: var(--accent-primary); display: block; margin-bottom: 8px;">üé® Elementos UI:</strong>
                                ${flow.elements.map(el => `
                                    <div class="flow-item">‚Ä¢ ${el}</div>
                                `).join('')}
                                
                                ${flow.globalElements ? `
                                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                                    <strong style="font-size: 0.75rem; color: var(--info); display: block; margin-bottom: 6px;">üèóÔ∏è Elementos Globales:</strong>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); line-height: 1.5;">
                                        ${flow.globalElements.header ? '‚úì Header' : '‚úó Header'} | 
                                        ${flow.globalElements.bottomNav ? '‚úì Bottom Nav' : '‚úó Bottom Nav'} | 
                                        ${flow.globalElements.sidebar ? '‚úì Sidebar' : '‚úó Sidebar'}
                                        ${flow.globalElements.note ? `<br><span style="font-style: italic; color: var(--text-muted);">${flow.globalElements.note}</span>` : ''}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${flow.layout ? `
                                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                                    <strong style="font-size: 0.75rem; color: var(--warning); display: block; margin-bottom: 6px;">üìê Layout:</strong>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); line-height: 1.5;">
                                        ${flow.layout.pattern}<br>
                                        <span style="font-style: italic; color: var(--text-muted);">${flow.layout.recommendation}</span>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${flow.navigation ? `
                                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                                    <strong style="font-size: 0.75rem; color: var(--success); display: block; margin-bottom: 6px;">üß≠ Navegaci√≥n:</strong>
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); line-height: 1.5;">
                                        Nivel: ${flow.navigation.level}<br>
                                        Acceso: ${flow.navigation.accessFrom}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                ${flows._architecture ? `
                <div class="content-block" style="margin-top: 24px;">
                    <div class="content-block-header">
                        <span class="content-block-title">üìú Reglas Generales de la Aplicaci√≥n</span>
                    </div>
                    <div class="content-block-body">
                        ${flows._architecture.generalRules ? `
                        <div style="padding: 12px; background: var(--bg-primary); border-radius: var(--radius-sm); margin-bottom: 16px; border-left: 3px solid var(--accent-primary);">
                            <strong style="color: var(--accent-primary); font-size: 0.95rem;">üåç Idioma Oficial</strong>
                            <div style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                                <div style="margin-bottom: 6px;"><strong>Principal:</strong> ${flows._architecture.generalRules.language.primary}</div>
                                <div style="margin-bottom: 6px;"><strong>Formato fechas:</strong> ${flows._architecture.generalRules.language.localization.dateFormat}</div>
                                <div style="margin-bottom: 6px;"><strong>Formato n√∫meros:</strong> ${flows._architecture.generalRules.language.localization.numberFormat}</div>
                                <details style="margin-top: 8px;">
                                    <summary style="cursor: pointer; color: var(--accent-primary);">Ver todas las reglas de idioma ‚Üí</summary>
                                    <ul style="margin-top: 8px; padding-left: 20px; line-height: 1.8;">
                                        ${flows._architecture.generalRules.language.rules.map(rule => `<li>${rule}</li>`).join('')}
                                    </ul>
                                </details>
                            </div>
                        </div>
                        
                        <div style="padding: 12px; background: var(--bg-primary); border-radius: var(--radius-sm); margin-bottom: 16px; border-left: 3px solid var(--warning);">
                            <strong style="color: var(--warning); font-size: 0.95rem;">üé® Branding y Nombre Comercial</strong>
                            <div style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                                <div style="margin-bottom: 8px;"><strong>Regla:</strong> ${flows._architecture.generalRules.branding.naming.rule}</div>
                                <div style="background: var(--bg-secondary); padding: 8px; border-radius: var(--radius-sm); margin-bottom: 8px;">
                                    <strong>Formatos de nombre:</strong><br>
                                    ‚Ä¢ Completo: ${flows._architecture.generalRules.branding.naming.formats.full}<br>
                                    ‚Ä¢ Corto: ${flows._architecture.generalRules.branding.naming.formats.short}<br>
                                    ‚Ä¢ Tagline: ${flows._architecture.generalRules.branding.naming.formats.tagline}<br>
                                    ‚Ä¢ Dominio: ${flows._architecture.generalRules.branding.naming.formats.domain}
                                </div>
                                <strong style="display: block; margin-top: 12px; color: var(--info);">üì± √çcono Representativo</strong>
                                <div style="margin-top: 6px;"><strong>Estilo:</strong> ${flows._architecture.generalRules.branding.icon.specifications.style}</div>
                                <div><strong>Colores:</strong> ${flows._architecture.generalRules.branding.icon.specifications.colors}</div>
                                <div><strong>Escalabilidad:</strong> ${flows._architecture.generalRules.branding.icon.specifications.scalability}</div>
                                <details style="margin-top: 8px;">
                                    <summary style="cursor: pointer; color: var(--warning);">Ver ubicaciones del logo ‚Üí</summary>
                                    <ul style="margin-top: 8px; padding-left: 20px; line-height: 1.8;">
                                        ${flows._architecture.generalRules.branding.naming.locations.map(loc => `<li>${loc}</li>`).join('')}
                                    </ul>
                                </details>
                            </div>
                        </div>
                        
                        <div style="padding: 12px; background: var(--bg-primary); border-radius: var(--radius-sm); margin-bottom: 16px; border-left: 3px solid var(--success);">
                            <strong style="color: var(--success); font-size: 0.95rem;">üîç Optimizaci√≥n SEO</strong>
                            <div style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                                <div style="margin-bottom: 8px;"><strong>Regla:</strong> ${flows._architecture.generalRules.seo.rule}</div>
                                <strong>Reglas Generales:</strong>
                                <ul style="margin-top: 6px; padding-left: 20px; line-height: 1.8;">
                                    ${flows._architecture.generalRules.seo.general.slice(0, 5).map(rule => `<li>${rule}</li>`).join('')}
                                </ul>
                                <details style="margin-top: 8px;">
                                    <summary style="cursor: pointer; color: var(--success);">Ver gu√≠as completas de SEO ‚Üí</summary>
                                    <div style="margin-top: 12px;">
                                        <strong style="color: var(--info);">Reglas de Contenido:</strong>
                                        <ul style="margin-top: 6px; padding-left: 20px; line-height: 1.8;">
                                            ${flows._architecture.generalRules.seo.contentRules.map(rule => `<li>${rule}</li>`).join('')}
                                        </ul>
                                        <strong style="display: block; margin-top: 12px; color: var(--info);">T√©cnico:</strong>
                                        <ul style="margin-top: 6px; padding-left: 20px; line-height: 1.8;">
                                            ${flows._architecture.generalRules.seo.technical.slice(0, 6).map(rule => `<li>${rule}</li>`).join('')}
                                        </ul>
                                        <strong style="display: block; margin-top: 12px; color: var(--info);">Performance:</strong>
                                        <ul style="margin-top: 6px; padding-left: 20px; line-height: 1.8;">
                                            ${flows._architecture.generalRules.seo.performance.slice(0, 5).map(rule => `<li>${rule}</li>`).join('')}
                                        </ul>
                                    </div>
                                </details>
                            </div>
                        </div>
                        
                        <div style="padding: 12px; background: var(--bg-primary); border-radius: var(--radius-sm); border-left: 3px solid var(--info);">
                            <strong style="color: var(--info); font-size: 0.95rem;">‚úçÔ∏è Gu√≠as de Contenido</strong>
                            <div style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                                <strong>Tono de Comunicaci√≥n:</strong>
                                <ul style="margin-top: 6px; padding-left: 20px; line-height: 1.8;">
                                    ${flows._architecture.generalRules.contentGuidelines.tone.characteristics.map(char => `<li>${char}</li>`).join('')}
                                </ul>
                                <details style="margin-top: 8px;">
                                    <summary style="cursor: pointer; color: var(--info);">Ver gu√≠as de copywriting ‚Üí</summary>
                                    <div style="margin-top: 12px;">
                                        <strong>Botones:</strong>
                                        <ul style="margin-top: 6px; padding-left: 20px; line-height: 1.8;">
                                            ${flows._architecture.generalRules.contentGuidelines.copywriting.buttons.map(rule => `<li>${rule}</li>`).join('')}
                                        </ul>
                                        <strong style="display: block; margin-top: 8px;">Mensajes de Error:</strong>
                                        <ul style="margin-top: 6px; padding-left: 20px; line-height: 1.8;">
                                            ${flows._architecture.generalRules.contentGuidelines.copywriting.errors.map(rule => `<li>${rule}</li>`).join('')}
                                        </ul>
                                    </div>
                                </details>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="content-block" style="margin-top: 16px;">
                    <div class="content-block-header">
                        <span class="content-block-title">üèóÔ∏è Arquitectura y Gu√≠as de Consistencia</span>
                    </div>
                    <div class="content-block-body">
                        <div style="padding: 8px; background: var(--bg-primary); border-radius: var(--radius-sm); margin-bottom: 12px;">
                            <strong style="color: var(--accent-primary);">üìã Tipos de Pantallas Definidos:</strong>
                            <ul style="margin-top: 8px; padding-left: 20px; font-size: 0.85rem; color: var(--text-secondary); line-height: 1.8;">
                                ${Object.entries(flows._architecture.screenTypes).map(([key, type]) => `
                                    <li><strong>${type.types.join(', ')}</strong>: ${type.characteristics}</li>
                                `).join('')}
                            </ul>
                        </div>
                        <div style="padding: 8px; background: var(--bg-primary); border-radius: var(--radius-sm);">
                            <strong style="color: var(--accent-primary);">üéØ Reglas de Consistencia Visual:</strong>
                            <ul style="margin-top: 8px; padding-left: 20px; font-size: 0.85rem; color: var(--text-secondary); line-height: 1.8;">
                                <li><strong>Espaciado:</strong> ${flows._architecture.consistencyRules.spacing.rule} (${flows._architecture.consistencyRules.spacing.scale})</li>
                                <li><strong>Tipograf√≠a:</strong> ${flows._architecture.consistencyRules.typography.rule}</li>
                                <li><strong>Colores:</strong> ${flows._architecture.consistencyRules.colors.rule}</li>
                                <li><strong>Componentes:</strong> ${flows._architecture.consistencyRules.components.principle}</li>
                                <li><strong>Animaciones:</strong> ${flows._architecture.consistencyRules.animations.rule}</li>
                            </ul>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
        }

        function renderTokens(tokens) {
            const container = document.getElementById('tokensContainer');
            
            if (!tokens.colors) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üé®</div><p>No hay tokens definidos</p></div>';
                return;
            }

            container.innerHTML = `
                <h4 style="margin-bottom: 16px; color: var(--text-secondary);">üé® Colores</h4>
                <div class="tokens-grid" style="margin-bottom: 24px;">
                    ${Object.entries(tokens.colors).map(([name, value]) => `
                        <div class="token-card">
                            <div class="color-preview" style="background: ${value};"></div>
                            <div class="token-card-title">${name}</div>
                            <div class="token-card-value">${value}</div>
                        </div>
                    `).join('')}
                </div>

                <h4 style="margin-bottom: 16px; color: var(--text-secondary);">üìù Tipograf√≠a</h4>
                <div class="tokens-grid" style="margin-bottom: 24px;">
                    ${Object.entries(tokens.typography || {}).map(([name, value]) => `
                        <div class="token-card">
                            <div class="token-card-title">${name}</div>
                            <div class="token-card-value">${value}</div>
                        </div>
                    `).join('')}
                </div>

                <h4 style="margin-bottom: 16px; color: var(--text-secondary);">üìê Espaciado</h4>
                <div class="tokens-grid" style="margin-bottom: 24px;">
                    ${Object.entries(tokens.spacing || {}).map(([name, value]) => `
                        <div class="token-card">
                            <div class="token-card-title">${name}</div>
                            <div class="token-card-value">${value}</div>
                        </div>
                    `).join('')}
                </div>

                <h4 style="margin-bottom: 16px; color: var(--text-secondary);">‚¨ú Border Radius</h4>
                <div class="tokens-grid">
                    ${Object.entries(tokens.borderRadius || {}).map(([name, value]) => `
                        <div class="token-card">
                            <div class="token-card-title">${name}</div>
                            <div class="token-card-value">${value}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderMetrics(metrics) {
            const container = document.getElementById('metricsContainer');
            
            if (metrics.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìä</div><p>No hay m√©tricas definidas</p></div>';
                return;
            }

            container.innerHTML = metrics.map(metric => `
                <div class="metric-card">
                    <div class="metric-icon">${metric.icon}</div>
                    <div class="metric-title">${metric.name}</div>
                    <div class="metric-value">${metric.target}</div>
                </div>
            `).join('');
        }

        function renderGeneralRules(generalRules) {
            const container = document.getElementById('generalRulesContainer');
            
            if (!generalRules) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìú</div><p>No hay reglas generales definidas</p></div>';
                return;
            }

            let html = '';

            // Idioma
            if (generalRules.language) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üåç Idioma Oficial</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="margin-bottom: 12px;"><strong>Principal:</strong> ${generalRules.language.primary}</div>
                            <div style="margin-bottom: 12px;"><strong>Formato fechas:</strong> ${generalRules.language.localization.dateFormat}</div>
                            <div style="margin-bottom: 12px;"><strong>Formato n√∫meros:</strong> ${generalRules.language.localization.numberFormat}</div>
                            <details style="margin-top: 16px;">
                                <summary style="cursor: pointer; color: var(--accent-primary); font-weight: 600;">Ver todas las reglas de idioma ‚Üí</summary>
                                <ul style="margin-top: 12px; padding-left: 20px; line-height: 1.8;">
                                    ${generalRules.language.rules.map(rule => `<li>${rule}</li>`).join('')}
                                </ul>
                            </details>
                        </div>
                    </div>
                `;
            }

            // Branding
            if (generalRules.branding) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üé® Branding y Nombre Comercial</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="margin-bottom: 16px;"><strong>Regla:</strong> ${generalRules.branding.naming.rule}</div>
                            <div style="background: var(--bg-secondary); padding: 16px; border-radius: var(--radius-sm); margin-bottom: 16px;">
                                <strong style="display: block; margin-bottom: 8px;">Formatos de nombre:</strong>
                                <div style="line-height: 1.8;">
                                    ‚Ä¢ Completo: ${generalRules.branding.naming.formats.full}<br>
                                    ‚Ä¢ Corto: ${generalRules.branding.naming.formats.short}<br>
                                    ‚Ä¢ Tagline: ${generalRules.branding.naming.formats.tagline}<br>
                                    ‚Ä¢ Dominio: ${generalRules.branding.naming.formats.domain}
                                </div>
                            </div>
                            <strong style="display: block; margin-top: 16px; margin-bottom: 8px; color: var(--info);">üì± √çcono Representativo</strong>
                            <div style="line-height: 1.8;">
                                <div><strong>Estilo:</strong> ${generalRules.branding.icon.specifications.style}</div>
                                <div><strong>Colores:</strong> ${generalRules.branding.icon.specifications.colors}</div>
                                <div><strong>Escalabilidad:</strong> ${generalRules.branding.icon.specifications.scalability}</div>
                            </div>
                            <details style="margin-top: 16px;">
                                <summary style="cursor: pointer; color: var(--accent-primary); font-weight: 600;">Ver ubicaciones del logo ‚Üí</summary>
                                <ul style="margin-top: 12px; padding-left: 20px; line-height: 1.8;">
                                    ${generalRules.branding.naming.locations.map(loc => `<li>${loc}</li>`).join('')}
                                </ul>
                            </details>
                        </div>
                    </div>
                `;
            }

            // SEO
            if (generalRules.seo) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üîç Optimizaci√≥n SEO</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="margin-bottom: 16px;"><strong>Regla:</strong> ${generalRules.seo.rule}</div>
                            <strong style="display: block; margin-bottom: 8px;">Reglas Generales:</strong>
                            <ul style="padding-left: 20px; line-height: 1.8; margin-bottom: 16px;">
                                ${generalRules.seo.general.map(rule => `<li>${rule}</li>`).join('')}
                            </ul>
                            <details style="margin-top: 16px;">
                                <summary style="cursor: pointer; color: var(--accent-primary); font-weight: 600;">Ver reglas de contenido ‚Üí</summary>
                                <ul style="margin-top: 12px; padding-left: 20px; line-height: 1.8;">
                                    ${generalRules.seo.contentRules.map(rule => `<li>${rule}</li>`).join('')}
                                </ul>
                            </details>
                            <details style="margin-top: 12px;">
                                <summary style="cursor: pointer; color: var(--accent-primary); font-weight: 600;">Ver reglas t√©cnicas ‚Üí</summary>
                                <ul style="margin-top: 12px; padding-left: 20px; line-height: 1.8;">
                                    ${generalRules.seo.technical.map(rule => `<li>${rule}</li>`).join('')}
                                </ul>
                            </details>
                            <details style="margin-top: 12px;">
                                <summary style="cursor: pointer; color: var(--accent-primary); font-weight: 600;">Ver reglas de performance ‚Üí</summary>
                                <ul style="margin-top: 12px; padding-left: 20px; line-height: 1.8;">
                                    ${generalRules.seo.performance.map(rule => `<li>${rule}</li>`).join('')}
                                </ul>
                            </details>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function renderArchitecture(architecture) {
            const container = document.getElementById('architectureContainer');
            
            if (!architecture) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üèóÔ∏è</div><p>No hay arquitectura definida</p></div>';
                return;
            }

            let html = '';

            // Elementos Globales
            if (architecture.globalElements && architecture.globalElements.persistent) {
                const persistent = architecture.globalElements.persistent;
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üèóÔ∏è Elementos Globales</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="line-height: 2.5;">
                                <div><strong>Header:</strong> ${persistent.header.present ? '‚úì Presente' : '‚úó No presente'} ${persistent.header.present ? '- Excluye: ' + persistent.header.excludeFrom.join(', ') : ''}</div>
                                <div><strong>Bottom Navigation:</strong> ${persistent.bottomNav.present ? '‚úì Presente (Mobile)' : '‚úó No presente'} ${persistent.bottomNav.present ? '- Altura: ' + persistent.bottomNav.height : ''}</div>
                                <div><strong>Sidebar:</strong> ${persistent.sidebar.present ? '‚úì Presente (Web)' : '‚úó No presente'} ${persistent.sidebar.present ? '- Ancho: ' + persistent.sidebar.width : ''}</div>
                                <div><strong>Footer:</strong> ${persistent.footer.present ? '‚úì Presente' : '‚úó No presente'} ${persistent.footer.note ? '- ' + persistent.footer.note : ''}</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Niveles de Navegaci√≥n
            if (architecture.navigationFlow && architecture.navigationFlow.hierarchy) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üß≠ Niveles de Navegaci√≥n</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="line-height: 2;">
                                ${Object.entries(architecture.navigationFlow.hierarchy).map(([level, data]) => `
                                    <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border-color);">
                                        <strong style="color: var(--accent-primary); display: block; margin-bottom: 8px;">${level.toUpperCase()}:</strong>
                                        <div style="margin-left: 16px; color: var(--text-secondary);">
                                            <div><strong>Pantallas:</strong> ${data.screens.join(', ')}</div>
                                            <div><strong>Acceso:</strong> ${data.access}</div>
                                            ${data.maxItems ? `<div><strong>M√°x items:</strong> ${data.maxItems}</div>` : ''}
                                            ${data.maxDepth ? `<div><strong>Profundidad:</strong> ${data.maxDepth}</div>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            // Patrones de Layout
            if (architecture.layoutPatterns) {
                const hasPatterns = (architecture.layoutPatterns.mobile && Object.keys(architecture.layoutPatterns.mobile).length > 0) ||
                                  (architecture.layoutPatterns.web && Object.keys(architecture.layoutPatterns.web).length > 0);
                                  
                if (hasPatterns) {
                    html += `
                        <div class="content-block">
                            <div class="content-block-header">
                                <span class="content-block-title">üìê Patrones de Layout Utilizados</span>
                            </div>
                            <div class="content-block-body" style="padding: 20px;">
                    `;
                    
                    if (architecture.layoutPatterns.mobile) {
                        html += '<div style="margin-bottom: 20px;"><strong style="color: var(--info); font-size: 1.1rem;">Mobile:</strong></div>';
                        html += '<ul style="padding-left: 20px; line-height: 1.8;">';
                        Object.entries(architecture.layoutPatterns.mobile).forEach(([name, data]) => {
                            html += `<li><strong>${name}:</strong> ${data.pattern} - ${data.useFor.join(', ')}</li>`;
                        });
                        html += '</ul>';
                    }
                    
                    if (architecture.layoutPatterns.web) {
                        html += '<div style="margin-top: 20px; margin-bottom: 20px;"><strong style="color: var(--success); font-size: 1.1rem;">Web:</strong></div>';
                        html += '<ul style="padding-left: 20px; line-height: 1.8;">';
                        Object.entries(architecture.layoutPatterns.web).forEach(([name, data]) => {
                            html += `<li><strong>${name}:</strong> ${data.pattern} - ${data.useFor.join(', ')}</li>`;
                        });
                        html += '</ul>';
                    }
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
            }

            container.innerHTML = html;
        }

        function renderConsistency(consistencyData) {
            const container = document.getElementById('consistencyContainer');
            
            if (!consistencyData) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚úì</div><p>No hay gu√≠a de consistencia definida</p></div>';
                return;
            }

            let html = '';

            // Estados
            if (consistencyData.states) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üé≠ Estados de Elementos</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="margin-bottom: 12px;"><strong>Regla:</strong> ${consistencyData.states.rule}</div>
                            <div style="line-height: 2;">
                                <strong>Estados requeridos:</strong>
                                <ul style="margin-top: 8px; padding-left: 20px;">
                                    ${consistencyData.states.required.map(state => `<li>${state}</li>`).join('')}
                                </ul>
                            </div>
                            ${consistencyData.states.loading ? `<div style="margin-top: 12px;"><strong>Loading:</strong> ${consistencyData.states.loading}</div>` : ''}
                            ${consistencyData.states.error ? `<div style="margin-top: 8px;"><strong>Error:</strong> ${consistencyData.states.error}</div>` : ''}
                        </div>
                    </div>
                `;
            }

            // Espaciado
            if (consistencyData.spacing) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üìè Sistema de Espaciado</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="margin-bottom: 12px;"><strong>Regla:</strong> ${consistencyData.spacing.rule}</div>
                            <div style="background: var(--bg-secondary); padding: 16px; border-radius: var(--radius-sm); line-height: 1.8;">
                                <strong>Escala:</strong> ${consistencyData.spacing.scale}
                            </div>
                            <div style="margin-top: 12px;"><strong>Aplicaci√≥n:</strong> ${consistencyData.spacing.application}</div>
                            ${consistencyData.spacing.exception ? `<div style="margin-top: 8px; font-style: italic; color: var(--text-muted);">Excepci√≥n: ${consistencyData.spacing.exception}</div>` : ''}
                        </div>
                    </div>
                `;
            }

            // Tipograf√≠a
            if (consistencyData.typography) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üìù Jerarqu√≠a Tipogr√°fica</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="margin-bottom: 12px;"><strong>Regla:</strong> ${consistencyData.typography.rule}</div>
                            <div style="line-height: 2;">
                                ${Object.entries(consistencyData.typography.levels).map(([level, desc]) => `
                                    <div style="margin-bottom: 12px;">
                                        <strong style="color: var(--info);">${level}:</strong> ${desc}
                                    </div>
                                `).join('')}
                            </div>
                            <div style="margin-top: 12px; font-style: italic; color: var(--text-muted);">${consistencyData.typography.consistency}</div>
                        </div>
                    </div>
                `;
            }

            // Colores
            if (consistencyData.colors) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üé® Uso de Colores</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="margin-bottom: 12px;"><strong>Regla:</strong> ${consistencyData.colors.rule}</div>
                            <div style="line-height: 2;">
                                ${Object.entries(consistencyData.colors.mapping).map(([color, use]) => `
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: var(--${color});">${color}:</strong> ${use}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            // Componentes
            if (consistencyData.components) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üß© Componentes Reutilizables</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="margin-bottom: 12px;"><strong>Regla:</strong> ${consistencyData.components.rule}</div>
                            <div style="margin-bottom: 12px;"><strong>Principio:</strong> ${consistencyData.components.principle}</div>
                            <div style="margin-bottom: 12px;"><strong>Ejemplo:</strong> ${consistencyData.components.example}</div>
                            <div><strong>Variantes:</strong> ${consistencyData.components.variants}</div>
                        </div>
                    </div>
                `;
            }

            // Animaciones
            if (consistencyData.animations) {
                html += `
                    <div class="content-block">
                        <div class="content-block-header">
                            <span class="content-block-title">üé¨ Animaciones y Transiciones</span>
                        </div>
                        <div class="content-block-body" style="padding: 20px;">
                            <div style="margin-bottom: 16px;"><strong>Regla:</strong> ${consistencyData.animations.rule}</div>
                            <strong style="display: block; margin-bottom: 8px;">Duraciones:</strong>
                            <div style="line-height: 2; margin-left: 16px;">
                                ${Object.entries(consistencyData.animations.duration).map(([type, time]) => `
                                    <div><strong style="color: var(--warning);">${type}:</strong> ${time}</div>
                                `).join('')}
                            </div>
                            <div style="margin-top: 12px;"><strong>Easing:</strong> ${consistencyData.animations.easing}</div>
                            <div style="margin-top: 8px; font-style: italic; color: var(--text-muted);">${consistencyData.animations.principle}</div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // ========== Tab & Tier Switching ==========
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabId);
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `tab-${tabId}`);
            });
        }

        function switchTier(tier) {
            state.currentFlowTier = tier;
            document.querySelectorAll('.tier-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tier === tier);
            });
            
            const project = state.projects.find(p => p.id === state.currentProjectId);
            if (project) {
                renderFlows(project.data?.flows || {});
            }
        }

        // ========== Overview Actions ==========
        function approveOverview() {
            const project = state.projects.find(p => p.id === state.currentProjectId);
            if (project) {
                project.overviewApproved = true;
                saveProjects();
                
                document.getElementById('overviewSection').style.display = 'none';
                document.getElementById('mainTabs').style.display = 'block';
                document.getElementById('promptBuilder').style.display = 'block';
                
                updatePromptOutput();
                showToast('Concepto aprobado. ¬°Explora las pesta√±as!', 'success');
            }
        }

        function editOverview() {
            const project = state.projects.find(p => p.id === state.currentProjectId);
            if (project) {
                document.getElementById('projectName').value = project.name;
                document.getElementById('projectCategory').value = project.category;
                document.getElementById('projectDescription').value = project.description;
                
                document.getElementById('projectView').classList.remove('active');
                document.getElementById('projectForm').classList.add('active');
            }
        }

        // ========== Content Block Actions ==========
        function editBlock(blockId) {
            const textarea = document.getElementById(blockId);
            const isReadOnly = textarea.readOnly;
            textarea.readOnly = !isReadOnly;
            
            if (isReadOnly) {
                textarea.focus();
                textarea.style.borderColor = 'var(--accent-primary)';
                showToast('Modo edici√≥n activado', 'info');
            } else {
                textarea.style.borderColor = 'var(--border-color)';
                saveCurrentProject();
            }
        }

        function copyBlock(blockId) {
            const textarea = document.getElementById(blockId);
            navigator.clipboard.writeText(textarea.value).then(() => {
                showToast('Copiado al portapapeles', 'success');
            });
        }

        // ========== Prompt Builder ==========
        function togglePromptSection(btn) {
            btn.classList.toggle('active');
            const section = btn.dataset.section;
            
            if (btn.classList.contains('active')) {
                if (!state.selectedPromptSections.includes(section)) {
                    state.selectedPromptSections.push(section);
                }
            } else {
                state.selectedPromptSections = state.selectedPromptSections.filter(s => s !== section);
            }
            
            updatePromptOutput();
        }

        function updatePromptOutput() {
            const project = state.projects.find(p => p.id === state.currentProjectId);
            if (!project) return;

            let prompt = `# Brief de Dise√±o UX/UI para ${project.name}\n\n`;
            prompt += `## Contexto del Proyecto\n`;
            prompt += `Categor√≠a: ${project.category || 'General'}\n\n`;

            const sections = {
                whatIs: { title: 'Qu√© es y qu√© hace', content: project.data?.whatIs },
                targetAudience: { title: 'P√∫blico Objetivo', content: project.data?.targetAudience },
                needsSolved: { title: 'Necesidades que Resuelve', content: project.data?.needsSolved },
                differentiators: { title: 'Diferenciadores', content: project.data?.differentiators },
                elevatorPitch: { title: 'Elevator Pitch', content: project.data?.elevatorPitch },
                appType: { title: 'Tipo de Aplicaci√≥n', content: project.data?.appType },
                flowsMvp: { title: 'Flujos MVP', content: formatFlowsForPrompt(project.data?.flows, 'mvp') },
                flowsIntermediate: { title: 'Flujos Intermediate', content: formatFlowsForPrompt(project.data?.flows, 'intermediate') },
                flowsComplete: { title: 'Flujos Complete', content: formatFlowsForPrompt(project.data?.flows, 'complete') },
                generalRules: { title: 'Reglas Generales de la Aplicaci√≥n', content: formatGeneralRulesForPrompt(project.data?.flows?._architecture?.generalRules) },
                architecture: { title: 'Arquitectura de Pantallas', content: formatArchitectureForPrompt(project.data?.flows?._architecture) },
                consistency: { title: 'Gu√≠a de Consistencia', content: formatConsistencyForPrompt(project.data?.flows?._architecture?.consistencyGuide) },
                tokens: { title: 'Design Tokens', content: formatTokensForPrompt(project.data?.tokens) },
                uiComponents: { title: 'Componentes UI', content: project.data?.uiComponents },
                metrics: { title: 'M√©tricas de √âxito', content: project.data?.metricsDetail }
            };

            state.selectedPromptSections.forEach(sectionKey => {
                const section = sections[sectionKey];
                if (section && section.content) {
                    prompt += `## ${section.title}\n${section.content}\n\n`;
                }
            });

            prompt += `---\n\nCon base en este brief, genera los dise√±os de alta fidelidad para ${project.name}, respetando los design tokens y flujos especificados.`;

            document.getElementById('promptOutput').textContent = prompt;
        }

        function formatFlowsForPrompt(flows, tier = null) {
            if (!flows) return '';
            
            let result = '';
            const tiers = tier ? [tier] : ['mvp', 'intermediate', 'complete'];
            
            tiers.forEach(t => {
                if (flows[t] && flows[t].length > 0) {
                    if (!tier) {
                        result += `\n### ${t.toUpperCase()}\n`;
                    }
                    flows[t].forEach((flow, i) => {
                        result += `\n${i + 1}. ${flow.screen}\n`;
                        result += `   Descripci√≥n: ${flow.description}\n`;
                        if (flow.context) {
                            result += `   Contexto: ${flow.context}\n`;
                        }
                        
                        // Elementos UI
                        result += `   \n   üé® Elementos UI:\n`;
                        flow.elements.forEach(el => {
                            result += `      ‚Ä¢ ${el}\n`;
                        });
                        
                        // Elementos Globales
                        if (flow.globalElements) {
                            result += `   \n   üèóÔ∏è Elementos Globales:\n`;
                            result += `      ${flow.globalElements.header ? '‚úì Header' : '‚úó Header'} | `;
                            result += `${flow.globalElements.bottomNav ? '‚úì Bottom Nav' : '‚úó Bottom Nav'} | `;
                            result += `${flow.globalElements.sidebar ? '‚úì Sidebar' : '‚úó Sidebar'}\n`;
                            if (flow.globalElements.note) {
                                result += `      Nota: ${flow.globalElements.note}\n`;
                            }
                        }
                        
                        // Layout
                        if (flow.layout) {
                            result += `   \n   üìê Layout:\n`;
                            result += `      Patr√≥n: ${flow.layout.pattern}\n`;
                            result += `      Recomendaci√≥n: ${flow.layout.recommendation}\n`;
                        }
                        
                        // Navegaci√≥n
                        if (flow.navigation) {
                            result += `   \n   üß≠ Navegaci√≥n:\n`;
                            result += `      Nivel: ${flow.navigation.level}\n`;
                            result += `      Acceso: ${flow.navigation.accessFrom}\n`;
                        }
                        
                        result += `\n`;
                    });
                }
            });
            return result;
        }

        function formatTokensForPrompt(tokens) {
            if (!tokens) return '';
            
            let result = '';
            if (tokens.colors) {
                result += '\n### Colores\n';
                Object.entries(tokens.colors).forEach(([k, v]) => {
                    result += `- ${k}: ${v}\n`;
                });
            }
            if (tokens.typography) {
                result += '\n### Tipograf√≠a\n';
                Object.entries(tokens.typography).forEach(([k, v]) => {
                    result += `- ${k}: ${v}\n`;
                });
            }
            if (tokens.spacing) {
                result += '\n### Espaciado\n';
                Object.entries(tokens.spacing).forEach(([k, v]) => {
                    result += `- ${k}: ${v}\n`;
                });
            }
            return result;
        }

        function formatGeneralRulesForPrompt(generalRules) {
            if (!generalRules) return '';
            
            let result = '';
            
            // Idioma
            if (generalRules.language) {
                result += '\n### üåç Idioma Oficial\n';
                result += `Principal: ${generalRules.language.primary}\n`;
                result += `Formato fechas: ${generalRules.language.localization.dateFormat}\n`;
                result += `Formato n√∫meros: ${generalRules.language.localization.numberFormat}\n`;
                result += '\nReglas de idioma:\n';
                generalRules.language.rules.forEach(rule => {
                    result += `   ‚Ä¢ ${rule}\n`;
                });
            }
            
            // Branding
            if (generalRules.branding) {
                result += '\n### üé® Branding y Nombre Comercial\n';
                result += `Regla: ${generalRules.branding.naming.rule}\n`;
                result += '\nFormatos de nombre:\n';
                result += `   ‚Ä¢ Completo: ${generalRules.branding.naming.formats.full}\n`;
                result += `   ‚Ä¢ Corto: ${generalRules.branding.naming.formats.short}\n`;
                result += `   ‚Ä¢ Tagline: ${generalRules.branding.naming.formats.tagline}\n`;
                result += `   ‚Ä¢ Dominio: ${generalRules.branding.naming.formats.domain}\n`;
                result += '\nUbicaciones del logo:\n';
                generalRules.branding.naming.locations.forEach(loc => {
                    result += `   ‚Ä¢ ${loc}\n`;
                });
                result += '\nüì± √çcono Representativo:\n';
                result += `   Estilo: ${generalRules.branding.icon.specifications.style}\n`;
                result += `   Colores: ${generalRules.branding.icon.specifications.colors}\n`;
                result += `   Escalabilidad: ${generalRules.branding.icon.specifications.scalability}\n`;
            }
            
            // SEO
            if (generalRules.seo) {
                result += '\n### üîç Optimizaci√≥n SEO\n';
                result += `Regla: ${generalRules.seo.rule}\n`;
                result += '\nReglas Generales:\n';
                generalRules.seo.general.forEach(rule => {
                    result += `   ‚Ä¢ ${rule}\n`;
                });
                result += '\nReglas de Contenido:\n';
                generalRules.seo.contentRules.forEach(rule => {
                    result += `   ‚Ä¢ ${rule}\n`;
                });
                result += '\nReglas T√©cnicas:\n';
                generalRules.seo.technical.forEach(rule => {
                    result += `   ‚Ä¢ ${rule}\n`;
                });
                result += '\nReglas de Performance:\n';
                generalRules.seo.performance.forEach(rule => {
                    result += `   ‚Ä¢ ${rule}\n`;
                });
            }
            
            return result;
        }

        function formatArchitectureForPrompt(architecture) {
            if (!architecture) return '';
            
            let result = '';
            
            // Elementos Globales
            if (architecture.globalElements) {
                result += '\n### üèóÔ∏è Elementos Globales\n';
                result += `Header: ${architecture.globalElements.header}\n`;
                result += `Bottom Navigation: ${architecture.globalElements.bottomNav}\n`;
                result += `Sidebar: ${architecture.globalElements.sidebar}\n`;
            }
            
            // Niveles de Navegaci√≥n
            if (architecture.navigationLevels) {
                result += '\n### üß≠ Niveles de Navegaci√≥n\n';
                Object.entries(architecture.navigationLevels).forEach(([level, desc]) => {
                    result += `${level}: ${desc}\n`;
                });
            }
            
            // Patrones de Layout
            if (architecture.layoutPatterns && architecture.layoutPatterns.length > 0) {
                result += '\n### üìê Patrones de Layout Utilizados\n';
                architecture.layoutPatterns.forEach(pattern => {
                    result += `   ‚Ä¢ ${pattern}\n`;
                });
            }
            
            return result;
        }

        function formatConsistencyForPrompt(consistencyGuide) {
            if (!consistencyGuide) return '';
            
            let result = '';
            
            // Estados
            if (consistencyGuide.states) {
                result += '\n### üé≠ Estados de Elementos\n';
                Object.entries(consistencyGuide.states).forEach(([state, desc]) => {
                    result += `${state}: ${desc}\n`;
                });
            }
            
            // Feedback
            if (consistencyGuide.feedback) {
                result += '\n### üí¨ Feedback al Usuario\n';
                Object.entries(consistencyGuide.feedback).forEach(([type, desc]) => {
                    result += `${type}: ${desc}\n`;
                });
            }
            
            // Tipograf√≠a
            if (consistencyGuide.typography) {
                result += '\n### üìù Jerarqu√≠a Tipogr√°fica\n';
                Object.entries(consistencyGuide.typography).forEach(([level, desc]) => {
                    result += `${level}: ${desc}\n`;
                });
            }
            
            // Espaciado
            if (consistencyGuide.spacing) {
                result += '\n### üìè Sistema de Espaciado\n';
                result += `Base: ${consistencyGuide.spacing.base}\n`;
                result += 'Escala:\n';
                Object.entries(consistencyGuide.spacing.scale).forEach(([size, value]) => {
                    result += `   ${size}: ${value}\n`;
                });
            }
            
            // Animaciones
            if (consistencyGuide.animations) {
                result += '\n### üé¨ Animaciones y Transiciones\n';
                result += `Duraci√≥n: ${consistencyGuide.animations.duration}\n`;
                result += `Easing: ${consistencyGuide.animations.easing}\n`;
                result += 'Tipos:\n';
                Object.entries(consistencyGuide.animations.types).forEach(([type, desc]) => {
                    result += `   ${type}: ${desc}\n`;
                });
            }
            
            // Iconograf√≠a
            if (consistencyGuide.iconography) {
                result += '\n### üé® Iconograf√≠a\n';
                result += `Estilo: ${consistencyGuide.iconography.style}\n`;
                result += `Tama√±os: ${consistencyGuide.iconography.sizes}\n`;
                result += `Peso: ${consistencyGuide.iconography.weight}\n`;
            }
            
            return result;
        }

        function copyPrompt() {
            const prompt = document.getElementById('promptOutput').textContent;
            navigator.clipboard.writeText(prompt).then(() => {
                showToast('Prompt copiado al portapapeles', 'success');
            });
        }

        function regeneratePrompt() {
            updatePromptOutput();
            showToast('Prompt regenerado', 'info');
        }

        // ========== Export ==========
        function exportProject() {
            const project = state.projects.find(p => p.id === state.currentProjectId);
            if (!project) return;

            const exportData = {
                ...project,
                exportedAt: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${project.name.replace(/\s+/g, '-').toLowerCase()}-ux-flow.json`;
            a.click();
            URL.revokeObjectURL(url);

            showToast('Proyecto exportado', 'success');
        }

        // ========== Utilities ==========
        function generateId() {
            return 'proj_' + Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Hace un momento';
            if (diff < 3600000) return `Hace ${Math.floor(diff / 60000)} min`;
            if (diff < 86400000) return `Hace ${Math.floor(diff / 3600000)} hrs`;
            if (diff < 604800000) return `Hace ${Math.floor(diff / 86400000)} d√≠as`;
            
            return date.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });
        }

        function showLoading(text, showProgress = false) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.add('active');
            
            const progressContainer = document.getElementById('loadingProgress');
            if (progressContainer) {
                progressContainer.style.display = showProgress ? 'block' : 'none';
            }
            
            if (showProgress) {
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('progressText').textContent = '0%';
            }
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
            const progressContainer = document.getElementById('loadingProgress');
            if (progressContainer) {
                progressContainer.style.display = 'none';
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = { success: '‚úì', error: '‚úï', info: '‚Ñπ', warning: '‚ö†' };
            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.info}</span>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }
        
        // ========== Testing Structure (Requires external test framework) ==========
        /*
         * Para implementar testing completo, instalar Jest o Vitest:
         * 
         * // tests/projectValidator.test.js
         * describe('ProjectValidator', () => {
         *     test('should reject short project names', () => {
         *         const result = ProjectValidator.validate({ 
         *             name: 'AB', 
         *             description: 'A valid description that is long enough' 
         *         });
         *         expect(result.valid).toBe(false);
         *         expect(result.errors).toHaveLength(1);
         *     });
         *     
         *     test('should accept valid project data', () => {
         *         const result = ProjectValidator.validate({ 
         *             name: 'Valid Project Name', 
         *             description: 'A valid description that is long enough for validation' 
         *         });
         *         expect(result.valid).toBe(true);
         *     });
         * });
         * 
         * // tests/domSanitizer.test.js
         * describe('DOMSanitizer', () => {
         *     test('should escape HTML entities', () => {
         *         const result = DOMSanitizer.sanitize('<scr' + 'ipt>alert("XSS")</scr' + 'ipt>');
         *         expect(result).not.toContain('<scr' + 'ipt>');
         *     });
         *     
         *     test('should remove event handlers', () => {
         *         const result = DOMSanitizer.sanitizeHTML('<div onclick="malicious()">Test</div>');
         *         expect(result).not.toContain('onclick');
         *     });
         * });
         * 
         * // tests/projectSearch.test.js
         * describe('ProjectSearch', () => {
         *     const mockProjects = [
         *         { name: 'Finance App', category: 'fintech', description: 'A finance app' },
         *         { name: 'Health Tracker', category: 'healthtech', description: 'Track health' }
         *     ];
         *     
         *     test('should filter projects by search query', () => {
         *         const results = ProjectSearch.search(mockProjects, 'finance');
         *         expect(results).toHaveLength(1);
         *         expect(results[0].name).toBe('Finance App');
         *     });
         *     
         *     test('should filter by category', () => {
         *         const results = ProjectSearch.filter(mockProjects, { category: 'healthtech' });
         *         expect(results).toHaveLength(1);
         *         expect(results[0].category).toBe('healthtech');
         *     });
         * });
         * 
         * // tests/historyManager.test.js
         * describe('HistoryManager', () => {
         *     let history;
         *     
         *     beforeEach(() => {
         *         history = new HistoryManager(5);
         *     });
         *     
         *     test('should push and retrieve states', () => {
         *         history.push({ data: 'state1' });
         *         history.push({ data: 'state2' });
         *         
         *         const undone = history.undo();
         *         expect(undone.data).toBe('state1');
         *     });
         *     
         *     test('should respect max history limit', () => {
         *         for (let i = 0; i < 10; i++) {
         *             history.push({ data: `state${i}` });
         *         }
         *         expect(history.history.length).toBeLessThanOrEqual(5);
         *     });
         * });
         * 
         * // tests/secureStorage.test.js
         * describe('SecureStorage', () => {
         *     test('should encrypt and decrypt data', () => {
         *         const original = 'sk-ant-api-key-12345';
         *         const encrypted = SecureStorage.encrypt(original);
         *         const decrypted = SecureStorage.decrypt(encrypted);
         *         
         *         expect(encrypted).not.toBe(original);
         *         expect(decrypted).toBe(original);
         *     });
         * });
         * 
         * // tests/integration/projectFlow.test.js
         * describe('Project Creation Flow', () => {
         *     test('should create project with valid data', async () => {
         *         // Simular entrada de usuario
         *         document.getElementById('projectName').value = 'Test Project';
         *         document.getElementById('projectDescription').value = 'A test project description that is long enough';
         *         
         *         await generateProject();
         *         
         *         expect(state.projects.length).toBeGreaterThan(0);
         *         expect(state.projects[0].name).toBe('Test Project');
         *     });
         * });
         * 
         * // Para ejecutar tests:
         * // npm test
         * // o con coverage:
         * // npm test -- --coverage
         */
    </script>
</body>
</html>
