<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowForge | Generador de Flujos UX/UI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Performance optimizations -->
    <link rel="dns-prefetch" href="https://api.anthropic.com">
    <meta name="theme-color" content="#0a0a0f">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar" role="navigation" aria-label="NavegaciÃ³n principal">
            <div class="logo">
                <h1>FlowForge
                    <span>Generador UX/UI v1.0</span>
                </h1>
            </div>

            <div class="api-key-section">
                <label class="api-key-label">API Key de Claude (opcional)</label>
                <input type="password" class="api-key-input" id="apiKeyInput" placeholder="sk-ant-...">
            </div>

            <button class="new-project-btn" onclick="createNewProject()">
                <span>ï¼‹</span> Nuevo Proyecto
            </button>

            <div class="search-container">
                <input type="text" class="search-input" id="projectSearch" placeholder="ðŸ” Buscar proyectos...">
                <div class="filter-controls">
                    <button class="filter-btn active" data-category="all" onclick="filterProjects('all')">Todos</button>
                    <button class="filter-btn" data-category="fintech" onclick="filterProjects('fintech')">Fintech</button>
                    <button class="filter-btn" data-category="healthtech" onclick="filterProjects('healthtech')">Health</button>
                    <button class="filter-btn" data-category="edtech" onclick="filterProjects('edtech')">EdTech</button>
                </div>
            </div>

            <div class="projects-list">
                <div class="projects-header">Proyectos Guardados</div>
                <div id="projectsList"></div>
            </div>

            <div class="sidebar-footer">
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <span class="status-indicator"></span>
                    Autosave activo â€¢ MÃ¡x 10 proyectos
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="main-content" role="main">
            <header class="header" role="banner">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
                <h2 class="header-title" id="headerTitle">Bienvenido a FlowForge</h2>
                <div class="header-actions">
                    <div class="undo-redo-controls" id="undoRedoControls" style="display: none;">
                        <button class="undo-redo-btn" id="undoBtn" onclick="undoChange()" title="Deshacer (Ctrl+Z)" disabled>â†¶</button>
                        <button class="undo-redo-btn" id="redoBtn" onclick="redoChange()" title="Rehacer (Ctrl+Y)" disabled>â†·</button>
                    </div>
                    <span class="save-indicator" id="saveIndicator"></span>
                    <button class="header-btn" onclick="showVersions()" id="versionsBtn" style="display: none;" aria-label="Gestionar versiones">
                        ðŸ• Versiones
                    </button>
                    <button class="header-btn" onclick="showShareDialog()" id="shareBtn" style="display: none;" aria-label="Compartir proyecto">
                        ðŸ”— Compartir
                    </button>
                    <button class="header-btn" onclick="exportProject()" id="exportBtn" style="display: none;" aria-label="Exportar proyecto">
                        â†“ Exportar
                    </button>
                    <button class="header-btn primary" onclick="saveCurrentProject()" id="saveBtn" style="display: none;" aria-label="Guardar proyecto">
                        âœ“ Guardar
                    </button>
                </div>
            </header>

            <div class="content-area">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">â—ˆ</div>
                    <h2 class="welcome-title">Crea flujos UX/UI profesionales</h2>
                    <p class="welcome-subtitle">Genera especificaciones completas de diseÃ±o, flujos de pantalla y mÃ©tricas de Ã©xito para tu aplicaciÃ³n con un solo clic.</p>
                    <button class="new-project-btn" onclick="createNewProject()">
                        <span>ï¼‹</span> Crear mi primer proyecto
                    </button>
                </div>

                <!-- Project Form -->
                <div class="project-form" id="projectForm">
                    <div class="form-section">
                        <h3 class="form-section-title">InformaciÃ³n BÃ¡sica</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nombre Comercial</label>
                                <input type="text" class="form-input" id="projectName" placeholder="Ej: TaskFlow, HealthBuddy...">
                                <span class="field-error" id="projectNameError"></span>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Industria / CategorÃ­a</label>
                                <select class="form-select" id="projectCategory">
                                    <option value="">Seleccionar...</option>
                                    <option value="fintech">Fintech</option>
                                    <option value="healthtech">HealthTech</option>
                                    <option value="edtech">EdTech</option>
                                    <option value="ecommerce">E-commerce</option>
                                    <option value="social">Social / Comunidad</option>
                                    <option value="productivity">Productividad</option>
                                    <option value="entertainment">Entretenimiento</option>
                                    <option value="travel">Viajes</option>
                                    <option value="food">Food / Delivery</option>
                                    <option value="other">Otro</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label">DescripciÃ³n Corta del Proyecto</label>
                                <textarea class="form-textarea" id="projectDescription" rows="3" placeholder="Describe brevemente quÃ© quieres crear..."></textarea>
                                <span class="field-error" id="projectDescriptionError"></span>
                            </div>
                            <div class="form-group full-width" id="expandedDescriptionGroup" style="display: none; margin-top: 20px; padding: 20px; background: var(--surface-color); border-radius: var(--radius-md); border: 2px solid var(--accent-primary);">
                                <label class="form-label" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                    <span style="font-size: 1.2rem;">âœ¨</span>
                                    <span style="font-size: 1rem; font-weight: 600;">DescripciÃ³n Expandida y Refinada</span>
                                </label>
                                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.5;">
                                    Esta descripciÃ³n refinada guiarÃ¡ todo el proceso de generaciÃ³n y asegurarÃ¡ que el resultado estÃ© alineado con tu visiÃ³n.
                                </p>
                                <textarea class="form-textarea" id="expandedDescription" rows="8" placeholder="La descripciÃ³n expandida aparecerÃ¡ aquÃ­..." readonly style="width: 100%; background: var(--bg-primary); opacity: 1; border: 1px solid var(--border-color); resize: vertical; min-height: 150px;"></textarea>
                                <div style="display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap;">
                                    <button type="button" class="secondary-btn" onclick="regenerateExpandedDescription()" id="regenerateExpandedBtn" style="display: none;">
                                        â†» Regenerar
                                    </button>
                                    <button type="button" class="secondary-btn" onclick="editExpandedDescription()" id="editExpandedBtn" style="display: none;">
                                        âœŽ Editar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="secondary-btn" onclick="expandDescription()" id="expandBtn" style="margin-top: 16px; width: 100%;">
                            <span>ðŸ”</span> Expandir y Refinar DescripciÃ³n
                        </button>
                    </div>

                    <button class="generate-btn" onclick="generateProject()" id="generateBtn" disabled style="opacity: 0.5; cursor: not-allowed;">
                        <span>âš¡</span> Generar Flujo UX/UI Completo
                    </button>
                    <p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem; margin-top: 8px;" id="generateHint">
                        â†‘ Primero expande la descripciÃ³n para continuar
                    </p>
                </div>

                <!-- Project View -->
                <div class="project-view" id="projectView">
                    <!-- Overview Section -->
                    <div class="form-section" id="overviewSection">
                        <h3 class="form-section-title">ðŸ“‹ RevisiÃ³n de Concepto</h3>
                        <div id="overviewContent"></div>
                        <div style="margin-top: 16px; display: flex; gap: 10px;">
                            <button class="header-btn primary" onclick="approveOverview()">âœ“ Aprobar y Continuar</button>
                            <button class="header-btn" onclick="editOverview()">âœŽ Editar</button>
                        </div>
                    </div>

                    <!-- Main Tabs -->
                    <div class="tabs-container" id="mainTabs" style="display: none;">
                        <div class="tabs-header">
                            <button class="tab-btn active" data-tab="description">ðŸ“ DescripciÃ³n</button>
                            <button class="tab-btn" data-tab="flows">ðŸ“± Flujos de Pantalla</button>
                            <button class="tab-btn" data-tab="tokens">ðŸŽ¨ Design Tokens</button>
                            <button class="tab-btn" data-tab="elements">ðŸ§© Elementos UI</button>
                            <button class="tab-btn" data-tab="metrics">ðŸ“Š MÃ©tricas</button>
                            <button class="tab-btn" data-tab="generalRules">ðŸ“œ Reglas Generales</button>
                            <button class="tab-btn" data-tab="architecture">ðŸ—ï¸ Arquitectura</button>
                            <button class="tab-btn" data-tab="consistency">âœ“ Consistencia</button>
                        </div>

                        <!-- Description Tab -->
                        <div class="tab-content active" id="tab-description">
                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">ðŸŽ¯ QuÃ© es y quÃ© hace</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('whatIs')">âœŽ Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('whatIs')">âŽ˜ Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="whatIs" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">ðŸ‘¥ Para quiÃ©n es (Nicho)</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('targetAudience')">âœŽ Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('targetAudience')">âŽ˜ Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="targetAudience" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">ðŸ’¡ Necesidades que resuelve</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('needsSolved')">âœŽ Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('needsSolved')">âŽ˜ Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="needsSolved" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">ðŸ† Diferenciadores</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('differentiators')">âœŽ Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('differentiators')">âŽ˜ Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="differentiators" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">ðŸŽ¤ Elevator Pitch</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('elevatorPitch')">âœŽ Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('elevatorPitch')">âŽ˜ Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="elevatorPitch" readonly></textarea>
                                </div>
                            </div>

                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">ðŸ“± Tipo de AplicaciÃ³n Recomendada</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('appType')">âœŽ Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('appType')">âŽ˜ Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="appType" readonly></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Flows Tab -->
                        <div class="tab-content" id="tab-flows">
                            <div class="flow-tier-selector">
                                <button class="tier-btn active" data-tier="mvp">ðŸš€ MVP</button>
                                <button class="tier-btn" data-tier="intermediate">ðŸ“ˆ Intermedio</button>
                                <button class="tier-btn" data-tier="complete">âœ¨ Completo</button>
                            </div>

                            <div id="flowsContainer">
                                <!-- Flows will be rendered here -->
                            </div>
                        </div>

                        <!-- Tokens Tab -->
                        <div class="tab-content" id="tab-tokens">
                            <div id="tokensContainer">
                                <!-- Tokens will be rendered here -->
                            </div>
                        </div>

                        <!-- Elements Tab -->
                        <div class="tab-content" id="tab-elements">
                            <div class="content-block">
                                <div class="content-block-header">
                                    <span class="content-block-title">ðŸ§© Componentes UI Requeridos</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('uiComponents')">âœŽ Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('uiComponents')">âŽ˜ Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="uiComponents" readonly style="min-height: 300px;"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Metrics Tab -->
                        <div class="tab-content" id="tab-metrics">
                            <div id="metricsContainer" class="metrics-grid">
                                <!-- Metrics will be rendered here -->
                            </div>
                            <div class="content-block" style="margin-top: 24px;">
                                <div class="content-block-header">
                                    <span class="content-block-title">ðŸ“Š Detalle de MÃ©tricas</span>
                                    <div class="content-block-actions">
                                        <button class="block-action-btn" onclick="editBlock('metricsDetail')">âœŽ Editar</button>
                                        <button class="block-action-btn copy-btn" onclick="copyBlock('metricsDetail')">âŽ˜ Copiar</button>
                                    </div>
                                </div>
                                <div class="content-block-body">
                                    <textarea class="content-block-textarea" id="metricsDetail" readonly style="min-height: 250px;"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- General Rules Tab -->
                        <div class="tab-content" id="tab-generalRules">
                            <div id="generalRulesContainer">
                                <!-- General Rules will be rendered here -->
                            </div>
                        </div>

                        <!-- Architecture Tab -->
                        <div class="tab-content" id="tab-architecture">
                            <div id="architectureContainer">
                                <!-- Architecture will be rendered here -->
                            </div>
                        </div>

                        <!-- Consistency Tab -->
                        <div class="tab-content" id="tab-consistency">
                            <div id="consistencyContainer">
                                <!-- Consistency will be rendered here -->
                            </div>
                        </div>
                    </div>

                    <!-- Prompt Builder -->
                    <div class="prompt-builder" id="promptBuilder" style="display: none;">
                        <h3 class="prompt-builder-title">ðŸ”§ Constructor de Prompt para Agente de DiseÃ±o</h3>
                        <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 0.9rem;">Selecciona las secciones que deseas incluir en tu prompt personalizado:</p>
                        
                        <div class="prompt-sections" id="promptSections">
                            <button class="prompt-section-toggle active" data-section="whatIs">QuÃ© es</button>
                            <button class="prompt-section-toggle active" data-section="targetAudience">Nicho</button>
                            <button class="prompt-section-toggle active" data-section="needsSolved">Necesidades</button>
                            <button class="prompt-section-toggle" data-section="differentiators">Diferenciadores</button>
                            <button class="prompt-section-toggle" data-section="elevatorPitch">Elevator Pitch</button>
                            <button class="prompt-section-toggle active" data-section="appType">Tipo App</button>
                            <button class="prompt-section-toggle active" data-section="flowsMvp">Flujos MVP</button>
                            <button class="prompt-section-toggle" data-section="flowsIntermediate">Flujos Intermediate</button>
                            <button class="prompt-section-toggle" data-section="flowsComplete">Flujos Complete</button>
                            <button class="prompt-section-toggle" data-section="generalRules">ðŸ“œ Reglas Generales</button>
                            <button class="prompt-section-toggle" data-section="architecture">ðŸ—ï¸ Arquitectura</button>
                            <button class="prompt-section-toggle" data-section="consistency">âœ“ Consistencia</button>
                            <button class="prompt-section-toggle active" data-section="tokens">Design Tokens</button>
                            <button class="prompt-section-toggle" data-section="uiComponents">Componentes</button>
                            <button class="prompt-section-toggle" data-section="metrics">MÃ©tricas</button>
                        </div>

                        <div class="prompt-output" id="promptOutput">
                            <!-- Generated prompt will appear here -->
                        </div>

                        <div class="prompt-actions">
                            <button class="header-btn primary" onclick="copyPrompt()">âŽ˜ Copiar Prompt</button>
                            <button class="header-btn" onclick="regeneratePrompt()">â†» Regenerar</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">Generando flujo UX/UI...</div>
        <div class="loading-progress" id="loadingProgress" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal-overlay" id="deleteModal" role="dialog" aria-labelledby="deleteModalTitle" aria-modal="true">
        <div class="modal">
            <h3 class="modal-title" id="deleteModalTitle">Â¿Eliminar proyecto?</h3>
            <p class="modal-text">Esta acciÃ³n no se puede deshacer. El proyecto serÃ¡ eliminado permanentemente.</p>
            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="closeDeleteModal()">Cancelar</button>
                <button class="modal-btn confirm" onclick="confirmDelete()">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Versions Modal -->
    <div class="modal-overlay" id="versionsModal" role="dialog" aria-labelledby="versionsModalTitle" aria-modal="true">
        <div class="modal">
            <h3 class="modal-title" id="versionsModalTitle">GestiÃ³n de Versiones</h3>
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-size: 0.85rem; margin-bottom: 8px; color: var(--text-secondary);">Nombre de la versiÃ³n</label>
                <input type="text" id="versionNameInput" class="form-input" placeholder="ej: MVP Final, VersiÃ³n para cliente, etc." style="margin-bottom: 8px;">
                <button class="header-btn primary" onclick="createVersion()" style="width: 100%;">ðŸ’¾ Crear Nueva VersiÃ³n</button>
            </div>
            <div class="version-list" id="versionsList"></div>
            <div class="modal-actions" style="margin-top: 16px;">
                <button class="modal-btn cancel" onclick="closeVersionsModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal" role="dialog" aria-labelledby="shareModalTitle" aria-modal="true">
        <div class="modal">
            <h3 class="modal-title" id="shareModalTitle">Compartir Proyecto</h3>
            <p class="modal-text">Comparte este enlace para que otros puedan importar tu proyecto:</p>
            <div class="share-link-container">
                <input type="text" class="share-link-input" id="shareLinkInput" readonly aria-label="Enlace para compartir">
                <button class="header-btn primary" onclick="copyShareLink()">ðŸ“‹ Copiar</button>
            </div>
            <div id="qrCodeContainer" style="display: none;"></div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="generateQRCode()" id="qrBtn">ðŸ“± Generar QR</button>
                <button class="modal-btn cancel" onclick="closeShareModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer" role="status" aria-live="polite" aria-atomic="true"></div>

    <script src="app.js" defer></script>
</body>
</html>